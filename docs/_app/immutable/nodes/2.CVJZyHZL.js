import{c as ce,a as m,f as T,t as ne}from"../chunks/JCkP5NyT.js";import{i as C}from"../chunks/EojkGRaI.js";import{h as z,j as Q,k as Me,a as Z,K as ke,f as xe,x as M,O as Ce,P as Ne,Q as he,i as ee,e as W,C as De,aM as Le,ax as me,c as He,b as ie,s as Ue,a4 as Te,aa as Ee,aK as fe,aT as Fe,aj as be,aU as Oe,aV as Re,U as X,aW as H,r as $e,p as Ie,aX as te,aY as Be,aJ as qe,d as Ke,g as Ve,B as N,D as ue,F as D,G as y,I as w,E as U,J as A,ay as ve,y as q,t as K,V as B,aO as Ye,aZ as Je}from"../chunks/CCBpn3jd.js";import{s as _e,h as We}from"../chunks/CrfBRRB9.js";import{i as O,s as Ae,a as re,p as S}from"../chunks/DocKnR1i.js";import{s as V,e as x}from"../chunks/yIHXd2WH.js";import{w as ge,c as R,o as Pe,a as Xe,d as Ge}from"../chunks/DjMCxkjS.js";function Qe(e,a){return a}function Ze(e,a,t){for(var i=[],d=a.length,n,s=a.length,r=0;r<d;r++){let u=a[r];Ie(u,()=>{if(n){if(n.pending.delete(u),n.done.add(u),n.pending.size===0){var h=e.outrogroups;se(fe(n.done)),h.delete(n),h.size===0&&(e.outrogroups=null)}}else s-=1},!1)}if(s===0){var c=i.length===0&&t!==null;if(c){var l=t,f=l.parentNode;qe(f),f.append(l),e.items.clear()}se(a,!c)}else n={pending:new Set(a),done:new Set},(e.outrogroups??=new Set).add(n)}function se(e,a=!0){for(var t=0;t<e.length;t++)Ke(e[t],a)}var we;function et(e,a,t,i,d,n=null){var s=e,r=new Map;{var c=e;s=z?Q(Me(c)):c.appendChild(Z())}z&&ke();var l=null,f=Te(()=>{var _=t();return Ee(_)?_:_==null?[]:fe(_)}),u,h=!0;function E(){b.fallback=l,tt(b,u,s,a,i),l!==null&&(u.length===0?(l.f&H)===0?$e(l):(l.f^=H,J(l,null,s)):Ie(l,()=>{l=null}))}var o=xe(()=>{u=M(f);var _=u.length;let I=!1;if(z){var p=Ce(s)===Ne;p!==(_===0)&&(s=he(),Q(s),ee(!1),I=!0)}for(var g=new Set,v=He,$=Ue(),j=0;j<_;j+=1){z&&W.nodeType===De&&W.data===Le&&(s=W,I=!0,ee(!1));var F=u[j],k=i(F,j),P=h?null:r.get(k);P?(P.v&&me(P.v,F),P.i&&me(P.i,j),$&&v.unskip_effect(P.e)):(P=at(r,h?s:we??=Z(),F,k,j,d,a,t),h||(P.e.f|=H),r.set(k,P)),g.add(k)}if(_===0&&n&&!l&&(h?l=ie(()=>n(s)):(l=ie(()=>n(we??=Z())),l.f|=H)),z&&_>0&&Q(he()),!h)if($){for(const[ze,je]of r)g.has(ze)||v.skip_effect(je.e);v.oncommit(E),v.ondiscard(()=>{})}else E();I&&ee(!0),M(f)}),b={effect:o,items:r,outrogroups:null,fallback:l};h=!1,z&&(s=W)}function Y(e){for(;e!==null&&(e.f&Be)===0;)e=e.next;return e}function tt(e,a,t,i,d){var n=a.length,s=e.items,r=Y(e.effect.first),c,l=null,f=[],u=[],h,E,o,b;for(b=0;b<n;b+=1){if(h=a[b],E=d(h,b),o=s.get(E).e,e.outrogroups!==null)for(const k of e.outrogroups)k.pending.delete(o),k.done.delete(o);if((o.f&H)!==0)if(o.f^=H,o===r)J(o,null,t);else{var _=l?l.next:r;o===e.effect.last&&(e.effect.last=o.prev),o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),L(e,l,o),L(e,o,_),J(o,_,t),l=o,f=[],u=[],r=Y(l.next);continue}if((o.f&te)!==0&&$e(o),o!==r){if(c!==void 0&&c.has(o)){if(f.length<u.length){var I=u[0],p;l=I.prev;var g=f[0],v=f[f.length-1];for(p=0;p<f.length;p+=1)J(f[p],I,t);for(p=0;p<u.length;p+=1)c.delete(u[p]);L(e,g.prev,v.next),L(e,l,g),L(e,v,I),r=I,l=v,b-=1,f=[],u=[]}else c.delete(o),J(o,r,t),L(e,o.prev,o.next),L(e,o,l===null?e.effect.first:l.next),L(e,l,o),l=o;continue}for(f=[],u=[];r!==null&&r!==o;)(c??=new Set).add(r),u.push(r),r=Y(r.next);if(r===null)continue}(o.f&H)===0&&f.push(o),l=o,r=Y(o.next)}if(e.outrogroups!==null){for(const k of e.outrogroups)k.pending.size===0&&(se(fe(k.done)),e.outrogroups?.delete(k));e.outrogroups.size===0&&(e.outrogroups=null)}if(r!==null||c!==void 0){var $=[];if(c!==void 0)for(o of c)(o.f&te)===0&&$.push(o);for(;r!==null;)(r.f&te)===0&&r!==e.fallback&&$.push(r),r=Y(r.next);var j=$.length;if(j>0){var F=n===0?t:null;Ze(e,$,F)}}}function at(e,a,t,i,d,n,s,r){var c=(s&Oe)!==0?(s&Re)===0?X(t,!1,!1):be(t):null,l=(s&Fe)!==0?be(d):null;return{v:c,i:l,e:ie(()=>(n(a,c??t,l??d,r),()=>{e.delete(i)}))}}function J(e,a,t){if(e.nodes)for(var i=e.nodes.start,d=e.nodes.end,n=a&&(a.f&H)===0?a.nodes.start:t;i!==null;){var s=Ve(i);if(n.before(i),i===d)return;i=s}}function L(e,a,t){a===null?e.effect.first=t:a.next=t,t===null?e.effect.last=a:t.prev=a}function oe(e,a,t,i,d){z&&ke();var n=a.$$slots?.[t],s=!1;n===!0&&(n=a[t==="default"?"children":t],s=!0),n===void 0||n(e,s?()=>i:i)}const ye=[...` 	
\r\f \v\uFEFF`];function nt(e,a,t){var i=e==null?"":""+e;if(a&&(i=i?i+" "+a:a),t){for(var d in t)if(t[d])i=i?i+" "+d:d;else if(i.length)for(var n=d.length,s=0;(s=i.indexOf(d,s))>=0;){var r=s+n;(s===0||ye.includes(i[s-1]))&&(r===i.length||ye.includes(i[r]))?i=(s===0?"":i.substring(0,s))+i.substring(r+1):s=r}}return i===""?null:i}function it(e,a){return e==null?null:String(e)}function pe(e,a,t,i,d,n){var s=e.__className;if(z||s!==t||s===void 0){var r=nt(t,i,n);(!z||r!==e.getAttribute("class"))&&(r==null?e.removeAttribute("class"):e.className=r),e.__className=t}else if(n&&d!==n)for(var c in n){var l=!!n[c];(d==null||l!==!!d[c])&&e.classList.toggle(c,l)}return n}function rt(e,a,t,i){var d=e.__style;if(z||d!==a){var n=it(a);(!z||n!==e.getAttribute("style"))&&(n==null?e.removeAttribute("style"):e.style.cssText=n),e.__style=a}return i}function st(e){return function(...a){var t=a[0];return t.stopPropagation(),e?.apply(this,a)}}function ot(e,a){var t=e.$$events?.[a.type],i=Ee(t)?t.slice():t==null?[]:[t];for(var d of i)d.call(this,a)}const le=ge(null);function lt(e,a="info",t=2500){le.set({message:e,type:a}),t&&setTimeout(()=>le.set(null),t)}var dt=T("<div> </div>");function ct(e,a){N(a,!1);const t=()=>re(le,"$toast",i),[i,d]=Ae();C();var n=ce(),s=ue(n);{var r=c=>{var l=dt(),f=y(l,!0);w(l),U(()=>{pe(l,1,`toast ${t().type??""}`,"svelte-1fk2ial"),V(f,t().message)}),m(c,l)};O(s,c=>{t()&&c(r)})}m(e,n),D(),d()}var ft=T('<div class="backdrop svelte-10shf4z"><div class="modal svelte-10shf4z"><header class="modal-header svelte-10shf4z"><div class="modal-title svelte-10shf4z"><!></div> <button class="close-button svelte-10shf4z" aria-label="Close">×</button></header> <div class="modal-body svelte-10shf4z"><!></div></div></div>');function Se(e,a){N(a,!1);let t=S(a,"open",8,!1),i=S(a,"title",8,"");const d=R();function n(){d("close")}function s(f){f.key==="Escape"&&n()}Pe(()=>(window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s))),C();var r=ce(),c=ue(r);{var l=f=>{var u=ft(),h=y(u),E=y(h),o=y(E),b=y(o);{var _=v=>{var $=ne();U(()=>V($,i())),m(v,$)};O(b,v=>{i()&&v(_)})}w(o);var I=A(o,2);w(E);var p=A(E,2),g=y(p);oe(g,a,"default",{}),w(p),w(h),w(u),x("click",I,n),x("click",h,st(function(v){ot.call(this,a,v)})),x("click",u,n),m(f,u)};O(c,f=>{t()&&f(l)})}m(e,r),D()}var ut=T(`<p>This tool prepares image sets for annotation by analysing a directory of images and generating
		paired (or grouped) image sets suitable for visual comparison and annotation.</p> <h3>Basic usage</h3> <ul><li>Select a directory containing related images</li> <li>The tool scans filenames and image characteristics to suggest image pairs</li> <li>Each pair is reviewed and assigned a base image</li> <li>A project file is generated for use in the annotation tool</li></ul> <h3>How image pairing works</h3> <ul><li>Initial pairing attempts are based on filename similarity and ordering</li> <li>Additional strategies may compare image dimensions and visual similarity</li> <li>Pairs can be adjusted manually where automatic matching is ambiguous</li></ul> <h3>Base image and coordinate system</h3> <ul><li>Each image pair has a designated base image</li> <li>The base image defines the coordinate system for annotations</li> <li>If required, a transformation can be applied to the base image to match the paired image</li></ul> <h3>Output</h3> <ul><li>The result is a <code>project.json</code> file</li> <li>This file can be opened directly in the annotation tool</li> <li>Image pairing, base image selection, and transformations are stored together</li></ul>`,1);function vt(e,a){let t=S(a,"open",12,!1);Se(e,{get open(){return t()},title:"How to use this tool",$$events:{close:()=>t(!1)},children:(i,d)=>{var n=ut();ve(16),m(i,n)},$$slots:{default:!0}})}var gt=T(`<p>This application is designed to support the preparation stage of image-based annotation
		workflows. It focuses on organising collections of related images into structured pairs or
		groups that can be analysed and annotated consistently.</p> <p>Rather than annotating images directly, the tool generates structured project data that is
		consumed by the annotation viewer. This separation allows pairing, alignment, and annotation to
		be treated as distinct but connected stages in a broader workflow.</p> <h3>Image pairing and alignment</h3> <p>The tool attempts to identify related images using a combination of filename patterns and
		image-level characteristics. Once paired, a base image is selected to act as the coordinate
		reference for annotation placement.</p> <p>In cases where image dimensions differ, the base image may require a transformation to align it
		correctly with its paired image. Future versions of the tool are intended to integrate image
		alignment processes that automatically generate and store transformation matrices.</p> <h3>Technologies used</h3> <ul><li><a href="https://svelte.dev/docs/kit/introduction" target="_blank" rel="noopener noreferrer">SvelteKit</a> — application framework and UI architecture</li> <li>Client-side image processing techniques for analysis and comparison</li></ul> <p>The output of this tool is a structured <code>project.json</code> file that captures image pairings,
		base image definitions, and any associated transformations. This file is designed to be consumed by
		downstream tools in the annotation workflow.</p> <p class="muted">This is an experimental application and a work in progress, intended for research, exploration,
		and prototyping workflows.</p> <p class="muted">For any enquiries or suggestions for further development, please contact Christopher Wilson —
		Software Developer, Artificial Intelligence and Ideas Adoption (AIIA), The University of
		Manchester.</p>`,1);function pt(e,a){let t=S(a,"open",12,!1);Se(e,{get open(){return t()},title:"About this tool",$$events:{close:()=>t(!1)},children:(i,d)=>{var n=gt();ve(18),m(i,n)},$$slots:{default:!0}})}function ht(){return"showDirectoryPicker"in window}var mt=T("<button>Load</button>");function bt(e,a){N(a,!1);const t=R();async function i(){if(ht()){const n=await window.showDirectoryPicker(),s=new Map;for await(const r of n.values())if(r.kind==="file"){const c=await r.getFile();s.set(c.name,c)}t("load",{files:s,dir:n})}else{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0,n.multiple=!0,n.onchange=()=>{const s=new Map(Array.from(n.files).map(r=>[r.name,r]));t("load",{files:s,dir:null})},n.click()}}C();var d=mt();x("click",d,i),m(e,d),D()}var _t=T("<button>Save</button>");function wt(e,a){N(a,!1);const t=R();let i=S(a,"disabled",8,!1);C();var d=_t();U(()=>d.disabled=i()),x("click",d,()=>t("save")),m(e,d),D()}var yt=T('<header class="header svelte-zne36e"><div class="actions svelte-zne36e"><!> <!> <button>Help</button> <button>About</button></div> <div class="title svelte-zne36e"><a href="https://github.com/UoMLibrary/uom-open-annotator/" target="_blank" rel="noopener noreferrer" class="svelte-zne36e">Image Alignment Tool</a></div></header>');function kt(e,a){N(a,!1);const t=R();C();var i=yt(),d=y(i),n=y(d);bt(n,{$$events:{load:l=>t("load-project",l.detail)}});var s=A(n,2);wt(s,{$$events:{save:()=>t("save-project")}});var r=A(s,2),c=A(r,2);w(d),ve(2),w(i),x("click",r,()=>t("help")),x("click",c,()=>t("about")),m(e,i),D()}var Tt=T('<div class="panel-content svelte-4epbbf"><!></div>'),Et=T('<div><aside class="svelte-4epbbf"><header class="svelte-4epbbf"><!></header> <!></aside> <button class="toggle svelte-4epbbf" aria-label="Toggle panel"><!></button></div>');function $t(e,a){N(a,!1);let t=S(a,"side",8,"left"),i=S(a,"open",12,!0),d=S(a,"width",8,260);const n=R();function s(){i(!i()),n("toggle",i())}function r(g){g.target instanceof HTMLElement&&["INPUT","TEXTAREA"].includes(g.target.tagName)||(t()==="left"&&g.key==="["&&(g.preventDefault(),s()),t()==="right"&&g.key==="]"&&(g.preventDefault(),s()))}Pe(()=>{window.addEventListener("keydown",r)}),Xe(()=>{window.removeEventListener("keydown",r)}),C();var c=Et();let l;var f=y(c),u=y(f),h=y(u);oe(h,a,"header",{}),w(u);var E=A(u,2);{var o=g=>{var v=Tt(),$=y(v);oe($,a,"default",{}),w(v),m(g,v)};O(E,g=>{i()&&g(o)})}w(f);var b=A(f,2),_=y(b);{var I=g=>{var v=ne();U(()=>V(v,i()?"⟨":"⟩")),m(g,v)},p=g=>{var v=ne();U(()=>V(v,i()?"⟩":"⟨")),m(g,v)};O(_,g=>{t()==="left"?g(I):g(p,!1)})}w(b),w(c),U(()=>{l=pe(c,1,`side-panel ${t()??""}`,"svelte-4epbbf",l,{collapsed:!i()}),rt(c,`--panel-width: ${d()??""}px`)}),x("click",b,s),m(e,c),D()}var It=T('<div class="count-badge svelte-1tdzwuu"> </div>'),At=T('<div><div class="thumbs svelte-1tdzwuu"><img alt="Image A" class="svelte-1tdzwuu"/> <img alt="Image B" class="svelte-1tdzwuu"/> <!> <div class="label-overlay svelte-1tdzwuu"> </div></div></div>');function Pt(e,a){N(a,!1);let t=S(a,"pair",8),i=S(a,"selected",8,!1);const d=R();C();var n=At();let s;var r=y(n),c=y(r),l=A(c,2),f=A(l,2);{var u=o=>{var b=It(),_=y(b,!0);w(b),U(()=>V(_,(q(t()),K(()=>t().annotations.length)))),m(o,b)};O(f,o=>{q(t()),K(()=>t().annotations.length>0)&&o(u)})}var h=A(f,2),E=y(h,!0);w(h),w(r),w(n),U(()=>{s=pe(n,1,"pair-item svelte-1tdzwuu",null,s,{selected:i()}),_e(c,"src",(q(t()),K(()=>t().thumbAUrl))),_e(l,"src",(q(t()),K(()=>t().thumbAUrl))),V(E,(q(t()),K(()=>t().label||t().id)))}),x("click",n,()=>d("select")),m(e,n),D()}var St=T('<div class="pair-list svelte-yi31ax"></div>');function zt(e,a){N(a,!1);let t=S(a,"imagePairs",24,()=>[]),i=S(a,"selectedId",8,null);const d=R();C();var n=St();et(n,5,t,Qe,(s,r)=>{{let c=Te(()=>(M(r),q(i()),K(()=>M(r).id===i())));Pt(s,{get pair(){return M(r)},get selected(){return M(c)},$$events:{select:()=>d("select",M(r))}})}}),w(n),m(e,n),D()}const jt={id:null,name:null,imagePairs:[]},G=ge(jt),de=ge(null);Ge([G,de],([e,a])=>!e||!a?null:e.imagePairs.find(t=>t.id===a)??null);function Mt(e){e.imagePairs.forEach(a=>{ae(a.imageAUrl),ae(a.imageBUrl),ae(a.thumbAUrl)})}function ae(e){typeof e=="string"&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}var xt=T('<div class="empty">No project loaded</div>'),Ct=T('<span slot="header" class="panel-title svelte-9kbugy">Images</span>'),Nt=T('<div class="app svelte-9kbugy"><!> <!> <div class="workspace svelte-9kbugy"><!></div> <!> <!></div>');function Dt(e,a){N(a,!1);const t=()=>re(G,"$projectStore",d),i=()=>re(de,"$selectedPairId",d),[d,n]=Ae();let s=X(!1),r=X(!1),c=X(!1);async function l(){B(c,!0);const{files:p,dir:g}=event.detail,v=get(G);v?.imagePairs&&Mt(v),projectDirHandle=g;const $=await loadProjectFromFiles(p);G.set($)}async function f(){console.log("Save project triggered"),lt("Project saved successfully!")}C();var u=Nt(),h=y(u);ct(h,{});var E=A(h,2);kt(E,{$$events:{"load-project":l,"save-project":f,help:()=>B(s,!0),about:()=>B(r,!0)}});var o=A(E,2),b=y(o);$t(b,{side:"left",get open(){return M(c)},set open(p){B(c,p)},children:(p,g)=>{var v=ce(),$=ue(v);{var j=k=>{zt(k,{get imagePairs(){return t().imagePairs},get selectedId(){return i()},$$events:{select:P=>de.set(P.detail.id)}})},F=k=>{var P=xt();m(k,P)};O($,k=>{t()?k(j):k(F,!1)})}m(p,v)},$$slots:{default:!0,header:(p,g)=>{var v=Ct();m(p,v)}},$$legacy:!0}),w(o);var _=A(o,2);vt(_,{get open(){return M(s)},set open(p){B(s,p)},$$legacy:!0});var I=A(_,2);pt(I,{get open(){return M(r)},set open(p){B(r,p)},$$legacy:!0}),w(u),m(e,u),D(),n()}var Lt=T('<meta name="description" content="Experimental image alignment and registration tool for research, exploration, and prototyping workflows."/>'),Ht=T('<main class="svelte-1uha8ag"><!></main>');function Vt(e){var a=Ht();We("1uha8ag",i=>{var d=Lt();Ye(()=>{Je.title="Image Alignment Tool"}),m(i,d)});var t=y(a);Dt(t,{}),w(a),m(e,a)}export{Vt as component};
