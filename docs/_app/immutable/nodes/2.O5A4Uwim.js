import{c as Re,a as H,f as W,t as dn}from"../chunks/di2HnnFg.js";import{i as he}from"../chunks/BRDZcglA.js";import{a as Hr,f as to,h as qe,j as Kr,k as ro,O as vs,z as T,Q as no,R as ao,S as jn,i as xr,e as It,C as so,aO as oo,az as On,c as Be,aU as We,b as fn,s as io,a9 as co,ae as vn,aM as gn,aV as uo,aW as lo,Z as re,an as Nn,aX as fo,r as gs,p as ys,aY as Gr,aZ as mo,aL as ho,d as po,g as vo,a_ as _s,q as go,a$ as yo,b0 as $s,T as bs,b1 as ws,b2 as _o,b3 as $o,W as Ss,aR as bo,w as se,U as wo,$ as So,E as pe,F as Pe,I as ve,J as x,K,G as ue,M as Y,aA as yn,_ as B,A as ge,b4 as Ae,b5 as ft,b6 as Eo,b7 as Po}from"../chunks/B0UgIJIf.js";import{a as Es,r as _n,s as yt,h as Io}from"../chunks/BkI0AhsY.js";import{i as ce,s as Je,a as Te,p as ye,b as Ps}from"../chunks/DjKhgHTo.js";import{s as _e,e as de}from"../chunks/7mphOOsT.js";import{w as Ye,c as et,o as Nr,d as He,g as be,a as Tr}from"../chunks/6TVv1XkF.js";function $n(e,t){return t}function ko(e,t,r){for(var n=[],c=t.length,a,o=t.length,s=0;s<c;s++){let w=t[s];ys(w,()=>{if(a){if(a.pending.delete(w),a.done.add(w),a.pending.size===0){var g=e.outrogroups;mn(gn(a.done)),g.delete(a),g.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=n.length===0&&r!==null;if(l){var v=r,f=v.parentNode;ho(f),f.append(v),e.items.clear()}mn(t,!l)}else a={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(a)}function mn(e,t=!0){for(var r=0;r<e.length;r++)po(e[r],t)}var Tn;function bt(e,t,r,n,c,a=null){var o=e,s=new Map,l=(t&_s)!==0;if(l){var v=e;o=qe?Kr(ro(v)):v.appendChild(Hr())}qe&&vs();var f=null,w=co(()=>{var d=r();return vn(d)?d:d==null?[]:gn(d)}),g,p=!0;function y(){i.fallback=f,Ro(i,g,o,t,n),f!==null&&(g.length===0?(f.f&We)===0?gs(f):(f.f^=We,_t(f,null,o)):ys(f,()=>{f=null}))}var _=to(()=>{g=T(w);var d=g.length;let u=!1;if(qe){var m=no(o)===ao;m!==(d===0)&&(o=jn(),Kr(o),xr(!1),u=!0)}for(var b=new Set,h=Be,$=io(),E=0;E<d;E+=1){qe&&It.nodeType===so&&It.data===oo&&(o=It,u=!0,xr(!1));var R=g[E],A=n(R,E),M=p?null:s.get(A);M?(M.v&&On(M.v,R),M.i&&On(M.i,E),$&&h.unskip_effect(M.e)):(M=jo(s,p?o:Tn??=Hr(),R,A,E,c,t,r),p||(M.e.f|=We),s.set(A,M)),b.add(A)}if(d===0&&a&&!f&&(p?f=fn(()=>a(o)):(f=fn(()=>a(Tn??=Hr())),f.f|=We)),qe&&d>0&&Kr(jn()),!p)if($){for(const[N,z]of s)b.has(N)||h.skip_effect(z.e);h.oncommit(y),h.ondiscard(()=>{})}else y();u&&xr(!0),T(w)}),i={effect:_,items:s,outrogroups:null,fallback:f};p=!1,qe&&(o=It)}function ht(e){for(;e!==null&&(e.f&mo)===0;)e=e.next;return e}function Ro(e,t,r,n,c){var a=(n&yo)!==0,o=t.length,s=e.items,l=ht(e.effect.first),v,f=null,w,g=[],p=[],y,_,i,d;if(a)for(d=0;d<o;d+=1)y=t[d],_=c(y,d),i=s.get(_).e,(i.f&We)===0&&(i.nodes?.a?.measure(),(w??=new Set).add(i));for(d=0;d<o;d+=1){if(y=t[d],_=c(y,d),i=s.get(_).e,e.outrogroups!==null)for(const M of e.outrogroups)M.pending.delete(i),M.done.delete(i);if((i.f&We)!==0)if(i.f^=We,i===l)_t(i,null,r);else{var u=f?f.next:l;i===e.effect.last&&(e.effect.last=i.prev),i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),Ze(e,f,i),Ze(e,i,u),_t(i,u,r),f=i,g=[],p=[],l=ht(f.next);continue}if((i.f&Gr)!==0&&(gs(i),a&&(i.nodes?.a?.unfix(),(w??=new Set).delete(i))),i!==l){if(v!==void 0&&v.has(i)){if(g.length<p.length){var m=p[0],b;f=m.prev;var h=g[0],$=g[g.length-1];for(b=0;b<g.length;b+=1)_t(g[b],m,r);for(b=0;b<p.length;b+=1)v.delete(p[b]);Ze(e,h.prev,$.next),Ze(e,f,h),Ze(e,$,m),l=m,f=$,d-=1,g=[],p=[]}else v.delete(i),_t(i,l,r),Ze(e,i.prev,i.next),Ze(e,i,f===null?e.effect.first:f.next),Ze(e,f,i),f=i;continue}for(g=[],p=[];l!==null&&l!==i;)(v??=new Set).add(l),p.push(l),l=ht(l.next);if(l===null)continue}(i.f&We)===0&&g.push(i),f=i,l=ht(i.next)}if(e.outrogroups!==null){for(const M of e.outrogroups)M.pending.size===0&&(mn(gn(M.done)),e.outrogroups?.delete(M));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||v!==void 0){var E=[];if(v!==void 0)for(i of v)(i.f&Gr)===0&&E.push(i);for(;l!==null;)(l.f&Gr)===0&&l!==e.fallback&&E.push(l),l=ht(l.next);var R=E.length;if(R>0){var A=(n&_s)!==0&&o===0?r:null;if(a){for(d=0;d<R;d+=1)E[d].nodes?.a?.measure();for(d=0;d<R;d+=1)E[d].nodes?.a?.fix()}ko(e,E,A)}}a&&go(()=>{if(w!==void 0)for(i of w)i.nodes?.a?.apply()})}function jo(e,t,r,n,c,a,o,s){var l=(o&uo)!==0?(o&lo)===0?re(r,!1,!1):Nn(r):null,v=(o&fo)!==0?Nn(c):null;return{v:l,i:v,e:fn(()=>(a(t,l??r,v??c,s),()=>{e.delete(n)}))}}function _t(e,t,r){if(e.nodes)for(var n=e.nodes.start,c=e.nodes.end,a=t&&(t.f&We)===0?t.nodes.start:r;n!==null;){var o=vo(n);if(a.before(n),n===c)return;n=o}}function Ze(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}function kr(e,t,r,n,c){qe&&vs();var a=t.$$slots?.[r],o=!1;a===!0&&(a=t[r==="default"?"children":r],o=!0),a===void 0||a(e,o?()=>n:n)}const Mn=[...` 	
\r\f \v\uFEFF`];function Oo(e,t,r){var n=e==null?"":""+e;if(t&&(n=n?n+" "+t:t),r){for(var c in r)if(r[c])n=n?n+" "+c:c;else if(n.length)for(var a=c.length,o=0;(o=n.indexOf(c,o))>=0;){var s=o+a;(o===0||Mn.includes(n[o-1]))&&(s===n.length||Mn.includes(n[s]))?n=(o===0?"":n.substring(0,o))+n.substring(s+1):o=s}}return n===""?null:n}function No(e,t){return e==null?null:String(e)}function st(e,t,r,n,c,a){var o=e.__className;if(qe||o!==r||o===void 0){var s=Oo(r,n,a);(!qe||s!==e.getAttribute("class"))&&(s==null?e.removeAttribute("class"):e.className=s),e.__className=r}else if(a&&c!==a)for(var l in a){var v=!!a[l];(c==null||v!==!!c[l])&&e.classList.toggle(l,v)}return a}function Le(e,t,r,n){var c=e.__style;if(qe||c!==t){var a=No(t);(!qe||a!==e.getAttribute("style"))&&(a==null?e.removeAttribute("style"):e.style.cssText=a),e.__style=t}return n}function Is(e,t,r=!1){if(e.multiple){if(t==null)return;if(!vn(t))return _o();for(var n of e.options)n.selected=t.includes($t(n));return}for(n of e.options){var c=$t(n);if($o(c,t)){n.selected=!0;return}}(!r||t!==void 0)&&(e.selectedIndex=-1)}function To(e){var t=new MutationObserver(()=>{Is(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ss(()=>{t.disconnect()})}function Mo(e,t,r=t){var n=new WeakSet,c=!0;$s(e,"change",a=>{var o=a?"[selected]":":checked",s;if(e.multiple)s=[].map.call(e.querySelectorAll(o),$t);else{var l=e.querySelector(o)??e.querySelector("option:not([disabled])");s=l&&$t(l)}r(s),Be!==null&&n.add(Be)}),bs(()=>{var a=t();if(e===document.activeElement){var o=ws??Be;if(n.has(o))return}if(Is(e,a,c),c&&a===void 0){var s=e.querySelector(":checked");s!==null&&(a=$t(s),r(a))}e.__value=a,c=!1}),To(e)}function $t(e){return"__value"in e?e.__value:e.value}function ks(e,t,r=t){var n=new WeakSet;$s(e,"input",async c=>{var a=c?e.defaultValue:e.value;if(a=Br(e)?Wr(a):a,r(a),Be!==null&&n.add(Be),await bo(),a!==(a=t())){var o=e.selectionStart,s=e.selectionEnd,l=e.value.length;if(e.value=a??"",s!==null){var v=e.value.length;o===s&&s===l&&v>l?(e.selectionStart=v,e.selectionEnd=v):(e.selectionStart=o,e.selectionEnd=Math.min(s,v))}}}),(qe&&e.defaultValue!==e.value||se(t)==null&&e.value)&&(r(Br(e)?Wr(e.value):e.value),Be!==null&&n.add(Be)),wo(()=>{var c=t();if(e===document.activeElement){var a=ws??Be;if(n.has(a))return}Br(e)&&c===Wr(e.value)||e.type==="date"&&!c&&!e.value||c!==e.value&&(e.value=c??"")})}function Br(e){var t=e.type;return t==="number"||t==="range"}function Wr(e){return e===""?null:+e}function dt(e,t,r){var n=So(e,t);n&&n.set&&(e[t]=r,Ss(()=>{e[t]=null}))}function qo(e){return function(...t){var r=t[0];return r.stopPropagation(),e?.apply(this,t)}}function Ao(e,t){var r=e.$$events?.[t.type],n=vn(r)?r.slice():r==null?[]:[r];for(var c of n)c.call(this,t)}const Co=Ye(null);var Do=W("<div> </div>");function zo(e,t){pe(t,!1);const r=()=>Te(Co,"$toast",n),[n,c]=Je();he();var a=Re(),o=Pe(a);{var s=l=>{var v=Do(),f=x(v,!0);K(v),ue(()=>{st(v,1,`toast ${r().type??""}`,"svelte-o7oz2i"),_e(f,r().message)}),H(l,v)};ce(o,l=>{r()&&l(s)})}H(e,a),ve(),c()}var Uo=W('<div class="backdrop svelte-116j06s"><div class="modal svelte-116j06s"><header class="modal-header svelte-116j06s"><div class="modal-title svelte-116j06s"><!></div> <button class="close-button svelte-116j06s" aria-label="Close">×</button></header> <div class="modal-body svelte-116j06s"><!></div></div></div>');function Rs(e,t){pe(t,!1);let r=ye(t,"open",8,!1),n=ye(t,"title",8,"");const c=et();function a(){c("close")}function o(f){f.key==="Escape"&&a()}Nr(()=>(window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o))),he();var s=Re(),l=Pe(s);{var v=f=>{var w=Uo(),g=x(w),p=x(g),y=x(p),_=x(y);{var i=b=>{var h=dn();ue(()=>_e(h,n())),H(b,h)};ce(_,b=>{n()&&b(i)})}K(y);var d=Y(y,2);K(p);var u=Y(p,2),m=x(u);kr(m,t,"default",{}),K(u),K(g),K(w),de("click",d,a),de("click",g,qo(function(b){Ao.call(this,t,b)})),de("click",w,a),H(f,w)};ce(l,f=>{r()&&f(v)})}H(e,s),ve()}var Vo=W(`<p>This tool prepares image sets for annotation by analysing a directory of images and generating
		paired (or grouped) image sets suitable for visual comparison and annotation.</p> <h3>Basic usage</h3> <ul><li>Select a directory containing related images</li> <li>The tool scans filenames and image characteristics to suggest image pairs</li> <li>Each pair is reviewed and assigned a base image</li> <li>A project file is generated for use in the annotation tool</li></ul> <h3>How image pairing works</h3> <ul><li>Initial pairing attempts are based on filename similarity and ordering</li> <li>Additional strategies may compare image dimensions and visual similarity</li> <li>Pairs can be adjusted manually where automatic matching is ambiguous</li></ul> <h3>Base image and coordinate system</h3> <ul><li>Each image pair has a designated base image</li> <li>The base image defines the coordinate system for annotations</li> <li>If required, a transformation can be applied to the base image to match the paired image</li></ul> <h3>Output</h3> <ul><li>The result is a <code>project.json</code> file</li> <li>This file can be opened directly in the annotation tool</li> <li>Image pairing, base image selection, and transformations are stored together</li></ul>`,1);function Lo(e,t){let r=ye(t,"open",12,!1);Rs(e,{get open(){return r()},title:"How to use this tool",$$events:{close:()=>r(!1)},children:(n,c)=>{var a=Vo();yn(16),H(n,a)},$$slots:{default:!0}})}var Fo=W(`<p>This application is designed to support the preparation stage of image-based annotation
		workflows. It focuses on organising collections of related images into structured pairs or
		groups that can be analysed and annotated consistently.</p> <p>Rather than annotating images directly, the tool generates structured project data that is
		consumed by the annotation viewer. This separation allows pairing, alignment, and annotation to
		be treated as distinct but connected stages in a broader workflow.</p> <h3>Image pairing and alignment</h3> <p>The tool attempts to identify related images using a combination of filename patterns and
		image-level characteristics. Once paired, a base image is selected to act as the coordinate
		reference for annotation placement.</p> <p>In cases where image dimensions differ, the base image may require a transformation to align it
		correctly with its paired image. Future versions of the tool are intended to integrate image
		alignment processes that automatically generate and store transformation matrices.</p> <h3>Technologies used</h3> <ul><li><a href="https://svelte.dev/docs/kit/introduction" target="_blank" rel="noopener noreferrer">SvelteKit</a> — application framework and UI architecture</li> <li>Client-side image processing techniques for analysis and comparison</li></ul> <p>The output of this tool is a structured <code>project.json</code> file that captures image pairings,
		base image definitions, and any associated transformations. This file is designed to be consumed by
		downstream tools in the annotation workflow.</p> <p class="muted">This is an experimental application and a work in progress, intended for research, exploration,
		and prototyping workflows.</p> <p class="muted">For any enquiries or suggestions for further development, please contact Christopher Wilson —
		Software Developer, Artificial Intelligence and Ideas Adoption (AIIA), The University of
		Manchester.</p>`,1);function Ho(e,t){let r=ye(t,"open",12,!1);Rs(e,{get open(){return r()},title:"About this tool",$$events:{close:()=>r(!1)},children:(n,c)=>{var a=Fo();yn(18),H(n,a)},$$slots:{default:!0}})}const qn={"0.1":xo};function Ko(e){let t=structuredClone(e);for(t.version||(t.version="0.1");qn[t.version];)t=qn[t.version](t);return t}function xo(e){return{...e,version:"0.2",annotations:e.annotations?e.annotations.map(t=>({...t,data:t.data||{}})):[]}}function js(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kt={exports:{}},Jr={},Ke={},tt={},Yr={},Xr={},Zr={},An;function Rr(){return An||(An=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(u){if(super(),!e.IDENTIFIER.test(u))throw new Error("CodeGen: name must be a valid identifier");this.str=u}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(u){super(),this._items=typeof u=="string"?[u]:u}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const u=this._items[0];return u===""||u==='""'}get str(){var u;return(u=this._str)!==null&&u!==void 0?u:this._str=this._items.reduce((m,b)=>`${m}${b}`,"")}get names(){var u;return(u=this._names)!==null&&u!==void 0?u:this._names=this._items.reduce((m,b)=>(b instanceof r&&(m[b.str]=(m[b.str]||0)+1),m),{})}}e._Code=n,e.nil=new n("");function c(d,...u){const m=[d[0]];let b=0;for(;b<u.length;)s(m,u[b]),m.push(d[++b]);return new n(m)}e._=c;const a=new n("+");function o(d,...u){const m=[p(d[0])];let b=0;for(;b<u.length;)m.push(a),s(m,u[b]),m.push(a,p(d[++b]));return l(m),new n(m)}e.str=o;function s(d,u){u instanceof n?d.push(...u._items):u instanceof r?d.push(u):d.push(w(u))}e.addCodeArg=s;function l(d){let u=1;for(;u<d.length-1;){if(d[u]===a){const m=v(d[u-1],d[u+1]);if(m!==void 0){d.splice(u-1,3,m);continue}d[u++]="+"}u++}}function v(d,u){if(u==='""')return d;if(d==='""')return u;if(typeof d=="string")return u instanceof r||d[d.length-1]!=='"'?void 0:typeof u!="string"?`${d.slice(0,-1)}${u}"`:u[0]==='"'?d.slice(0,-1)+u.slice(1):void 0;if(typeof u=="string"&&u[0]==='"'&&!(d instanceof r))return`"${d}${u.slice(1)}`}function f(d,u){return u.emptyStr()?d:d.emptyStr()?u:o`${d}${u}`}e.strConcat=f;function w(d){return typeof d=="number"||typeof d=="boolean"||d===null?d:p(Array.isArray(d)?d.join(","):d)}function g(d){return new n(p(d))}e.stringify=g;function p(d){return JSON.stringify(d).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=p;function y(d){return typeof d=="string"&&e.IDENTIFIER.test(d)?new n(`.${d}`):c`[${d}]`}e.getProperty=y;function _(d){if(typeof d=="string"&&e.IDENTIFIER.test(d))return new n(`${d}`);throw new Error(`CodeGen: invalid export name: ${d}, use explicit $id name mapping`)}e.getEsmExportName=_;function i(d){return new n(d.toString())}e.regexpCode=i})(Zr)),Zr}var Qr={},Cn;function Dn(){return Cn||(Cn=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=Rr();class r extends Error{constructor(v){super(`CodeGen: "code" for ${v} not defined`),this.value=v.value}}var n;(function(l){l[l.Started=0]="Started",l[l.Completed=1]="Completed"})(n||(e.UsedValueState=n={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class c{constructor({prefixes:v,parent:f}={}){this._names={},this._prefixes=v,this._parent=f}toName(v){return v instanceof t.Name?v:this.name(v)}name(v){return new t.Name(this._newName(v))}_newName(v){const f=this._names[v]||this._nameGroup(v);return`${v}${f.index++}`}_nameGroup(v){var f,w;if(!((w=(f=this._parent)===null||f===void 0?void 0:f._prefixes)===null||w===void 0)&&w.has(v)||this._prefixes&&!this._prefixes.has(v))throw new Error(`CodeGen: prefix "${v}" is not allowed in this scope`);return this._names[v]={prefix:v,index:0}}}e.Scope=c;class a extends t.Name{constructor(v,f){super(f),this.prefix=v}setValue(v,{property:f,itemIndex:w}){this.value=v,this.scopePath=(0,t._)`.${new t.Name(f)}[${w}]`}}e.ValueScopeName=a;const o=(0,t._)`\n`;class s extends c{constructor(v){super(v),this._values={},this._scope=v.scope,this.opts={...v,_n:v.lines?o:t.nil}}get(){return this._scope}name(v){return new a(v,this._newName(v))}value(v,f){var w;if(f.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const g=this.toName(v),{prefix:p}=g,y=(w=f.key)!==null&&w!==void 0?w:f.ref;let _=this._values[p];if(_){const u=_.get(y);if(u)return u}else _=this._values[p]=new Map;_.set(y,g);const i=this._scope[p]||(this._scope[p]=[]),d=i.length;return i[d]=f.ref,g.setValue(f,{property:p,itemIndex:d}),g}getValue(v,f){const w=this._values[v];if(w)return w.get(f)}scopeRefs(v,f=this._values){return this._reduceValues(f,w=>{if(w.scopePath===void 0)throw new Error(`CodeGen: name "${w}" has no value`);return(0,t._)`${v}${w.scopePath}`})}scopeCode(v=this._values,f,w){return this._reduceValues(v,g=>{if(g.value===void 0)throw new Error(`CodeGen: name "${g}" has no value`);return g.value.code},f,w)}_reduceValues(v,f,w={},g){let p=t.nil;for(const y in v){const _=v[y];if(!_)continue;const i=w[y]=w[y]||new Map;_.forEach(d=>{if(i.has(d))return;i.set(d,n.Started);let u=f(d);if(u){const m=this.opts.es5?e.varKinds.var:e.varKinds.const;p=(0,t._)`${p}${m} ${d} = ${u};${this.opts._n}`}else if(u=g?.(d))p=(0,t._)`${p}${u}${this.opts._n}`;else throw new r(d);i.set(d,n.Completed)})}return p}}e.ValueScope=s})(Qr)),Qr}var zn;function Q(){return zn||(zn=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=Rr(),r=Dn();var n=Rr();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var c=Dn();Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return c.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return c.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return c.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return c.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class a{optimizeNodes(){return this}optimizeNames(S,P){return this}}class o extends a{constructor(S,P,q){super(),this.varKind=S,this.name=P,this.rhs=q}render({es5:S,_n:P}){const q=S?r.varKinds.var:this.varKind,G=this.rhs===void 0?"":` = ${this.rhs}`;return`${q} ${this.name}${G};`+P}optimizeNames(S,P){if(S[this.name.str])return this.rhs&&(this.rhs=U(this.rhs,S,P)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class s extends a{constructor(S,P,q){super(),this.lhs=S,this.rhs=P,this.sideEffects=q}render({_n:S}){return`${this.lhs} = ${this.rhs};`+S}optimizeNames(S,P){if(!(this.lhs instanceof t.Name&&!S[this.lhs.str]&&!this.sideEffects))return this.rhs=U(this.rhs,S,P),this}get names(){const S=this.lhs instanceof t.Name?{}:{...this.lhs.names};return L(S,this.rhs)}}class l extends s{constructor(S,P,q,G){super(S,q,G),this.op=P}render({_n:S}){return`${this.lhs} ${this.op}= ${this.rhs};`+S}}class v extends a{constructor(S){super(),this.label=S,this.names={}}render({_n:S}){return`${this.label}:`+S}}class f extends a{constructor(S){super(),this.label=S,this.names={}}render({_n:S}){return`break${this.label?` ${this.label}`:""};`+S}}class w extends a{constructor(S){super(),this.error=S}render({_n:S}){return`throw ${this.error};`+S}get names(){return this.error.names}}class g extends a{constructor(S){super(),this.code=S}render({_n:S}){return`${this.code};`+S}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(S,P){return this.code=U(this.code,S,P),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class p extends a{constructor(S=[]){super(),this.nodes=S}render(S){return this.nodes.reduce((P,q)=>P+q.render(S),"")}optimizeNodes(){const{nodes:S}=this;let P=S.length;for(;P--;){const q=S[P].optimizeNodes();Array.isArray(q)?S.splice(P,1,...q):q?S[P]=q:S.splice(P,1)}return S.length>0?this:void 0}optimizeNames(S,P){const{nodes:q}=this;let G=q.length;for(;G--;){const X=q[G];X.optimizeNames(S,P)||(Z(S,X.names),q.splice(G,1))}return q.length>0?this:void 0}get names(){return this.nodes.reduce((S,P)=>z(S,P.names),{})}}class y extends p{render(S){return"{"+S._n+super.render(S)+"}"+S._n}}class _ extends p{}class i extends y{}i.kind="else";class d extends y{constructor(S,P){super(P),this.condition=S}render(S){let P=`if(${this.condition})`+super.render(S);return this.else&&(P+="else "+this.else.render(S)),P}optimizeNodes(){super.optimizeNodes();const S=this.condition;if(S===!0)return this.nodes;let P=this.else;if(P){const q=P.optimizeNodes();P=this.else=Array.isArray(q)?new i(q):q}if(P)return S===!1?P instanceof d?P:P.nodes:this.nodes.length?this:new d(me(S),P instanceof d?[P]:P.nodes);if(!(S===!1||!this.nodes.length))return this}optimizeNames(S,P){var q;if(this.else=(q=this.else)===null||q===void 0?void 0:q.optimizeNames(S,P),!!(super.optimizeNames(S,P)||this.else))return this.condition=U(this.condition,S,P),this}get names(){const S=super.names;return L(S,this.condition),this.else&&z(S,this.else.names),S}}d.kind="if";class u extends y{}u.kind="for";class m extends u{constructor(S){super(),this.iteration=S}render(S){return`for(${this.iteration})`+super.render(S)}optimizeNames(S,P){if(super.optimizeNames(S,P))return this.iteration=U(this.iteration,S,P),this}get names(){return z(super.names,this.iteration.names)}}class b extends u{constructor(S,P,q,G){super(),this.varKind=S,this.name=P,this.from=q,this.to=G}render(S){const P=S.es5?r.varKinds.var:this.varKind,{name:q,from:G,to:X}=this;return`for(${P} ${q}=${G}; ${q}<${X}; ${q}++)`+super.render(S)}get names(){const S=L(super.names,this.from);return L(S,this.to)}}class h extends u{constructor(S,P,q,G){super(),this.loop=S,this.varKind=P,this.name=q,this.iterable=G}render(S){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(S)}optimizeNames(S,P){if(super.optimizeNames(S,P))return this.iterable=U(this.iterable,S,P),this}get names(){return z(super.names,this.iterable.names)}}class $ extends y{constructor(S,P,q){super(),this.name=S,this.args=P,this.async=q}render(S){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(S)}}$.kind="func";class E extends p{render(S){return"return "+super.render(S)}}E.kind="return";class R extends y{render(S){let P="try"+super.render(S);return this.catch&&(P+=this.catch.render(S)),this.finally&&(P+=this.finally.render(S)),P}optimizeNodes(){var S,P;return super.optimizeNodes(),(S=this.catch)===null||S===void 0||S.optimizeNodes(),(P=this.finally)===null||P===void 0||P.optimizeNodes(),this}optimizeNames(S,P){var q,G;return super.optimizeNames(S,P),(q=this.catch)===null||q===void 0||q.optimizeNames(S,P),(G=this.finally)===null||G===void 0||G.optimizeNames(S,P),this}get names(){const S=super.names;return this.catch&&z(S,this.catch.names),this.finally&&z(S,this.finally.names),S}}class A extends y{constructor(S){super(),this.error=S}render(S){return`catch(${this.error})`+super.render(S)}}A.kind="catch";class M extends y{render(S){return"finally"+super.render(S)}}M.kind="finally";class N{constructor(S,P={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...P,_n:P.lines?`
`:""},this._extScope=S,this._scope=new r.Scope({parent:S}),this._nodes=[new _]}toString(){return this._root.render(this.opts)}name(S){return this._scope.name(S)}scopeName(S){return this._extScope.name(S)}scopeValue(S,P){const q=this._extScope.value(S,P);return(this._values[q.prefix]||(this._values[q.prefix]=new Set)).add(q),q}getScopeValue(S,P){return this._extScope.getValue(S,P)}scopeRefs(S){return this._extScope.scopeRefs(S,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(S,P,q,G){const X=this._scope.toName(P);return q!==void 0&&G&&(this._constants[X.str]=q),this._leafNode(new o(S,X,q)),X}const(S,P,q){return this._def(r.varKinds.const,S,P,q)}let(S,P,q){return this._def(r.varKinds.let,S,P,q)}var(S,P,q){return this._def(r.varKinds.var,S,P,q)}assign(S,P,q){return this._leafNode(new s(S,P,q))}add(S,P){return this._leafNode(new l(S,e.operators.ADD,P))}code(S){return typeof S=="function"?S():S!==t.nil&&this._leafNode(new g(S)),this}object(...S){const P=["{"];for(const[q,G]of S)P.length>1&&P.push(","),P.push(q),(q!==G||this.opts.es5)&&(P.push(":"),(0,t.addCodeArg)(P,G));return P.push("}"),new t._Code(P)}if(S,P,q){if(this._blockNode(new d(S)),P&&q)this.code(P).else().code(q).endIf();else if(P)this.code(P).endIf();else if(q)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(S){return this._elseNode(new d(S))}else(){return this._elseNode(new i)}endIf(){return this._endBlockNode(d,i)}_for(S,P){return this._blockNode(S),P&&this.code(P).endFor(),this}for(S,P){return this._for(new m(S),P)}forRange(S,P,q,G,X=this.opts.es5?r.varKinds.var:r.varKinds.let){const ie=this._scope.toName(S);return this._for(new b(X,ie,P,q),()=>G(ie))}forOf(S,P,q,G=r.varKinds.const){const X=this._scope.toName(S);if(this.opts.es5){const ie=P instanceof t.Name?P:this.var("_arr",P);return this.forRange("_i",0,(0,t._)`${ie}.length`,ae=>{this.var(X,(0,t._)`${ie}[${ae}]`),q(X)})}return this._for(new h("of",G,X,P),()=>q(X))}forIn(S,P,q,G=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(S,(0,t._)`Object.keys(${P})`,q);const X=this._scope.toName(S);return this._for(new h("in",G,X,P),()=>q(X))}endFor(){return this._endBlockNode(u)}label(S){return this._leafNode(new v(S))}break(S){return this._leafNode(new f(S))}return(S){const P=new E;if(this._blockNode(P),this.code(S),P.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(E)}try(S,P,q){if(!P&&!q)throw new Error('CodeGen: "try" without "catch" and "finally"');const G=new R;if(this._blockNode(G),this.code(S),P){const X=this.name("e");this._currNode=G.catch=new A(X),P(X)}return q&&(this._currNode=G.finally=new M,this.code(q)),this._endBlockNode(A,M)}throw(S){return this._leafNode(new w(S))}block(S,P){return this._blockStarts.push(this._nodes.length),S&&this.code(S).endBlock(P),this}endBlock(S){const P=this._blockStarts.pop();if(P===void 0)throw new Error("CodeGen: not in self-balancing block");const q=this._nodes.length-P;if(q<0||S!==void 0&&q!==S)throw new Error(`CodeGen: wrong number of nodes: ${q} vs ${S} expected`);return this._nodes.length=P,this}func(S,P=t.nil,q,G){return this._blockNode(new $(S,P,q)),G&&this.code(G).endFunc(),this}endFunc(){return this._endBlockNode($)}optimize(S=1){for(;S-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(S){return this._currNode.nodes.push(S),this}_blockNode(S){this._currNode.nodes.push(S),this._nodes.push(S)}_endBlockNode(S,P){const q=this._currNode;if(q instanceof S||P&&q instanceof P)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${P?`${S.kind}/${P.kind}`:S.kind}"`)}_elseNode(S){const P=this._currNode;if(!(P instanceof d))throw new Error('CodeGen: "else" without "if"');return this._currNode=P.else=S,this}get _root(){return this._nodes[0]}get _currNode(){const S=this._nodes;return S[S.length-1]}set _currNode(S){const P=this._nodes;P[P.length-1]=S}}e.CodeGen=N;function z(O,S){for(const P in S)O[P]=(O[P]||0)+(S[P]||0);return O}function L(O,S){return S instanceof t._CodeOrName?z(O,S.names):O}function U(O,S,P){if(O instanceof t.Name)return q(O);if(!G(O))return O;return new t._Code(O._items.reduce((X,ie)=>(ie instanceof t.Name&&(ie=q(ie)),ie instanceof t._Code?X.push(...ie._items):X.push(ie),X),[]));function q(X){const ie=P[X.str];return ie===void 0||S[X.str]!==1?X:(delete S[X.str],ie)}function G(X){return X instanceof t._Code&&X._items.some(ie=>ie instanceof t.Name&&S[ie.str]===1&&P[ie.str]!==void 0)}}function Z(O,S){for(const P in S)O[P]=(O[P]||0)-(S[P]||0)}function me(O){return typeof O=="boolean"||typeof O=="number"||O===null?!O:(0,t._)`!${D(O)}`}e.not=me;const $e=k(e.operators.AND);function oe(...O){return O.reduce($e)}e.and=oe;const Ce=k(e.operators.OR);function V(...O){return O.reduce(Ce)}e.or=V;function k(O){return(S,P)=>S===t.nil?P:P===t.nil?S:(0,t._)`${D(S)} ${O} ${D(P)}`}function D(O){return O instanceof t.Name?O:(0,t._)`(${O})`}})(Xr)),Xr}var ee={},Un;function ne(){if(Un)return ee;Un=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.checkStrictMode=ee.getErrorPath=ee.Type=ee.useFunc=ee.setEvaluated=ee.evaluatedPropsToName=ee.mergeEvaluated=ee.eachItem=ee.unescapeJsonPointer=ee.escapeJsonPointer=ee.escapeFragment=ee.unescapeFragment=ee.schemaRefOrVal=ee.schemaHasRulesButRef=ee.schemaHasRules=ee.checkUnknownRules=ee.alwaysValidSchema=ee.toHash=void 0;const e=Q(),t=Rr();function r(h){const $={};for(const E of h)$[E]=!0;return $}ee.toHash=r;function n(h,$){return typeof $=="boolean"?$:Object.keys($).length===0?!0:(c(h,$),!a($,h.self.RULES.all))}ee.alwaysValidSchema=n;function c(h,$=h.schema){const{opts:E,self:R}=h;if(!E.strictSchema||typeof $=="boolean")return;const A=R.RULES.keywords;for(const M in $)A[M]||b(h,`unknown keyword: "${M}"`)}ee.checkUnknownRules=c;function a(h,$){if(typeof h=="boolean")return!h;for(const E in h)if($[E])return!0;return!1}ee.schemaHasRules=a;function o(h,$){if(typeof h=="boolean")return!h;for(const E in h)if(E!=="$ref"&&$.all[E])return!0;return!1}ee.schemaHasRulesButRef=o;function s({topSchemaRef:h,schemaPath:$},E,R,A){if(!A){if(typeof E=="number"||typeof E=="boolean")return E;if(typeof E=="string")return(0,e._)`${E}`}return(0,e._)`${h}${$}${(0,e.getProperty)(R)}`}ee.schemaRefOrVal=s;function l(h){return w(decodeURIComponent(h))}ee.unescapeFragment=l;function v(h){return encodeURIComponent(f(h))}ee.escapeFragment=v;function f(h){return typeof h=="number"?`${h}`:h.replace(/~/g,"~0").replace(/\//g,"~1")}ee.escapeJsonPointer=f;function w(h){return h.replace(/~1/g,"/").replace(/~0/g,"~")}ee.unescapeJsonPointer=w;function g(h,$){if(Array.isArray(h))for(const E of h)$(E);else $(h)}ee.eachItem=g;function p({mergeNames:h,mergeToName:$,mergeValues:E,resultToName:R}){return(A,M,N,z)=>{const L=N===void 0?M:N instanceof e.Name?(M instanceof e.Name?h(A,M,N):$(A,M,N),N):M instanceof e.Name?($(A,N,M),M):E(M,N);return z===e.Name&&!(L instanceof e.Name)?R(A,L):L}}ee.mergeEvaluated={props:p({mergeNames:(h,$,E)=>h.if((0,e._)`${E} !== true && ${$} !== undefined`,()=>{h.if((0,e._)`${$} === true`,()=>h.assign(E,!0),()=>h.assign(E,(0,e._)`${E} || {}`).code((0,e._)`Object.assign(${E}, ${$})`))}),mergeToName:(h,$,E)=>h.if((0,e._)`${E} !== true`,()=>{$===!0?h.assign(E,!0):(h.assign(E,(0,e._)`${E} || {}`),_(h,E,$))}),mergeValues:(h,$)=>h===!0?!0:{...h,...$},resultToName:y}),items:p({mergeNames:(h,$,E)=>h.if((0,e._)`${E} !== true && ${$} !== undefined`,()=>h.assign(E,(0,e._)`${$} === true ? true : ${E} > ${$} ? ${E} : ${$}`)),mergeToName:(h,$,E)=>h.if((0,e._)`${E} !== true`,()=>h.assign(E,$===!0?!0:(0,e._)`${E} > ${$} ? ${E} : ${$}`)),mergeValues:(h,$)=>h===!0?!0:Math.max(h,$),resultToName:(h,$)=>h.var("items",$)})};function y(h,$){if($===!0)return h.var("props",!0);const E=h.var("props",(0,e._)`{}`);return $!==void 0&&_(h,E,$),E}ee.evaluatedPropsToName=y;function _(h,$,E){Object.keys(E).forEach(R=>h.assign((0,e._)`${$}${(0,e.getProperty)(R)}`,!0))}ee.setEvaluated=_;const i={};function d(h,$){return h.scopeValue("func",{ref:$,code:i[$.code]||(i[$.code]=new t._Code($.code))})}ee.useFunc=d;var u;(function(h){h[h.Num=0]="Num",h[h.Str=1]="Str"})(u||(ee.Type=u={}));function m(h,$,E){if(h instanceof e.Name){const R=$===u.Num;return E?R?(0,e._)`"[" + ${h} + "]"`:(0,e._)`"['" + ${h} + "']"`:R?(0,e._)`"/" + ${h}`:(0,e._)`"/" + ${h}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return E?(0,e.getProperty)(h).toString():"/"+f(h)}ee.getErrorPath=m;function b(h,$,E=h.opts.strictSchema){if(E){if($=`strict mode: ${$}`,E===!0)throw new Error($);h.self.logger.warn($)}}return ee.checkStrictMode=b,ee}var Rt={},Vn;function Ue(){if(Vn)return Rt;Vn=1,Object.defineProperty(Rt,"__esModule",{value:!0});const e=Q(),t={data:new e.Name("data"),valCxt:new e.Name("valCxt"),instancePath:new e.Name("instancePath"),parentData:new e.Name("parentData"),parentDataProperty:new e.Name("parentDataProperty"),rootData:new e.Name("rootData"),dynamicAnchors:new e.Name("dynamicAnchors"),vErrors:new e.Name("vErrors"),errors:new e.Name("errors"),this:new e.Name("this"),self:new e.Name("self"),scope:new e.Name("scope"),json:new e.Name("json"),jsonPos:new e.Name("jsonPos"),jsonLen:new e.Name("jsonLen"),jsonPart:new e.Name("jsonPart")};return Rt.default=t,Rt}var Ln;function Mr(){return Ln||(Ln=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=Q(),r=ne(),n=Ue();e.keywordError={message:({keyword:i})=>(0,t.str)`must pass "${i}" keyword validation`},e.keyword$DataError={message:({keyword:i,schemaType:d})=>d?(0,t.str)`"${i}" keyword must be ${d} ($data)`:(0,t.str)`"${i}" keyword is invalid ($data)`};function c(i,d=e.keywordError,u,m){const{it:b}=i,{gen:h,compositeRule:$,allErrors:E}=b,R=w(i,d,u);m??($||E)?l(h,R):v(b,(0,t._)`[${R}]`)}e.reportError=c;function a(i,d=e.keywordError,u){const{it:m}=i,{gen:b,compositeRule:h,allErrors:$}=m,E=w(i,d,u);l(b,E),h||$||v(m,n.default.vErrors)}e.reportExtraError=a;function o(i,d){i.assign(n.default.errors,d),i.if((0,t._)`${n.default.vErrors} !== null`,()=>i.if(d,()=>i.assign((0,t._)`${n.default.vErrors}.length`,d),()=>i.assign(n.default.vErrors,null)))}e.resetErrorsCount=o;function s({gen:i,keyword:d,schemaValue:u,data:m,errsCount:b,it:h}){if(b===void 0)throw new Error("ajv implementation error");const $=i.name("err");i.forRange("i",b,n.default.errors,E=>{i.const($,(0,t._)`${n.default.vErrors}[${E}]`),i.if((0,t._)`${$}.instancePath === undefined`,()=>i.assign((0,t._)`${$}.instancePath`,(0,t.strConcat)(n.default.instancePath,h.errorPath))),i.assign((0,t._)`${$}.schemaPath`,(0,t.str)`${h.errSchemaPath}/${d}`),h.opts.verbose&&(i.assign((0,t._)`${$}.schema`,u),i.assign((0,t._)`${$}.data`,m))})}e.extendErrors=s;function l(i,d){const u=i.const("err",d);i.if((0,t._)`${n.default.vErrors} === null`,()=>i.assign(n.default.vErrors,(0,t._)`[${u}]`),(0,t._)`${n.default.vErrors}.push(${u})`),i.code((0,t._)`${n.default.errors}++`)}function v(i,d){const{gen:u,validateName:m,schemaEnv:b}=i;b.$async?u.throw((0,t._)`new ${i.ValidationError}(${d})`):(u.assign((0,t._)`${m}.errors`,d),u.return(!1))}const f={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function w(i,d,u){const{createErrors:m}=i.it;return m===!1?(0,t._)`{}`:g(i,d,u)}function g(i,d,u={}){const{gen:m,it:b}=i,h=[p(b,u),y(i,u)];return _(i,d,h),m.object(...h)}function p({errorPath:i},{instancePath:d}){const u=d?(0,t.str)`${i}${(0,r.getErrorPath)(d,r.Type.Str)}`:i;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,u)]}function y({keyword:i,it:{errSchemaPath:d}},{schemaPath:u,parentSchema:m}){let b=m?d:(0,t.str)`${d}/${i}`;return u&&(b=(0,t.str)`${b}${(0,r.getErrorPath)(u,r.Type.Str)}`),[f.schemaPath,b]}function _(i,{params:d,message:u},m){const{keyword:b,data:h,schemaValue:$,it:E}=i,{opts:R,propertyName:A,topSchemaRef:M,schemaPath:N}=E;m.push([f.keyword,b],[f.params,typeof d=="function"?d(i):d||(0,t._)`{}`]),R.messages&&m.push([f.message,typeof u=="function"?u(i):u]),R.verbose&&m.push([f.schema,$],[f.parentSchema,(0,t._)`${M}${N}`],[n.default.data,h]),A&&m.push([f.propertyName,A])}})(Yr)),Yr}var Fn;function Go(){if(Fn)return tt;Fn=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.boolOrEmptySchema=tt.topBoolOrEmptySchema=void 0;const e=Mr(),t=Q(),r=Ue(),n={message:"boolean schema is false"};function c(s){const{gen:l,schema:v,validateName:f}=s;v===!1?o(s,!1):typeof v=="object"&&v.$async===!0?l.return(r.default.data):(l.assign((0,t._)`${f}.errors`,null),l.return(!0))}tt.topBoolOrEmptySchema=c;function a(s,l){const{gen:v,schema:f}=s;f===!1?(v.var(l,!1),o(s)):v.var(l,!0)}tt.boolOrEmptySchema=a;function o(s,l){const{gen:v,data:f}=s,w={gen:v,keyword:"false schema",data:f,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:s};(0,e.reportError)(w,n,void 0,l)}return tt}var Ee={},rt={},Hn;function Os(){if(Hn)return rt;Hn=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.getRules=rt.isJSONType=void 0;const e=["string","number","integer","boolean","null","object","array"],t=new Set(e);function r(c){return typeof c=="string"&&t.has(c)}rt.isJSONType=r;function n(){const c={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...c,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},c.number,c.string,c.array,c.object],post:{rules:[]},all:{},keywords:{}}}return rt.getRules=n,rt}var xe={},Kn;function Ns(){if(Kn)return xe;Kn=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.shouldUseRule=xe.shouldUseGroup=xe.schemaHasRulesForType=void 0;function e({schema:n,self:c},a){const o=c.RULES.types[a];return o&&o!==!0&&t(n,o)}xe.schemaHasRulesForType=e;function t(n,c){return c.rules.some(a=>r(n,a))}xe.shouldUseGroup=t;function r(n,c){var a;return n[c.keyword]!==void 0||((a=c.definition.implements)===null||a===void 0?void 0:a.some(o=>n[o]!==void 0))}return xe.shouldUseRule=r,xe}var xn;function jr(){if(xn)return Ee;xn=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.reportTypeError=Ee.checkDataTypes=Ee.checkDataType=Ee.coerceAndCheckDataType=Ee.getJSONTypes=Ee.getSchemaTypes=Ee.DataType=void 0;const e=Os(),t=Ns(),r=Mr(),n=Q(),c=ne();var a;(function(u){u[u.Correct=0]="Correct",u[u.Wrong=1]="Wrong"})(a||(Ee.DataType=a={}));function o(u){const m=s(u.type);if(m.includes("null")){if(u.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!m.length&&u.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');u.nullable===!0&&m.push("null")}return m}Ee.getSchemaTypes=o;function s(u){const m=Array.isArray(u)?u:u?[u]:[];if(m.every(e.isJSONType))return m;throw new Error("type must be JSONType or JSONType[]: "+m.join(","))}Ee.getJSONTypes=s;function l(u,m){const{gen:b,data:h,opts:$}=u,E=f(m,$.coerceTypes),R=m.length>0&&!(E.length===0&&m.length===1&&(0,t.schemaHasRulesForType)(u,m[0]));if(R){const A=y(m,h,$.strictNumbers,a.Wrong);b.if(A,()=>{E.length?w(u,m,E):i(u)})}return R}Ee.coerceAndCheckDataType=l;const v=new Set(["string","number","integer","boolean","null"]);function f(u,m){return m?u.filter(b=>v.has(b)||m==="array"&&b==="array"):[]}function w(u,m,b){const{gen:h,data:$,opts:E}=u,R=h.let("dataType",(0,n._)`typeof ${$}`),A=h.let("coerced",(0,n._)`undefined`);E.coerceTypes==="array"&&h.if((0,n._)`${R} == 'object' && Array.isArray(${$}) && ${$}.length == 1`,()=>h.assign($,(0,n._)`${$}[0]`).assign(R,(0,n._)`typeof ${$}`).if(y(m,$,E.strictNumbers),()=>h.assign(A,$))),h.if((0,n._)`${A} !== undefined`);for(const N of b)(v.has(N)||N==="array"&&E.coerceTypes==="array")&&M(N);h.else(),i(u),h.endIf(),h.if((0,n._)`${A} !== undefined`,()=>{h.assign($,A),g(u,A)});function M(N){switch(N){case"string":h.elseIf((0,n._)`${R} == "number" || ${R} == "boolean"`).assign(A,(0,n._)`"" + ${$}`).elseIf((0,n._)`${$} === null`).assign(A,(0,n._)`""`);return;case"number":h.elseIf((0,n._)`${R} == "boolean" || ${$} === null
              || (${R} == "string" && ${$} && ${$} == +${$})`).assign(A,(0,n._)`+${$}`);return;case"integer":h.elseIf((0,n._)`${R} === "boolean" || ${$} === null
              || (${R} === "string" && ${$} && ${$} == +${$} && !(${$} % 1))`).assign(A,(0,n._)`+${$}`);return;case"boolean":h.elseIf((0,n._)`${$} === "false" || ${$} === 0 || ${$} === null`).assign(A,!1).elseIf((0,n._)`${$} === "true" || ${$} === 1`).assign(A,!0);return;case"null":h.elseIf((0,n._)`${$} === "" || ${$} === 0 || ${$} === false`),h.assign(A,null);return;case"array":h.elseIf((0,n._)`${R} === "string" || ${R} === "number"
              || ${R} === "boolean" || ${$} === null`).assign(A,(0,n._)`[${$}]`)}}}function g({gen:u,parentData:m,parentDataProperty:b},h){u.if((0,n._)`${m} !== undefined`,()=>u.assign((0,n._)`${m}[${b}]`,h))}function p(u,m,b,h=a.Correct){const $=h===a.Correct?n.operators.EQ:n.operators.NEQ;let E;switch(u){case"null":return(0,n._)`${m} ${$} null`;case"array":E=(0,n._)`Array.isArray(${m})`;break;case"object":E=(0,n._)`${m} && typeof ${m} == "object" && !Array.isArray(${m})`;break;case"integer":E=R((0,n._)`!(${m} % 1) && !isNaN(${m})`);break;case"number":E=R();break;default:return(0,n._)`typeof ${m} ${$} ${u}`}return h===a.Correct?E:(0,n.not)(E);function R(A=n.nil){return(0,n.and)((0,n._)`typeof ${m} == "number"`,A,b?(0,n._)`isFinite(${m})`:n.nil)}}Ee.checkDataType=p;function y(u,m,b,h){if(u.length===1)return p(u[0],m,b,h);let $;const E=(0,c.toHash)(u);if(E.array&&E.object){const R=(0,n._)`typeof ${m} != "object"`;$=E.null?R:(0,n._)`!${m} || ${R}`,delete E.null,delete E.array,delete E.object}else $=n.nil;E.number&&delete E.integer;for(const R in E)$=(0,n.and)($,p(R,m,b,h));return $}Ee.checkDataTypes=y;const _={message:({schema:u})=>`must be ${u}`,params:({schema:u,schemaValue:m})=>typeof u=="string"?(0,n._)`{type: ${u}}`:(0,n._)`{type: ${m}}`};function i(u){const m=d(u);(0,r.reportError)(m,_)}Ee.reportTypeError=i;function d(u){const{gen:m,data:b,schema:h}=u,$=(0,c.schemaRefOrVal)(u,h,"type");return{gen:m,keyword:"type",data:b,schema:h.type,schemaCode:$,schemaValue:$,parentSchema:h,params:{},it:u}}return Ee}var pt={},Gn;function Bo(){if(Gn)return pt;Gn=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.assignDefaults=void 0;const e=Q(),t=ne();function r(c,a){const{properties:o,items:s}=c.schema;if(a==="object"&&o)for(const l in o)n(c,l,o[l].default);else a==="array"&&Array.isArray(s)&&s.forEach((l,v)=>n(c,v,l.default))}pt.assignDefaults=r;function n(c,a,o){const{gen:s,compositeRule:l,data:v,opts:f}=c;if(o===void 0)return;const w=(0,e._)`${v}${(0,e.getProperty)(a)}`;if(l){(0,t.checkStrictMode)(c,`default is ignored for: ${w}`);return}let g=(0,e._)`${w} === undefined`;f.useDefaults==="empty"&&(g=(0,e._)`${g} || ${w} === null || ${w} === ""`),s.if(g,(0,e._)`${w} = ${(0,e.stringify)(o)}`)}return pt}var ze={},le={},Bn;function Ve(){if(Bn)return le;Bn=1,Object.defineProperty(le,"__esModule",{value:!0}),le.validateUnion=le.validateArray=le.usePattern=le.callValidateCode=le.schemaProperties=le.allSchemaProperties=le.noPropertyInData=le.propertyInData=le.isOwnProperty=le.hasPropFunc=le.reportMissingProp=le.checkMissingProp=le.checkReportMissingProp=void 0;const e=Q(),t=ne(),r=Ue(),n=ne();function c(u,m){const{gen:b,data:h,it:$}=u;b.if(f(b,h,m,$.opts.ownProperties),()=>{u.setParams({missingProperty:(0,e._)`${m}`},!0),u.error()})}le.checkReportMissingProp=c;function a({gen:u,data:m,it:{opts:b}},h,$){return(0,e.or)(...h.map(E=>(0,e.and)(f(u,m,E,b.ownProperties),(0,e._)`${$} = ${E}`)))}le.checkMissingProp=a;function o(u,m){u.setParams({missingProperty:m},!0),u.error()}le.reportMissingProp=o;function s(u){return u.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,e._)`Object.prototype.hasOwnProperty`})}le.hasPropFunc=s;function l(u,m,b){return(0,e._)`${s(u)}.call(${m}, ${b})`}le.isOwnProperty=l;function v(u,m,b,h){const $=(0,e._)`${m}${(0,e.getProperty)(b)} !== undefined`;return h?(0,e._)`${$} && ${l(u,m,b)}`:$}le.propertyInData=v;function f(u,m,b,h){const $=(0,e._)`${m}${(0,e.getProperty)(b)} === undefined`;return h?(0,e.or)($,(0,e.not)(l(u,m,b))):$}le.noPropertyInData=f;function w(u){return u?Object.keys(u).filter(m=>m!=="__proto__"):[]}le.allSchemaProperties=w;function g(u,m){return w(m).filter(b=>!(0,t.alwaysValidSchema)(u,m[b]))}le.schemaProperties=g;function p({schemaCode:u,data:m,it:{gen:b,topSchemaRef:h,schemaPath:$,errorPath:E},it:R},A,M,N){const z=N?(0,e._)`${u}, ${m}, ${h}${$}`:m,L=[[r.default.instancePath,(0,e.strConcat)(r.default.instancePath,E)],[r.default.parentData,R.parentData],[r.default.parentDataProperty,R.parentDataProperty],[r.default.rootData,r.default.rootData]];R.opts.dynamicRef&&L.push([r.default.dynamicAnchors,r.default.dynamicAnchors]);const U=(0,e._)`${z}, ${b.object(...L)}`;return M!==e.nil?(0,e._)`${A}.call(${M}, ${U})`:(0,e._)`${A}(${U})`}le.callValidateCode=p;const y=(0,e._)`new RegExp`;function _({gen:u,it:{opts:m}},b){const h=m.unicodeRegExp?"u":"",{regExp:$}=m.code,E=$(b,h);return u.scopeValue("pattern",{key:E.toString(),ref:E,code:(0,e._)`${$.code==="new RegExp"?y:(0,n.useFunc)(u,$)}(${b}, ${h})`})}le.usePattern=_;function i(u){const{gen:m,data:b,keyword:h,it:$}=u,E=m.name("valid");if($.allErrors){const A=m.let("valid",!0);return R(()=>m.assign(A,!1)),A}return m.var(E,!0),R(()=>m.break()),E;function R(A){const M=m.const("len",(0,e._)`${b}.length`);m.forRange("i",0,M,N=>{u.subschema({keyword:h,dataProp:N,dataPropType:t.Type.Num},E),m.if((0,e.not)(E),A)})}}le.validateArray=i;function d(u){const{gen:m,schema:b,keyword:h,it:$}=u;if(!Array.isArray(b))throw new Error("ajv implementation error");if(b.some(M=>(0,t.alwaysValidSchema)($,M))&&!$.opts.unevaluated)return;const R=m.let("valid",!1),A=m.name("_valid");m.block(()=>b.forEach((M,N)=>{const z=u.subschema({keyword:h,schemaProp:N,compositeRule:!0},A);m.assign(R,(0,e._)`${R} || ${A}`),u.mergeValidEvaluated(z,A)||m.if((0,e.not)(R))})),u.result(R,()=>u.reset(),()=>u.error(!0))}return le.validateUnion=d,le}var Wn;function Wo(){if(Wn)return ze;Wn=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.validateKeywordUsage=ze.validSchemaType=ze.funcKeywordCode=ze.macroKeywordCode=void 0;const e=Q(),t=Ue(),r=Ve(),n=Mr();function c(g,p){const{gen:y,keyword:_,schema:i,parentSchema:d,it:u}=g,m=p.macro.call(u.self,i,d,u),b=v(y,_,m);u.opts.validateSchema!==!1&&u.self.validateSchema(m,!0);const h=y.name("valid");g.subschema({schema:m,schemaPath:e.nil,errSchemaPath:`${u.errSchemaPath}/${_}`,topSchemaRef:b,compositeRule:!0},h),g.pass(h,()=>g.error(!0))}ze.macroKeywordCode=c;function a(g,p){var y;const{gen:_,keyword:i,schema:d,parentSchema:u,$data:m,it:b}=g;l(b,p);const h=!m&&p.compile?p.compile.call(b.self,d,u,b):p.validate,$=v(_,i,h),E=_.let("valid");g.block$data(E,R),g.ok((y=p.valid)!==null&&y!==void 0?y:E);function R(){if(p.errors===!1)N(),p.modifying&&o(g),z(()=>g.error());else{const L=p.async?A():M();p.modifying&&o(g),z(()=>s(g,L))}}function A(){const L=_.let("ruleErrs",null);return _.try(()=>N((0,e._)`await `),U=>_.assign(E,!1).if((0,e._)`${U} instanceof ${b.ValidationError}`,()=>_.assign(L,(0,e._)`${U}.errors`),()=>_.throw(U))),L}function M(){const L=(0,e._)`${$}.errors`;return _.assign(L,null),N(e.nil),L}function N(L=p.async?(0,e._)`await `:e.nil){const U=b.opts.passContext?t.default.this:t.default.self,Z=!("compile"in p&&!m||p.schema===!1);_.assign(E,(0,e._)`${L}${(0,r.callValidateCode)(g,$,U,Z)}`,p.modifying)}function z(L){var U;_.if((0,e.not)((U=p.valid)!==null&&U!==void 0?U:E),L)}}ze.funcKeywordCode=a;function o(g){const{gen:p,data:y,it:_}=g;p.if(_.parentData,()=>p.assign(y,(0,e._)`${_.parentData}[${_.parentDataProperty}]`))}function s(g,p){const{gen:y}=g;y.if((0,e._)`Array.isArray(${p})`,()=>{y.assign(t.default.vErrors,(0,e._)`${t.default.vErrors} === null ? ${p} : ${t.default.vErrors}.concat(${p})`).assign(t.default.errors,(0,e._)`${t.default.vErrors}.length`),(0,n.extendErrors)(g)},()=>g.error())}function l({schemaEnv:g},p){if(p.async&&!g.$async)throw new Error("async keyword in sync schema")}function v(g,p,y){if(y===void 0)throw new Error(`keyword "${p}" failed to compile`);return g.scopeValue("keyword",typeof y=="function"?{ref:y}:{ref:y,code:(0,e.stringify)(y)})}function f(g,p,y=!1){return!p.length||p.some(_=>_==="array"?Array.isArray(g):_==="object"?g&&typeof g=="object"&&!Array.isArray(g):typeof g==_||y&&typeof g>"u")}ze.validSchemaType=f;function w({schema:g,opts:p,self:y,errSchemaPath:_},i,d){if(Array.isArray(i.keyword)?!i.keyword.includes(d):i.keyword!==d)throw new Error("ajv implementation error");const u=i.dependencies;if(u?.some(m=>!Object.prototype.hasOwnProperty.call(g,m)))throw new Error(`parent schema must have dependencies of ${d}: ${u.join(",")}`);if(i.validateSchema&&!i.validateSchema(g[d])){const b=`keyword "${d}" value is invalid at path "${_}": `+y.errorsText(i.validateSchema.errors);if(p.validateSchema==="log")y.logger.error(b);else throw new Error(b)}}return ze.validateKeywordUsage=w,ze}var Ge={},Jn;function Jo(){if(Jn)return Ge;Jn=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.extendSubschemaMode=Ge.extendSubschemaData=Ge.getSubschema=void 0;const e=Q(),t=ne();function r(a,{keyword:o,schemaProp:s,schema:l,schemaPath:v,errSchemaPath:f,topSchemaRef:w}){if(o!==void 0&&l!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(o!==void 0){const g=a.schema[o];return s===void 0?{schema:g,schemaPath:(0,e._)`${a.schemaPath}${(0,e.getProperty)(o)}`,errSchemaPath:`${a.errSchemaPath}/${o}`}:{schema:g[s],schemaPath:(0,e._)`${a.schemaPath}${(0,e.getProperty)(o)}${(0,e.getProperty)(s)}`,errSchemaPath:`${a.errSchemaPath}/${o}/${(0,t.escapeFragment)(s)}`}}if(l!==void 0){if(v===void 0||f===void 0||w===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:l,schemaPath:v,topSchemaRef:w,errSchemaPath:f}}throw new Error('either "keyword" or "schema" must be passed')}Ge.getSubschema=r;function n(a,o,{dataProp:s,dataPropType:l,data:v,dataTypes:f,propertyName:w}){if(v!==void 0&&s!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:g}=o;if(s!==void 0){const{errorPath:y,dataPathArr:_,opts:i}=o,d=g.let("data",(0,e._)`${o.data}${(0,e.getProperty)(s)}`,!0);p(d),a.errorPath=(0,e.str)`${y}${(0,t.getErrorPath)(s,l,i.jsPropertySyntax)}`,a.parentDataProperty=(0,e._)`${s}`,a.dataPathArr=[..._,a.parentDataProperty]}if(v!==void 0){const y=v instanceof e.Name?v:g.let("data",v,!0);p(y),w!==void 0&&(a.propertyName=w)}f&&(a.dataTypes=f);function p(y){a.data=y,a.dataLevel=o.dataLevel+1,a.dataTypes=[],o.definedProperties=new Set,a.parentData=o.data,a.dataNames=[...o.dataNames,y]}}Ge.extendSubschemaData=n;function c(a,{jtdDiscriminator:o,jtdMetadata:s,compositeRule:l,createErrors:v,allErrors:f}){l!==void 0&&(a.compositeRule=l),v!==void 0&&(a.createErrors=v),f!==void 0&&(a.allErrors=f),a.jtdDiscriminator=o,a.jtdMetadata=s}return Ge.extendSubschemaMode=c,Ge}var ke={},en,Yn;function Ts(){return Yn||(Yn=1,en=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,c,a;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(c=n;c--!==0;)if(!e(t[c],r[c]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(a=Object.keys(t),n=a.length,n!==Object.keys(r).length)return!1;for(c=n;c--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[c]))return!1;for(c=n;c--!==0;){var o=a[c];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r}),en}var tn={exports:{}},Xn;function Yo(){if(Xn)return tn.exports;Xn=1;var e=tn.exports=function(n,c,a){typeof c=="function"&&(a=c,c={}),a=c.cb||a;var o=typeof a=="function"?a:a.pre||function(){},s=a.post||function(){};t(c,o,s,n,"",n)};e.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},e.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},e.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},e.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function t(n,c,a,o,s,l,v,f,w,g){if(o&&typeof o=="object"&&!Array.isArray(o)){c(o,s,l,v,f,w,g);for(var p in o){var y=o[p];if(Array.isArray(y)){if(p in e.arrayKeywords)for(var _=0;_<y.length;_++)t(n,c,a,y[_],s+"/"+p+"/"+_,l,s,p,o,_)}else if(p in e.propsKeywords){if(y&&typeof y=="object")for(var i in y)t(n,c,a,y[i],s+"/"+p+"/"+r(i),l,s,p,o,i)}else(p in e.keywords||n.allKeys&&!(p in e.skipKeywords))&&t(n,c,a,y,s+"/"+p,l,s,p,o)}a(o,s,l,v,f,w,g)}}function r(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}return tn.exports}var Zn;function qr(){if(Zn)return ke;Zn=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.getSchemaRefs=ke.resolveUrl=ke.normalizeId=ke._getFullPath=ke.getFullPath=ke.inlineRef=void 0;const e=ne(),t=Ts(),r=Yo(),n=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function c(_,i=!0){return typeof _=="boolean"?!0:i===!0?!o(_):i?s(_)<=i:!1}ke.inlineRef=c;const a=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function o(_){for(const i in _){if(a.has(i))return!0;const d=_[i];if(Array.isArray(d)&&d.some(o)||typeof d=="object"&&o(d))return!0}return!1}function s(_){let i=0;for(const d in _){if(d==="$ref")return 1/0;if(i++,!n.has(d)&&(typeof _[d]=="object"&&(0,e.eachItem)(_[d],u=>i+=s(u)),i===1/0))return 1/0}return i}function l(_,i="",d){d!==!1&&(i=w(i));const u=_.parse(i);return v(_,u)}ke.getFullPath=l;function v(_,i){return _.serialize(i).split("#")[0]+"#"}ke._getFullPath=v;const f=/#\/?$/;function w(_){return _?_.replace(f,""):""}ke.normalizeId=w;function g(_,i,d){return d=w(d),_.resolve(i,d)}ke.resolveUrl=g;const p=/^[a-z_][-a-z0-9._]*$/i;function y(_,i){if(typeof _=="boolean")return{};const{schemaId:d,uriResolver:u}=this.opts,m=w(_[d]||i),b={"":m},h=l(u,m,!1),$={},E=new Set;return r(_,{allKeys:!0},(M,N,z,L)=>{if(L===void 0)return;const U=h+N;let Z=b[L];typeof M[d]=="string"&&(Z=me.call(this,M[d])),$e.call(this,M.$anchor),$e.call(this,M.$dynamicAnchor),b[N]=Z;function me(oe){const Ce=this.opts.uriResolver.resolve;if(oe=w(Z?Ce(Z,oe):oe),E.has(oe))throw A(oe);E.add(oe);let V=this.refs[oe];return typeof V=="string"&&(V=this.refs[V]),typeof V=="object"?R(M,V.schema,oe):oe!==w(U)&&(oe[0]==="#"?(R(M,$[oe],oe),$[oe]=M):this.refs[oe]=U),oe}function $e(oe){if(typeof oe=="string"){if(!p.test(oe))throw new Error(`invalid anchor "${oe}"`);me.call(this,`#${oe}`)}}}),$;function R(M,N,z){if(N!==void 0&&!t(M,N))throw A(z)}function A(M){return new Error(`reference "${M}" resolves to more than one schema`)}}return ke.getSchemaRefs=y,ke}var Qn;function wt(){if(Qn)return Ke;Qn=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.getData=Ke.KeywordCxt=Ke.validateFunctionCode=void 0;const e=Go(),t=jr(),r=Ns(),n=jr(),c=Bo(),a=Wo(),o=Jo(),s=Q(),l=Ue(),v=qr(),f=ne(),w=Mr();function g(I){if(h(I)&&(E(I),b(I))){i(I);return}p(I,()=>(0,e.topBoolOrEmptySchema)(I))}Ke.validateFunctionCode=g;function p({gen:I,validateName:j,schema:C,schemaEnv:F,opts:J},te){J.code.es5?I.func(j,(0,s._)`${l.default.data}, ${l.default.valCxt}`,F.$async,()=>{I.code((0,s._)`"use strict"; ${u(C,J)}`),_(I,J),I.code(te)}):I.func(j,(0,s._)`${l.default.data}, ${y(J)}`,F.$async,()=>I.code(u(C,J)).code(te))}function y(I){return(0,s._)`{${l.default.instancePath}="", ${l.default.parentData}, ${l.default.parentDataProperty}, ${l.default.rootData}=${l.default.data}${I.dynamicRef?(0,s._)`, ${l.default.dynamicAnchors}={}`:s.nil}}={}`}function _(I,j){I.if(l.default.valCxt,()=>{I.var(l.default.instancePath,(0,s._)`${l.default.valCxt}.${l.default.instancePath}`),I.var(l.default.parentData,(0,s._)`${l.default.valCxt}.${l.default.parentData}`),I.var(l.default.parentDataProperty,(0,s._)`${l.default.valCxt}.${l.default.parentDataProperty}`),I.var(l.default.rootData,(0,s._)`${l.default.valCxt}.${l.default.rootData}`),j.dynamicRef&&I.var(l.default.dynamicAnchors,(0,s._)`${l.default.valCxt}.${l.default.dynamicAnchors}`)},()=>{I.var(l.default.instancePath,(0,s._)`""`),I.var(l.default.parentData,(0,s._)`undefined`),I.var(l.default.parentDataProperty,(0,s._)`undefined`),I.var(l.default.rootData,l.default.data),j.dynamicRef&&I.var(l.default.dynamicAnchors,(0,s._)`{}`)})}function i(I){const{schema:j,opts:C,gen:F}=I;p(I,()=>{C.$comment&&j.$comment&&L(I),M(I),F.let(l.default.vErrors,null),F.let(l.default.errors,0),C.unevaluated&&d(I),R(I),U(I)})}function d(I){const{gen:j,validateName:C}=I;I.evaluated=j.const("evaluated",(0,s._)`${C}.evaluated`),j.if((0,s._)`${I.evaluated}.dynamicProps`,()=>j.assign((0,s._)`${I.evaluated}.props`,(0,s._)`undefined`)),j.if((0,s._)`${I.evaluated}.dynamicItems`,()=>j.assign((0,s._)`${I.evaluated}.items`,(0,s._)`undefined`))}function u(I,j){const C=typeof I=="object"&&I[j.schemaId];return C&&(j.code.source||j.code.process)?(0,s._)`/*# sourceURL=${C} */`:s.nil}function m(I,j){if(h(I)&&(E(I),b(I))){$(I,j);return}(0,e.boolOrEmptySchema)(I,j)}function b({schema:I,self:j}){if(typeof I=="boolean")return!I;for(const C in I)if(j.RULES.all[C])return!0;return!1}function h(I){return typeof I.schema!="boolean"}function $(I,j){const{schema:C,gen:F,opts:J}=I;J.$comment&&C.$comment&&L(I),N(I),z(I);const te=F.const("_errs",l.default.errors);R(I,te),F.var(j,(0,s._)`${te} === ${l.default.errors}`)}function E(I){(0,f.checkUnknownRules)(I),A(I)}function R(I,j){if(I.opts.jtd)return me(I,[],!1,j);const C=(0,t.getSchemaTypes)(I.schema),F=(0,t.coerceAndCheckDataType)(I,C);me(I,C,!F,j)}function A(I){const{schema:j,errSchemaPath:C,opts:F,self:J}=I;j.$ref&&F.ignoreKeywordsWithRef&&(0,f.schemaHasRulesButRef)(j,J.RULES)&&J.logger.warn(`$ref: keywords ignored in schema at path "${C}"`)}function M(I){const{schema:j,opts:C}=I;j.default!==void 0&&C.useDefaults&&C.strictSchema&&(0,f.checkStrictMode)(I,"default is ignored in the schema root")}function N(I){const j=I.schema[I.opts.schemaId];j&&(I.baseId=(0,v.resolveUrl)(I.opts.uriResolver,I.baseId,j))}function z(I){if(I.schema.$async&&!I.schemaEnv.$async)throw new Error("async schema in sync schema")}function L({gen:I,schemaEnv:j,schema:C,errSchemaPath:F,opts:J}){const te=C.$comment;if(J.$comment===!0)I.code((0,s._)`${l.default.self}.logger.log(${te})`);else if(typeof J.$comment=="function"){const we=(0,s.str)`${F}/$comment`,De=I.scopeValue("root",{ref:j.root});I.code((0,s._)`${l.default.self}.opts.$comment(${te}, ${we}, ${De}.schema)`)}}function U(I){const{gen:j,schemaEnv:C,validateName:F,ValidationError:J,opts:te}=I;C.$async?j.if((0,s._)`${l.default.errors} === 0`,()=>j.return(l.default.data),()=>j.throw((0,s._)`new ${J}(${l.default.vErrors})`)):(j.assign((0,s._)`${F}.errors`,l.default.vErrors),te.unevaluated&&Z(I),j.return((0,s._)`${l.default.errors} === 0`))}function Z({gen:I,evaluated:j,props:C,items:F}){C instanceof s.Name&&I.assign((0,s._)`${j}.props`,C),F instanceof s.Name&&I.assign((0,s._)`${j}.items`,F)}function me(I,j,C,F){const{gen:J,schema:te,data:we,allErrors:De,opts:je,self:Oe}=I,{RULES:Se}=Oe;if(te.$ref&&(je.ignoreKeywordsWithRef||!(0,f.schemaHasRulesButRef)(te,Se))){J.block(()=>G(I,"$ref",Se.all.$ref.definition));return}je.jtd||oe(I,j),J.block(()=>{for(const Me of Se.rules)ot(Me);ot(Se.post)});function ot(Me){(0,r.shouldUseGroup)(te,Me)&&(Me.type?(J.if((0,n.checkDataType)(Me.type,we,je.strictNumbers)),$e(I,Me),j.length===1&&j[0]===Me.type&&C&&(J.else(),(0,n.reportTypeError)(I)),J.endIf()):$e(I,Me),De||J.if((0,s._)`${l.default.errors} === ${F||0}`))}}function $e(I,j){const{gen:C,schema:F,opts:{useDefaults:J}}=I;J&&(0,c.assignDefaults)(I,j.type),C.block(()=>{for(const te of j.rules)(0,r.shouldUseRule)(F,te)&&G(I,te.keyword,te.definition,j.type)})}function oe(I,j){I.schemaEnv.meta||!I.opts.strictTypes||(Ce(I,j),I.opts.allowUnionTypes||V(I,j),k(I,I.dataTypes))}function Ce(I,j){if(j.length){if(!I.dataTypes.length){I.dataTypes=j;return}j.forEach(C=>{O(I.dataTypes,C)||P(I,`type "${C}" not allowed by context "${I.dataTypes.join(",")}"`)}),S(I,j)}}function V(I,j){j.length>1&&!(j.length===2&&j.includes("null"))&&P(I,"use allowUnionTypes to allow union type keyword")}function k(I,j){const C=I.self.RULES.all;for(const F in C){const J=C[F];if(typeof J=="object"&&(0,r.shouldUseRule)(I.schema,J)){const{type:te}=J.definition;te.length&&!te.some(we=>D(j,we))&&P(I,`missing type "${te.join(",")}" for keyword "${F}"`)}}}function D(I,j){return I.includes(j)||j==="number"&&I.includes("integer")}function O(I,j){return I.includes(j)||j==="integer"&&I.includes("number")}function S(I,j){const C=[];for(const F of I.dataTypes)O(j,F)?C.push(F):j.includes("integer")&&F==="number"&&C.push("integer");I.dataTypes=C}function P(I,j){const C=I.schemaEnv.baseId+I.errSchemaPath;j+=` at "${C}" (strictTypes)`,(0,f.checkStrictMode)(I,j,I.opts.strictTypes)}class q{constructor(j,C,F){if((0,a.validateKeywordUsage)(j,C,F),this.gen=j.gen,this.allErrors=j.allErrors,this.keyword=F,this.data=j.data,this.schema=j.schema[F],this.$data=C.$data&&j.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,f.schemaRefOrVal)(j,this.schema,F,this.$data),this.schemaType=C.schemaType,this.parentSchema=j.schema,this.params={},this.it=j,this.def=C,this.$data)this.schemaCode=j.gen.const("vSchema",ae(this.$data,j));else if(this.schemaCode=this.schemaValue,!(0,a.validSchemaType)(this.schema,C.schemaType,C.allowUndefined))throw new Error(`${F} value must be ${JSON.stringify(C.schemaType)}`);("code"in C?C.trackErrors:C.errors!==!1)&&(this.errsCount=j.gen.const("_errs",l.default.errors))}result(j,C,F){this.failResult((0,s.not)(j),C,F)}failResult(j,C,F){this.gen.if(j),F?F():this.error(),C?(this.gen.else(),C(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(j,C){this.failResult((0,s.not)(j),void 0,C)}fail(j){if(j===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(j),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(j){if(!this.$data)return this.fail(j);const{schemaCode:C}=this;this.fail((0,s._)`${C} !== undefined && (${(0,s.or)(this.invalid$data(),j)})`)}error(j,C,F){if(C){this.setParams(C),this._error(j,F),this.setParams({});return}this._error(j,F)}_error(j,C){(j?w.reportExtraError:w.reportError)(this,this.def.error,C)}$dataError(){(0,w.reportError)(this,this.def.$dataError||w.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,w.resetErrorsCount)(this.gen,this.errsCount)}ok(j){this.allErrors||this.gen.if(j)}setParams(j,C){C?Object.assign(this.params,j):this.params=j}block$data(j,C,F=s.nil){this.gen.block(()=>{this.check$data(j,F),C()})}check$data(j=s.nil,C=s.nil){if(!this.$data)return;const{gen:F,schemaCode:J,schemaType:te,def:we}=this;F.if((0,s.or)((0,s._)`${J} === undefined`,C)),j!==s.nil&&F.assign(j,!0),(te.length||we.validateSchema)&&(F.elseIf(this.invalid$data()),this.$dataError(),j!==s.nil&&F.assign(j,!1)),F.else()}invalid$data(){const{gen:j,schemaCode:C,schemaType:F,def:J,it:te}=this;return(0,s.or)(we(),De());function we(){if(F.length){if(!(C instanceof s.Name))throw new Error("ajv implementation error");const je=Array.isArray(F)?F:[F];return(0,s._)`${(0,n.checkDataTypes)(je,C,te.opts.strictNumbers,n.DataType.Wrong)}`}return s.nil}function De(){if(J.validateSchema){const je=j.scopeValue("validate$data",{ref:J.validateSchema});return(0,s._)`!${je}(${C})`}return s.nil}}subschema(j,C){const F=(0,o.getSubschema)(this.it,j);(0,o.extendSubschemaData)(F,this.it,j),(0,o.extendSubschemaMode)(F,j);const J={...this.it,...F,items:void 0,props:void 0};return m(J,C),J}mergeEvaluated(j,C){const{it:F,gen:J}=this;F.opts.unevaluated&&(F.props!==!0&&j.props!==void 0&&(F.props=f.mergeEvaluated.props(J,j.props,F.props,C)),F.items!==!0&&j.items!==void 0&&(F.items=f.mergeEvaluated.items(J,j.items,F.items,C)))}mergeValidEvaluated(j,C){const{it:F,gen:J}=this;if(F.opts.unevaluated&&(F.props!==!0||F.items!==!0))return J.if(C,()=>this.mergeEvaluated(j,s.Name)),!0}}Ke.KeywordCxt=q;function G(I,j,C,F){const J=new q(I,C,j);"code"in C?C.code(J,F):J.$data&&C.validate?(0,a.funcKeywordCode)(J,C):"macro"in C?(0,a.macroKeywordCode)(J,C):(C.compile||C.validate)&&(0,a.funcKeywordCode)(J,C)}const X=/^\/(?:[^~]|~0|~1)*$/,ie=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function ae(I,{dataLevel:j,dataNames:C,dataPathArr:F}){let J,te;if(I==="")return l.default.rootData;if(I[0]==="/"){if(!X.test(I))throw new Error(`Invalid JSON-pointer: ${I}`);J=I,te=l.default.rootData}else{const Oe=ie.exec(I);if(!Oe)throw new Error(`Invalid JSON-pointer: ${I}`);const Se=+Oe[1];if(J=Oe[2],J==="#"){if(Se>=j)throw new Error(je("property/index",Se));return F[j-Se]}if(Se>j)throw new Error(je("data",Se));if(te=C[j-Se],!J)return te}let we=te;const De=J.split("/");for(const Oe of De)Oe&&(te=(0,s._)`${te}${(0,s.getProperty)((0,f.unescapeJsonPointer)(Oe))}`,we=(0,s._)`${we} && ${te}`);return we;function je(Oe,Se){return`Cannot access ${Oe} ${Se} levels up, current level is ${j}`}}return Ke.getData=ae,Ke}var jt={},ea;function Ar(){if(ea)return jt;ea=1,Object.defineProperty(jt,"__esModule",{value:!0});class e extends Error{constructor(r){super("validation failed"),this.errors=r,this.ajv=this.validation=!0}}return jt.default=e,jt}var Ot={},ta;function St(){if(ta)return Ot;ta=1,Object.defineProperty(Ot,"__esModule",{value:!0});const e=qr();class t extends Error{constructor(n,c,a,o){super(o||`can't resolve reference ${a} from id ${c}`),this.missingRef=(0,e.resolveUrl)(n,c,a),this.missingSchema=(0,e.normalizeId)((0,e.getFullPath)(n,this.missingRef))}}return Ot.default=t,Ot}var Ne={},ra;function Cr(){if(ra)return Ne;ra=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.resolveSchema=Ne.getCompilingSchema=Ne.resolveRef=Ne.compileSchema=Ne.SchemaEnv=void 0;const e=Q(),t=Ar(),r=Ue(),n=qr(),c=ne(),a=wt();class o{constructor(d){var u;this.refs={},this.dynamicAnchors={};let m;typeof d.schema=="object"&&(m=d.schema),this.schema=d.schema,this.schemaId=d.schemaId,this.root=d.root||this,this.baseId=(u=d.baseId)!==null&&u!==void 0?u:(0,n.normalizeId)(m?.[d.schemaId||"$id"]),this.schemaPath=d.schemaPath,this.localRefs=d.localRefs,this.meta=d.meta,this.$async=m?.$async,this.refs={}}}Ne.SchemaEnv=o;function s(i){const d=f.call(this,i);if(d)return d;const u=(0,n.getFullPath)(this.opts.uriResolver,i.root.baseId),{es5:m,lines:b}=this.opts.code,{ownProperties:h}=this.opts,$=new e.CodeGen(this.scope,{es5:m,lines:b,ownProperties:h});let E;i.$async&&(E=$.scopeValue("Error",{ref:t.default,code:(0,e._)`require("ajv/dist/runtime/validation_error").default`}));const R=$.scopeName("validate");i.validateName=R;const A={gen:$,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[e.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:$.scopeValue("schema",this.opts.code.source===!0?{ref:i.schema,code:(0,e.stringify)(i.schema)}:{ref:i.schema}),validateName:R,ValidationError:E,schema:i.schema,schemaEnv:i,rootId:u,baseId:i.baseId||u,schemaPath:e.nil,errSchemaPath:i.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,e._)`""`,opts:this.opts,self:this};let M;try{this._compilations.add(i),(0,a.validateFunctionCode)(A),$.optimize(this.opts.code.optimize);const N=$.toString();M=`${$.scopeRefs(r.default.scope)}return ${N}`,this.opts.code.process&&(M=this.opts.code.process(M,i));const L=new Function(`${r.default.self}`,`${r.default.scope}`,M)(this,this.scope.get());if(this.scope.value(R,{ref:L}),L.errors=null,L.schema=i.schema,L.schemaEnv=i,i.$async&&(L.$async=!0),this.opts.code.source===!0&&(L.source={validateName:R,validateCode:N,scopeValues:$._values}),this.opts.unevaluated){const{props:U,items:Z}=A;L.evaluated={props:U instanceof e.Name?void 0:U,items:Z instanceof e.Name?void 0:Z,dynamicProps:U instanceof e.Name,dynamicItems:Z instanceof e.Name},L.source&&(L.source.evaluated=(0,e.stringify)(L.evaluated))}return i.validate=L,i}catch(N){throw delete i.validate,delete i.validateName,M&&this.logger.error("Error compiling schema, function code:",M),N}finally{this._compilations.delete(i)}}Ne.compileSchema=s;function l(i,d,u){var m;u=(0,n.resolveUrl)(this.opts.uriResolver,d,u);const b=i.refs[u];if(b)return b;let h=g.call(this,i,u);if(h===void 0){const $=(m=i.localRefs)===null||m===void 0?void 0:m[u],{schemaId:E}=this.opts;$&&(h=new o({schema:$,schemaId:E,root:i,baseId:d}))}if(h!==void 0)return i.refs[u]=v.call(this,h)}Ne.resolveRef=l;function v(i){return(0,n.inlineRef)(i.schema,this.opts.inlineRefs)?i.schema:i.validate?i:s.call(this,i)}function f(i){for(const d of this._compilations)if(w(d,i))return d}Ne.getCompilingSchema=f;function w(i,d){return i.schema===d.schema&&i.root===d.root&&i.baseId===d.baseId}function g(i,d){let u;for(;typeof(u=this.refs[d])=="string";)d=u;return u||this.schemas[d]||p.call(this,i,d)}function p(i,d){const u=this.opts.uriResolver.parse(d),m=(0,n._getFullPath)(this.opts.uriResolver,u);let b=(0,n.getFullPath)(this.opts.uriResolver,i.baseId,void 0);if(Object.keys(i.schema).length>0&&m===b)return _.call(this,u,i);const h=(0,n.normalizeId)(m),$=this.refs[h]||this.schemas[h];if(typeof $=="string"){const E=p.call(this,i,$);return typeof E?.schema!="object"?void 0:_.call(this,u,E)}if(typeof $?.schema=="object"){if($.validate||s.call(this,$),h===(0,n.normalizeId)(d)){const{schema:E}=$,{schemaId:R}=this.opts,A=E[R];return A&&(b=(0,n.resolveUrl)(this.opts.uriResolver,b,A)),new o({schema:E,schemaId:R,root:i,baseId:b})}return _.call(this,u,$)}}Ne.resolveSchema=p;const y=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function _(i,{baseId:d,schema:u,root:m}){var b;if(((b=i.fragment)===null||b===void 0?void 0:b[0])!=="/")return;for(const E of i.fragment.slice(1).split("/")){if(typeof u=="boolean")return;const R=u[(0,c.unescapeFragment)(E)];if(R===void 0)return;u=R;const A=typeof u=="object"&&u[this.opts.schemaId];!y.has(E)&&A&&(d=(0,n.resolveUrl)(this.opts.uriResolver,d,A))}let h;if(typeof u!="boolean"&&u.$ref&&!(0,c.schemaHasRulesButRef)(u,this.RULES)){const E=(0,n.resolveUrl)(this.opts.uriResolver,d,u.$ref);h=p.call(this,m,E)}const{schemaId:$}=this.opts;if(h=h||new o({schema:u,schemaId:$,root:m,baseId:d}),h.schema!==h.root.schema)return h}return Ne}const Xo="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Zo="Meta-schema for $data reference (JSON AnySchema extension proposal)",Qo="object",ei=["$data"],ti={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},ri=!1,ni={$id:Xo,description:Zo,type:Qo,required:ei,properties:ti,additionalProperties:ri};var Nt={},vt={exports:{}},rn,na;function Ms(){if(na)return rn;na=1;const e=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),t=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function r(g){let p="",y=0,_=0;for(_=0;_<g.length;_++)if(y=g[_].charCodeAt(0),y!==48){if(!(y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102))return"";p+=g[_];break}for(_+=1;_<g.length;_++){if(y=g[_].charCodeAt(0),!(y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102))return"";p+=g[_]}return p}const n=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function c(g){return g.length=0,!0}function a(g,p,y){if(g.length){const _=r(g);if(_!=="")p.push(_);else return y.error=!0,!1;g.length=0}return!0}function o(g){let p=0;const y={error:!1,address:"",zone:""},_=[],i=[];let d=!1,u=!1,m=a;for(let b=0;b<g.length;b++){const h=g[b];if(!(h==="["||h==="]"))if(h===":"){if(d===!0&&(u=!0),!m(i,_,y))break;if(++p>7){y.error=!0;break}b>0&&g[b-1]===":"&&(d=!0),_.push(":");continue}else if(h==="%"){if(!m(i,_,y))break;m=c}else{i.push(h);continue}}return i.length&&(m===c?y.zone=i.join(""):u?_.push(i.join("")):_.push(r(i))),y.address=_.join(""),y}function s(g){if(l(g,":")<2)return{host:g,isIPV6:!1};const p=o(g);if(p.error)return{host:g,isIPV6:!1};{let y=p.address,_=p.address;return p.zone&&(y+="%"+p.zone,_+="%25"+p.zone),{host:y,isIPV6:!0,escapedHost:_}}}function l(g,p){let y=0;for(let _=0;_<g.length;_++)g[_]===p&&y++;return y}function v(g){let p=g;const y=[];let _=-1,i=0;for(;i=p.length;){if(i===1){if(p===".")break;if(p==="/"){y.push("/");break}else{y.push(p);break}}else if(i===2){if(p[0]==="."){if(p[1]===".")break;if(p[1]==="/"){p=p.slice(2);continue}}else if(p[0]==="/"&&(p[1]==="."||p[1]==="/")){y.push("/");break}}else if(i===3&&p==="/.."){y.length!==0&&y.pop(),y.push("/");break}if(p[0]==="."){if(p[1]==="."){if(p[2]==="/"){p=p.slice(3);continue}}else if(p[1]==="/"){p=p.slice(2);continue}}else if(p[0]==="/"&&p[1]==="."){if(p[2]==="/"){p=p.slice(2);continue}else if(p[2]==="."&&p[3]==="/"){p=p.slice(3),y.length!==0&&y.pop();continue}}if((_=p.indexOf("/",1))===-1){y.push(p);break}else y.push(p.slice(0,_)),p=p.slice(_)}return y.join("")}function f(g,p){const y=p!==!0?escape:unescape;return g.scheme!==void 0&&(g.scheme=y(g.scheme)),g.userinfo!==void 0&&(g.userinfo=y(g.userinfo)),g.host!==void 0&&(g.host=y(g.host)),g.path!==void 0&&(g.path=y(g.path)),g.query!==void 0&&(g.query=y(g.query)),g.fragment!==void 0&&(g.fragment=y(g.fragment)),g}function w(g){const p=[];if(g.userinfo!==void 0&&(p.push(g.userinfo),p.push("@")),g.host!==void 0){let y=unescape(g.host);if(!t(y)){const _=s(y);_.isIPV6===!0?y=`[${_.escapedHost}]`:y=g.host}p.push(y)}return(typeof g.port=="number"||typeof g.port=="string")&&(p.push(":"),p.push(String(g.port))),p.length?p.join(""):void 0}return rn={nonSimpleDomain:n,recomposeAuthority:w,normalizeComponentEncoding:f,removeDotSegments:v,isIPv4:t,isUUID:e,normalizeIPv6:s,stringArrayToHexStripped:r},rn}var nn,aa;function ai(){if(aa)return nn;aa=1;const{isUUID:e}=Ms(),t=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,r=["http","https","ws","wss","urn","urn:uuid"];function n(h){return r.indexOf(h)!==-1}function c(h){return h.secure===!0?!0:h.secure===!1?!1:h.scheme?h.scheme.length===3&&(h.scheme[0]==="w"||h.scheme[0]==="W")&&(h.scheme[1]==="s"||h.scheme[1]==="S")&&(h.scheme[2]==="s"||h.scheme[2]==="S"):!1}function a(h){return h.host||(h.error=h.error||"HTTP URIs must have a host."),h}function o(h){const $=String(h.scheme).toLowerCase()==="https";return(h.port===($?443:80)||h.port==="")&&(h.port=void 0),h.path||(h.path="/"),h}function s(h){return h.secure=c(h),h.resourceName=(h.path||"/")+(h.query?"?"+h.query:""),h.path=void 0,h.query=void 0,h}function l(h){if((h.port===(c(h)?443:80)||h.port==="")&&(h.port=void 0),typeof h.secure=="boolean"&&(h.scheme=h.secure?"wss":"ws",h.secure=void 0),h.resourceName){const[$,E]=h.resourceName.split("?");h.path=$&&$!=="/"?$:void 0,h.query=E,h.resourceName=void 0}return h.fragment=void 0,h}function v(h,$){if(!h.path)return h.error="URN can not be parsed",h;const E=h.path.match(t);if(E){const R=$.scheme||h.scheme||"urn";h.nid=E[1].toLowerCase(),h.nss=E[2];const A=`${R}:${$.nid||h.nid}`,M=b(A);h.path=void 0,M&&(h=M.parse(h,$))}else h.error=h.error||"URN can not be parsed.";return h}function f(h,$){if(h.nid===void 0)throw new Error("URN without nid cannot be serialized");const E=$.scheme||h.scheme||"urn",R=h.nid.toLowerCase(),A=`${E}:${$.nid||R}`,M=b(A);M&&(h=M.serialize(h,$));const N=h,z=h.nss;return N.path=`${R||$.nid}:${z}`,$.skipEscape=!0,N}function w(h,$){const E=h;return E.uuid=E.nss,E.nss=void 0,!$.tolerant&&(!E.uuid||!e(E.uuid))&&(E.error=E.error||"UUID is not valid."),E}function g(h){const $=h;return $.nss=(h.uuid||"").toLowerCase(),$}const p={scheme:"http",domainHost:!0,parse:a,serialize:o},y={scheme:"https",domainHost:p.domainHost,parse:a,serialize:o},_={scheme:"ws",domainHost:!0,parse:s,serialize:l},i={scheme:"wss",domainHost:_.domainHost,parse:_.parse,serialize:_.serialize},m={http:p,https:y,ws:_,wss:i,urn:{scheme:"urn",parse:v,serialize:f,skipNormalize:!0},"urn:uuid":{scheme:"urn:uuid",parse:w,serialize:g,skipNormalize:!0}};Object.setPrototypeOf(m,null);function b(h){return h&&(m[h]||m[h.toLowerCase()])||void 0}return nn={wsIsSecure:c,SCHEMES:m,isValidSchemeName:n,getSchemeHandler:b},nn}var sa;function si(){if(sa)return vt.exports;sa=1;const{normalizeIPv6:e,removeDotSegments:t,recomposeAuthority:r,normalizeComponentEncoding:n,isIPv4:c,nonSimpleDomain:a}=Ms(),{SCHEMES:o,getSchemeHandler:s}=ai();function l(i,d){return typeof i=="string"?i=g(y(i,d),d):typeof i=="object"&&(i=y(g(i,d),d)),i}function v(i,d,u){const m=u?Object.assign({scheme:"null"},u):{scheme:"null"},b=f(y(i,m),y(d,m),m,!0);return m.skipEscape=!0,g(b,m)}function f(i,d,u,m){const b={};return m||(i=y(g(i,u),u),d=y(g(d,u),u)),u=u||{},!u.tolerant&&d.scheme?(b.scheme=d.scheme,b.userinfo=d.userinfo,b.host=d.host,b.port=d.port,b.path=t(d.path||""),b.query=d.query):(d.userinfo!==void 0||d.host!==void 0||d.port!==void 0?(b.userinfo=d.userinfo,b.host=d.host,b.port=d.port,b.path=t(d.path||""),b.query=d.query):(d.path?(d.path[0]==="/"?b.path=t(d.path):((i.userinfo!==void 0||i.host!==void 0||i.port!==void 0)&&!i.path?b.path="/"+d.path:i.path?b.path=i.path.slice(0,i.path.lastIndexOf("/")+1)+d.path:b.path=d.path,b.path=t(b.path)),b.query=d.query):(b.path=i.path,d.query!==void 0?b.query=d.query:b.query=i.query),b.userinfo=i.userinfo,b.host=i.host,b.port=i.port),b.scheme=i.scheme),b.fragment=d.fragment,b}function w(i,d,u){return typeof i=="string"?(i=unescape(i),i=g(n(y(i,u),!0),{...u,skipEscape:!0})):typeof i=="object"&&(i=g(n(i,!0),{...u,skipEscape:!0})),typeof d=="string"?(d=unescape(d),d=g(n(y(d,u),!0),{...u,skipEscape:!0})):typeof d=="object"&&(d=g(n(d,!0),{...u,skipEscape:!0})),i.toLowerCase()===d.toLowerCase()}function g(i,d){const u={host:i.host,scheme:i.scheme,userinfo:i.userinfo,port:i.port,path:i.path,query:i.query,nid:i.nid,nss:i.nss,uuid:i.uuid,fragment:i.fragment,reference:i.reference,resourceName:i.resourceName,secure:i.secure,error:""},m=Object.assign({},d),b=[],h=s(m.scheme||u.scheme);h&&h.serialize&&h.serialize(u,m),u.path!==void 0&&(m.skipEscape?u.path=unescape(u.path):(u.path=escape(u.path),u.scheme!==void 0&&(u.path=u.path.split("%3A").join(":")))),m.reference!=="suffix"&&u.scheme&&b.push(u.scheme,":");const $=r(u);if($!==void 0&&(m.reference!=="suffix"&&b.push("//"),b.push($),u.path&&u.path[0]!=="/"&&b.push("/")),u.path!==void 0){let E=u.path;!m.absolutePath&&(!h||!h.absolutePath)&&(E=t(E)),$===void 0&&E[0]==="/"&&E[1]==="/"&&(E="/%2F"+E.slice(2)),b.push(E)}return u.query!==void 0&&b.push("?",u.query),u.fragment!==void 0&&b.push("#",u.fragment),b.join("")}const p=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function y(i,d){const u=Object.assign({},d),m={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0};let b=!1;u.reference==="suffix"&&(u.scheme?i=u.scheme+":"+i:i="//"+i);const h=i.match(p);if(h){if(m.scheme=h[1],m.userinfo=h[3],m.host=h[4],m.port=parseInt(h[5],10),m.path=h[6]||"",m.query=h[7],m.fragment=h[8],isNaN(m.port)&&(m.port=h[5]),m.host)if(c(m.host)===!1){const R=e(m.host);m.host=R.host.toLowerCase(),b=R.isIPV6}else b=!0;m.scheme===void 0&&m.userinfo===void 0&&m.host===void 0&&m.port===void 0&&m.query===void 0&&!m.path?m.reference="same-document":m.scheme===void 0?m.reference="relative":m.fragment===void 0?m.reference="absolute":m.reference="uri",u.reference&&u.reference!=="suffix"&&u.reference!==m.reference&&(m.error=m.error||"URI is not a "+u.reference+" reference.");const $=s(u.scheme||m.scheme);if(!u.unicodeSupport&&(!$||!$.unicodeSupport)&&m.host&&(u.domainHost||$&&$.domainHost)&&b===!1&&a(m.host))try{m.host=URL.domainToASCII(m.host.toLowerCase())}catch(E){m.error=m.error||"Host's domain name can not be converted to ASCII: "+E}(!$||$&&!$.skipNormalize)&&(i.indexOf("%")!==-1&&(m.scheme!==void 0&&(m.scheme=unescape(m.scheme)),m.host!==void 0&&(m.host=unescape(m.host))),m.path&&(m.path=escape(unescape(m.path))),m.fragment&&(m.fragment=encodeURI(decodeURIComponent(m.fragment)))),$&&$.parse&&$.parse(m,u)}else m.error=m.error||"URI can not be parsed.";return m}const _={SCHEMES:o,normalize:l,resolve:v,resolveComponent:f,equal:w,serialize:g,parse:y};return vt.exports=_,vt.exports.default=_,vt.exports.fastUri=_,vt.exports}var oa;function oi(){if(oa)return Nt;oa=1,Object.defineProperty(Nt,"__esModule",{value:!0});const e=si();return e.code='require("ajv/dist/runtime/uri").default',Nt.default=e,Nt}var ia;function qs(){return ia||(ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=wt();Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=Q();Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=Ar(),c=St(),a=Os(),o=Cr(),s=Q(),l=qr(),v=jr(),f=ne(),w=ni,g=oi(),p=(V,k)=>new RegExp(V,k);p.code="new RegExp";const y=["removeAdditional","useDefaults","coerceTypes"],_=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),i={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},d={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},u=200;function m(V){var k,D,O,S,P,q,G,X,ie,ae,I,j,C,F,J,te,we,De,je,Oe,Se,ot,Me,Vr,Lr;const mt=V.strict,Fr=(k=V.code)===null||k===void 0?void 0:k.optimize,kn=Fr===!0||Fr===void 0?1:Fr||0,Rn=(O=(D=V.code)===null||D===void 0?void 0:D.regExp)!==null&&O!==void 0?O:p,eo=(S=V.uriResolver)!==null&&S!==void 0?S:g.default;return{strictSchema:(q=(P=V.strictSchema)!==null&&P!==void 0?P:mt)!==null&&q!==void 0?q:!0,strictNumbers:(X=(G=V.strictNumbers)!==null&&G!==void 0?G:mt)!==null&&X!==void 0?X:!0,strictTypes:(ae=(ie=V.strictTypes)!==null&&ie!==void 0?ie:mt)!==null&&ae!==void 0?ae:"log",strictTuples:(j=(I=V.strictTuples)!==null&&I!==void 0?I:mt)!==null&&j!==void 0?j:"log",strictRequired:(F=(C=V.strictRequired)!==null&&C!==void 0?C:mt)!==null&&F!==void 0?F:!1,code:V.code?{...V.code,optimize:kn,regExp:Rn}:{optimize:kn,regExp:Rn},loopRequired:(J=V.loopRequired)!==null&&J!==void 0?J:u,loopEnum:(te=V.loopEnum)!==null&&te!==void 0?te:u,meta:(we=V.meta)!==null&&we!==void 0?we:!0,messages:(De=V.messages)!==null&&De!==void 0?De:!0,inlineRefs:(je=V.inlineRefs)!==null&&je!==void 0?je:!0,schemaId:(Oe=V.schemaId)!==null&&Oe!==void 0?Oe:"$id",addUsedSchema:(Se=V.addUsedSchema)!==null&&Se!==void 0?Se:!0,validateSchema:(ot=V.validateSchema)!==null&&ot!==void 0?ot:!0,validateFormats:(Me=V.validateFormats)!==null&&Me!==void 0?Me:!0,unicodeRegExp:(Vr=V.unicodeRegExp)!==null&&Vr!==void 0?Vr:!0,int32range:(Lr=V.int32range)!==null&&Lr!==void 0?Lr:!0,uriResolver:eo}}class b{constructor(k={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,k=this.opts={...k,...m(k)};const{es5:D,lines:O}=this.opts.code;this.scope=new s.ValueScope({scope:{},prefixes:_,es5:D,lines:O}),this.logger=z(k.logger);const S=k.validateFormats;k.validateFormats=!1,this.RULES=(0,a.getRules)(),h.call(this,i,k,"NOT SUPPORTED"),h.call(this,d,k,"DEPRECATED","warn"),this._metaOpts=M.call(this),k.formats&&R.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),k.keywords&&A.call(this,k.keywords),typeof k.meta=="object"&&this.addMetaSchema(k.meta),E.call(this),k.validateFormats=S}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:k,meta:D,schemaId:O}=this.opts;let S=w;O==="id"&&(S={...w},S.id=S.$id,delete S.$id),D&&k&&this.addMetaSchema(S,S[O],!1)}defaultMeta(){const{meta:k,schemaId:D}=this.opts;return this.opts.defaultMeta=typeof k=="object"?k[D]||k:void 0}validate(k,D){let O;if(typeof k=="string"){if(O=this.getSchema(k),!O)throw new Error(`no schema with key or ref "${k}"`)}else O=this.compile(k);const S=O(D);return"$async"in O||(this.errors=O.errors),S}compile(k,D){const O=this._addSchema(k,D);return O.validate||this._compileSchemaEnv(O)}compileAsync(k,D){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:O}=this.opts;return S.call(this,k,D);async function S(ae,I){await P.call(this,ae.$schema);const j=this._addSchema(ae,I);return j.validate||q.call(this,j)}async function P(ae){ae&&!this.getSchema(ae)&&await S.call(this,{$ref:ae},!0)}async function q(ae){try{return this._compileSchemaEnv(ae)}catch(I){if(!(I instanceof c.default))throw I;return G.call(this,I),await X.call(this,I.missingSchema),q.call(this,ae)}}function G({missingSchema:ae,missingRef:I}){if(this.refs[ae])throw new Error(`AnySchema ${ae} is loaded but ${I} cannot be resolved`)}async function X(ae){const I=await ie.call(this,ae);this.refs[ae]||await P.call(this,I.$schema),this.refs[ae]||this.addSchema(I,ae,D)}async function ie(ae){const I=this._loading[ae];if(I)return I;try{return await(this._loading[ae]=O(ae))}finally{delete this._loading[ae]}}}addSchema(k,D,O,S=this.opts.validateSchema){if(Array.isArray(k)){for(const q of k)this.addSchema(q,void 0,O,S);return this}let P;if(typeof k=="object"){const{schemaId:q}=this.opts;if(P=k[q],P!==void 0&&typeof P!="string")throw new Error(`schema ${q} must be string`)}return D=(0,l.normalizeId)(D||P),this._checkUnique(D),this.schemas[D]=this._addSchema(k,O,D,S,!0),this}addMetaSchema(k,D,O=this.opts.validateSchema){return this.addSchema(k,D,!0,O),this}validateSchema(k,D){if(typeof k=="boolean")return!0;let O;if(O=k.$schema,O!==void 0&&typeof O!="string")throw new Error("$schema must be a string");if(O=O||this.opts.defaultMeta||this.defaultMeta(),!O)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const S=this.validate(O,k);if(!S&&D){const P="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(P);else throw new Error(P)}return S}getSchema(k){let D;for(;typeof(D=$.call(this,k))=="string";)k=D;if(D===void 0){const{schemaId:O}=this.opts,S=new o.SchemaEnv({schema:{},schemaId:O});if(D=o.resolveSchema.call(this,S,k),!D)return;this.refs[k]=D}return D.validate||this._compileSchemaEnv(D)}removeSchema(k){if(k instanceof RegExp)return this._removeAllSchemas(this.schemas,k),this._removeAllSchemas(this.refs,k),this;switch(typeof k){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const D=$.call(this,k);return typeof D=="object"&&this._cache.delete(D.schema),delete this.schemas[k],delete this.refs[k],this}case"object":{const D=k;this._cache.delete(D);let O=k[this.opts.schemaId];return O&&(O=(0,l.normalizeId)(O),delete this.schemas[O],delete this.refs[O]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(k){for(const D of k)this.addKeyword(D);return this}addKeyword(k,D){let O;if(typeof k=="string")O=k,typeof D=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),D.keyword=O);else if(typeof k=="object"&&D===void 0){if(D=k,O=D.keyword,Array.isArray(O)&&!O.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(U.call(this,O,D),!D)return(0,f.eachItem)(O,P=>Z.call(this,P)),this;$e.call(this,D);const S={...D,type:(0,v.getJSONTypes)(D.type),schemaType:(0,v.getJSONTypes)(D.schemaType)};return(0,f.eachItem)(O,S.type.length===0?P=>Z.call(this,P,S):P=>S.type.forEach(q=>Z.call(this,P,S,q))),this}getKeyword(k){const D=this.RULES.all[k];return typeof D=="object"?D.definition:!!D}removeKeyword(k){const{RULES:D}=this;delete D.keywords[k],delete D.all[k];for(const O of D.rules){const S=O.rules.findIndex(P=>P.keyword===k);S>=0&&O.rules.splice(S,1)}return this}addFormat(k,D){return typeof D=="string"&&(D=new RegExp(D)),this.formats[k]=D,this}errorsText(k=this.errors,{separator:D=", ",dataVar:O="data"}={}){return!k||k.length===0?"No errors":k.map(S=>`${O}${S.instancePath} ${S.message}`).reduce((S,P)=>S+D+P)}$dataMetaSchema(k,D){const O=this.RULES.all;k=JSON.parse(JSON.stringify(k));for(const S of D){const P=S.split("/").slice(1);let q=k;for(const G of P)q=q[G];for(const G in O){const X=O[G];if(typeof X!="object")continue;const{$data:ie}=X.definition,ae=q[G];ie&&ae&&(q[G]=Ce(ae))}}return k}_removeAllSchemas(k,D){for(const O in k){const S=k[O];(!D||D.test(O))&&(typeof S=="string"?delete k[O]:S&&!S.meta&&(this._cache.delete(S.schema),delete k[O]))}}_addSchema(k,D,O,S=this.opts.validateSchema,P=this.opts.addUsedSchema){let q;const{schemaId:G}=this.opts;if(typeof k=="object")q=k[G];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof k!="boolean")throw new Error("schema must be object or boolean")}let X=this._cache.get(k);if(X!==void 0)return X;O=(0,l.normalizeId)(q||O);const ie=l.getSchemaRefs.call(this,k,O);return X=new o.SchemaEnv({schema:k,schemaId:G,meta:D,baseId:O,localRefs:ie}),this._cache.set(X.schema,X),P&&!O.startsWith("#")&&(O&&this._checkUnique(O),this.refs[O]=X),S&&this.validateSchema(k,!0),X}_checkUnique(k){if(this.schemas[k]||this.refs[k])throw new Error(`schema with key or id "${k}" already exists`)}_compileSchemaEnv(k){if(k.meta?this._compileMetaSchema(k):o.compileSchema.call(this,k),!k.validate)throw new Error("ajv implementation error");return k.validate}_compileMetaSchema(k){const D=this.opts;this.opts=this._metaOpts;try{o.compileSchema.call(this,k)}finally{this.opts=D}}}b.ValidationError=n.default,b.MissingRefError=c.default,e.default=b;function h(V,k,D,O="error"){for(const S in V){const P=S;P in k&&this.logger[O](`${D}: option ${S}. ${V[P]}`)}}function $(V){return V=(0,l.normalizeId)(V),this.schemas[V]||this.refs[V]}function E(){const V=this.opts.schemas;if(V)if(Array.isArray(V))this.addSchema(V);else for(const k in V)this.addSchema(V[k],k)}function R(){for(const V in this.opts.formats){const k=this.opts.formats[V];k&&this.addFormat(V,k)}}function A(V){if(Array.isArray(V)){this.addVocabulary(V);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const k in V){const D=V[k];D.keyword||(D.keyword=k),this.addKeyword(D)}}function M(){const V={...this.opts};for(const k of y)delete V[k];return V}const N={log(){},warn(){},error(){}};function z(V){if(V===!1)return N;if(V===void 0)return console;if(V.log&&V.warn&&V.error)return V;throw new Error("logger must implement log, warn and error methods")}const L=/^[a-z_$][a-z0-9_$:-]*$/i;function U(V,k){const{RULES:D}=this;if((0,f.eachItem)(V,O=>{if(D.keywords[O])throw new Error(`Keyword ${O} is already defined`);if(!L.test(O))throw new Error(`Keyword ${O} has invalid name`)}),!!k&&k.$data&&!("code"in k||"validate"in k))throw new Error('$data keyword must have "code" or "validate" function')}function Z(V,k,D){var O;const S=k?.post;if(D&&S)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:P}=this;let q=S?P.post:P.rules.find(({type:X})=>X===D);if(q||(q={type:D,rules:[]},P.rules.push(q)),P.keywords[V]=!0,!k)return;const G={keyword:V,definition:{...k,type:(0,v.getJSONTypes)(k.type),schemaType:(0,v.getJSONTypes)(k.schemaType)}};k.before?me.call(this,q,G,k.before):q.rules.push(G),P.all[V]=G,(O=k.implements)===null||O===void 0||O.forEach(X=>this.addKeyword(X))}function me(V,k,D){const O=V.rules.findIndex(S=>S.keyword===D);O>=0?V.rules.splice(O,0,k):(V.rules.push(k),this.logger.warn(`rule ${D} is not defined`))}function $e(V){let{metaSchema:k}=V;k!==void 0&&(V.$data&&this.opts.$data&&(k=Ce(k)),V.validateSchema=this.compile(k,!0))}const oe={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Ce(V){return{anyOf:[V,oe]}}})(Jr)),Jr}var Tt={},Mt={},qt={},ca;function ii(){if(ca)return qt;ca=1,Object.defineProperty(qt,"__esModule",{value:!0});const e={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};return qt.default=e,qt}var Qe={},ua;function bn(){if(ua)return Qe;ua=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.callRef=Qe.getValidate=void 0;const e=St(),t=Ve(),r=Q(),n=Ue(),c=Cr(),a=ne(),o={keyword:"$ref",schemaType:"string",code(v){const{gen:f,schema:w,it:g}=v,{baseId:p,schemaEnv:y,validateName:_,opts:i,self:d}=g,{root:u}=y;if((w==="#"||w==="#/")&&p===u.baseId)return b();const m=c.resolveRef.call(d,u,p,w);if(m===void 0)throw new e.default(g.opts.uriResolver,p,w);if(m instanceof c.SchemaEnv)return h(m);return $(m);function b(){if(y===u)return l(v,_,y,y.$async);const E=f.scopeValue("root",{ref:u});return l(v,(0,r._)`${E}.validate`,u,u.$async)}function h(E){const R=s(v,E);l(v,R,E,E.$async)}function $(E){const R=f.scopeValue("schema",i.code.source===!0?{ref:E,code:(0,r.stringify)(E)}:{ref:E}),A=f.name("valid"),M=v.subschema({schema:E,dataTypes:[],schemaPath:r.nil,topSchemaRef:R,errSchemaPath:w},A);v.mergeEvaluated(M),v.ok(A)}}};function s(v,f){const{gen:w}=v;return f.validate?w.scopeValue("validate",{ref:f.validate}):(0,r._)`${w.scopeValue("wrapper",{ref:f})}.validate`}Qe.getValidate=s;function l(v,f,w,g){const{gen:p,it:y}=v,{allErrors:_,schemaEnv:i,opts:d}=y,u=d.passContext?n.default.this:r.nil;g?m():b();function m(){if(!i.$async)throw new Error("async schema referenced by sync schema");const E=p.let("valid");p.try(()=>{p.code((0,r._)`await ${(0,t.callValidateCode)(v,f,u)}`),$(f),_||p.assign(E,!0)},R=>{p.if((0,r._)`!(${R} instanceof ${y.ValidationError})`,()=>p.throw(R)),h(R),_||p.assign(E,!1)}),v.ok(E)}function b(){v.result((0,t.callValidateCode)(v,f,u),()=>$(f),()=>h(f))}function h(E){const R=(0,r._)`${E}.errors`;p.assign(n.default.vErrors,(0,r._)`${n.default.vErrors} === null ? ${R} : ${n.default.vErrors}.concat(${R})`),p.assign(n.default.errors,(0,r._)`${n.default.vErrors}.length`)}function $(E){var R;if(!y.opts.unevaluated)return;const A=(R=w?.validate)===null||R===void 0?void 0:R.evaluated;if(y.props!==!0)if(A&&!A.dynamicProps)A.props!==void 0&&(y.props=a.mergeEvaluated.props(p,A.props,y.props));else{const M=p.var("props",(0,r._)`${E}.evaluated.props`);y.props=a.mergeEvaluated.props(p,M,y.props,r.Name)}if(y.items!==!0)if(A&&!A.dynamicItems)A.items!==void 0&&(y.items=a.mergeEvaluated.items(p,A.items,y.items));else{const M=p.var("items",(0,r._)`${E}.evaluated.items`);y.items=a.mergeEvaluated.items(p,M,y.items,r.Name)}}}return Qe.callRef=l,Qe.default=o,Qe}var la;function As(){if(la)return Mt;la=1,Object.defineProperty(Mt,"__esModule",{value:!0});const e=ii(),t=bn(),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",e.default,t.default];return Mt.default=r,Mt}var At={},Ct={},da;function ci(){if(da)return Ct;da=1,Object.defineProperty(Ct,"__esModule",{value:!0});const e=Q(),t=e.operators,r={maximum:{okStr:"<=",ok:t.LTE,fail:t.GT},minimum:{okStr:">=",ok:t.GTE,fail:t.LT},exclusiveMaximum:{okStr:"<",ok:t.LT,fail:t.GTE},exclusiveMinimum:{okStr:">",ok:t.GT,fail:t.LTE}},n={message:({keyword:a,schemaCode:o})=>(0,e.str)`must be ${r[a].okStr} ${o}`,params:({keyword:a,schemaCode:o})=>(0,e._)`{comparison: ${r[a].okStr}, limit: ${o}}`},c={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:n,code(a){const{keyword:o,data:s,schemaCode:l}=a;a.fail$data((0,e._)`${s} ${r[o].fail} ${l} || isNaN(${s})`)}};return Ct.default=c,Ct}var Dt={},fa;function ui(){if(fa)return Dt;fa=1,Object.defineProperty(Dt,"__esModule",{value:!0});const e=Q(),r={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must be multiple of ${n}`,params:({schemaCode:n})=>(0,e._)`{multipleOf: ${n}}`},code(n){const{gen:c,data:a,schemaCode:o,it:s}=n,l=s.opts.multipleOfPrecision,v=c.let("res"),f=l?(0,e._)`Math.abs(Math.round(${v}) - ${v}) > 1e-${l}`:(0,e._)`${v} !== parseInt(${v})`;n.fail$data((0,e._)`(${o} === 0 || (${v} = ${a}/${o}, ${f}))`)}};return Dt.default=r,Dt}var zt={},Ut={},ma;function li(){if(ma)return Ut;ma=1,Object.defineProperty(Ut,"__esModule",{value:!0});function e(t){const r=t.length;let n=0,c=0,a;for(;c<r;)n++,a=t.charCodeAt(c++),a>=55296&&a<=56319&&c<r&&(a=t.charCodeAt(c),(a&64512)===56320&&c++);return n}return Ut.default=e,e.code='require("ajv/dist/runtime/ucs2length").default',Ut}var ha;function di(){if(ha)return zt;ha=1,Object.defineProperty(zt,"__esModule",{value:!0});const e=Q(),t=ne(),r=li(),c={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:a,schemaCode:o}){const s=a==="maxLength"?"more":"fewer";return(0,e.str)`must NOT have ${s} than ${o} characters`},params:({schemaCode:a})=>(0,e._)`{limit: ${a}}`},code(a){const{keyword:o,data:s,schemaCode:l,it:v}=a,f=o==="maxLength"?e.operators.GT:e.operators.LT,w=v.opts.unicode===!1?(0,e._)`${s}.length`:(0,e._)`${(0,t.useFunc)(a.gen,r.default)}(${s})`;a.fail$data((0,e._)`${w} ${f} ${l}`)}};return zt.default=c,zt}var Vt={},pa;function fi(){if(pa)return Vt;pa=1,Object.defineProperty(Vt,"__esModule",{value:!0});const e=Ve(),t=Q(),n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:c})=>(0,t.str)`must match pattern "${c}"`,params:({schemaCode:c})=>(0,t._)`{pattern: ${c}}`},code(c){const{data:a,$data:o,schema:s,schemaCode:l,it:v}=c,f=v.opts.unicodeRegExp?"u":"",w=o?(0,t._)`(new RegExp(${l}, ${f}))`:(0,e.usePattern)(c,s);c.fail$data((0,t._)`!${w}.test(${a})`)}};return Vt.default=n,Vt}var Lt={},va;function mi(){if(va)return Lt;va=1,Object.defineProperty(Lt,"__esModule",{value:!0});const e=Q(),r={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:c}){const a=n==="maxProperties"?"more":"fewer";return(0,e.str)`must NOT have ${a} than ${c} properties`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:c,data:a,schemaCode:o}=n,s=c==="maxProperties"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`Object.keys(${a}).length ${s} ${o}`)}};return Lt.default=r,Lt}var Ft={},ga;function hi(){if(ga)return Ft;ga=1,Object.defineProperty(Ft,"__esModule",{value:!0});const e=Ve(),t=Q(),r=ne(),c={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:a}})=>(0,t.str)`must have required property '${a}'`,params:({params:{missingProperty:a}})=>(0,t._)`{missingProperty: ${a}}`},code(a){const{gen:o,schema:s,schemaCode:l,data:v,$data:f,it:w}=a,{opts:g}=w;if(!f&&s.length===0)return;const p=s.length>=g.loopRequired;if(w.allErrors?y():_(),g.strictRequired){const u=a.parentSchema.properties,{definedProperties:m}=a.it;for(const b of s)if(u?.[b]===void 0&&!m.has(b)){const h=w.schemaEnv.baseId+w.errSchemaPath,$=`required property "${b}" is not defined at "${h}" (strictRequired)`;(0,r.checkStrictMode)(w,$,w.opts.strictRequired)}}function y(){if(p||f)a.block$data(t.nil,i);else for(const u of s)(0,e.checkReportMissingProp)(a,u)}function _(){const u=o.let("missing");if(p||f){const m=o.let("valid",!0);a.block$data(m,()=>d(u,m)),a.ok(m)}else o.if((0,e.checkMissingProp)(a,s,u)),(0,e.reportMissingProp)(a,u),o.else()}function i(){o.forOf("prop",l,u=>{a.setParams({missingProperty:u}),o.if((0,e.noPropertyInData)(o,v,u,g.ownProperties),()=>a.error())})}function d(u,m){a.setParams({missingProperty:u}),o.forOf(u,l,()=>{o.assign(m,(0,e.propertyInData)(o,v,u,g.ownProperties)),o.if((0,t.not)(m),()=>{a.error(),o.break()})},t.nil)}}};return Ft.default=c,Ft}var Ht={},ya;function pi(){if(ya)return Ht;ya=1,Object.defineProperty(Ht,"__esModule",{value:!0});const e=Q(),r={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:n,schemaCode:c}){const a=n==="maxItems"?"more":"fewer";return(0,e.str)`must NOT have ${a} than ${c} items`},params:({schemaCode:n})=>(0,e._)`{limit: ${n}}`},code(n){const{keyword:c,data:a,schemaCode:o}=n,s=c==="maxItems"?e.operators.GT:e.operators.LT;n.fail$data((0,e._)`${a}.length ${s} ${o}`)}};return Ht.default=r,Ht}var Kt={},xt={},_a;function wn(){if(_a)return xt;_a=1,Object.defineProperty(xt,"__esModule",{value:!0});const e=Ts();return e.code='require("ajv/dist/runtime/equal").default',xt.default=e,xt}var $a;function vi(){if($a)return Kt;$a=1,Object.defineProperty(Kt,"__esModule",{value:!0});const e=jr(),t=Q(),r=ne(),n=wn(),a={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:o,j:s}})=>(0,t.str)`must NOT have duplicate items (items ## ${s} and ${o} are identical)`,params:({params:{i:o,j:s}})=>(0,t._)`{i: ${o}, j: ${s}}`},code(o){const{gen:s,data:l,$data:v,schema:f,parentSchema:w,schemaCode:g,it:p}=o;if(!v&&!f)return;const y=s.let("valid"),_=w.items?(0,e.getSchemaTypes)(w.items):[];o.block$data(y,i,(0,t._)`${g} === false`),o.ok(y);function i(){const b=s.let("i",(0,t._)`${l}.length`),h=s.let("j");o.setParams({i:b,j:h}),s.assign(y,!0),s.if((0,t._)`${b} > 1`,()=>(d()?u:m)(b,h))}function d(){return _.length>0&&!_.some(b=>b==="object"||b==="array")}function u(b,h){const $=s.name("item"),E=(0,e.checkDataTypes)(_,$,p.opts.strictNumbers,e.DataType.Wrong),R=s.const("indices",(0,t._)`{}`);s.for((0,t._)`;${b}--;`,()=>{s.let($,(0,t._)`${l}[${b}]`),s.if(E,(0,t._)`continue`),_.length>1&&s.if((0,t._)`typeof ${$} == "string"`,(0,t._)`${$} += "_"`),s.if((0,t._)`typeof ${R}[${$}] == "number"`,()=>{s.assign(h,(0,t._)`${R}[${$}]`),o.error(),s.assign(y,!1).break()}).code((0,t._)`${R}[${$}] = ${b}`)})}function m(b,h){const $=(0,r.useFunc)(s,n.default),E=s.name("outer");s.label(E).for((0,t._)`;${b}--;`,()=>s.for((0,t._)`${h} = ${b}; ${h}--;`,()=>s.if((0,t._)`${$}(${l}[${b}], ${l}[${h}])`,()=>{o.error(),s.assign(y,!1).break(E)})))}}};return Kt.default=a,Kt}var Gt={},ba;function gi(){if(ba)return Gt;ba=1,Object.defineProperty(Gt,"__esModule",{value:!0});const e=Q(),t=ne(),r=wn(),c={keyword:"const",$data:!0,error:{message:"must be equal to constant",params:({schemaCode:a})=>(0,e._)`{allowedValue: ${a}}`},code(a){const{gen:o,data:s,$data:l,schemaCode:v,schema:f}=a;l||f&&typeof f=="object"?a.fail$data((0,e._)`!${(0,t.useFunc)(o,r.default)}(${s}, ${v})`):a.fail((0,e._)`${f} !== ${s}`)}};return Gt.default=c,Gt}var Bt={},wa;function yi(){if(wa)return Bt;wa=1,Object.defineProperty(Bt,"__esModule",{value:!0});const e=Q(),t=ne(),r=wn(),c={keyword:"enum",schemaType:"array",$data:!0,error:{message:"must be equal to one of the allowed values",params:({schemaCode:a})=>(0,e._)`{allowedValues: ${a}}`},code(a){const{gen:o,data:s,$data:l,schema:v,schemaCode:f,it:w}=a;if(!l&&v.length===0)throw new Error("enum must have non-empty array");const g=v.length>=w.opts.loopEnum;let p;const y=()=>p??(p=(0,t.useFunc)(o,r.default));let _;if(g||l)_=o.let("valid"),a.block$data(_,i);else{if(!Array.isArray(v))throw new Error("ajv implementation error");const u=o.const("vSchema",f);_=(0,e.or)(...v.map((m,b)=>d(u,b)))}a.pass(_);function i(){o.assign(_,!1),o.forOf("v",f,u=>o.if((0,e._)`${y()}(${s}, ${u})`,()=>o.assign(_,!0).break()))}function d(u,m){const b=v[m];return typeof b=="object"&&b!==null?(0,e._)`${y()}(${s}, ${u}[${m}])`:(0,e._)`${s} === ${b}`}}};return Bt.default=c,Bt}var Sa;function Cs(){if(Sa)return At;Sa=1,Object.defineProperty(At,"__esModule",{value:!0});const e=ci(),t=ui(),r=di(),n=fi(),c=mi(),a=hi(),o=pi(),s=vi(),l=gi(),v=yi(),f=[e.default,t.default,r.default,n.default,c.default,a.default,o.default,s.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},l.default,v.default];return At.default=f,At}var Wt={},it={},Ea;function Ds(){if(Ea)return it;Ea=1,Object.defineProperty(it,"__esModule",{value:!0}),it.validateAdditionalItems=void 0;const e=Q(),t=ne(),n={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:a}})=>(0,e.str)`must NOT have more than ${a} items`,params:({params:{len:a}})=>(0,e._)`{limit: ${a}}`},code(a){const{parentSchema:o,it:s}=a,{items:l}=o;if(!Array.isArray(l)){(0,t.checkStrictMode)(s,'"additionalItems" is ignored when "items" is not an array of schemas');return}c(a,l)}};function c(a,o){const{gen:s,schema:l,data:v,keyword:f,it:w}=a;w.items=!0;const g=s.const("len",(0,e._)`${v}.length`);if(l===!1)a.setParams({len:o.length}),a.pass((0,e._)`${g} <= ${o.length}`);else if(typeof l=="object"&&!(0,t.alwaysValidSchema)(w,l)){const y=s.var("valid",(0,e._)`${g} <= ${o.length}`);s.if((0,e.not)(y),()=>p(y)),a.ok(y)}function p(y){s.forRange("i",o.length,g,_=>{a.subschema({keyword:f,dataProp:_,dataPropType:t.Type.Num},y),w.allErrors||s.if((0,e.not)(y),()=>s.break())})}}return it.validateAdditionalItems=c,it.default=n,it}var Jt={},ct={},Pa;function zs(){if(Pa)return ct;Pa=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.validateTuple=void 0;const e=Q(),t=ne(),r=Ve(),n={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(a){const{schema:o,it:s}=a;if(Array.isArray(o))return c(a,"additionalItems",o);s.items=!0,!(0,t.alwaysValidSchema)(s,o)&&a.ok((0,r.validateArray)(a))}};function c(a,o,s=a.schema){const{gen:l,parentSchema:v,data:f,keyword:w,it:g}=a;_(v),g.opts.unevaluated&&s.length&&g.items!==!0&&(g.items=t.mergeEvaluated.items(l,s.length,g.items));const p=l.name("valid"),y=l.const("len",(0,e._)`${f}.length`);s.forEach((i,d)=>{(0,t.alwaysValidSchema)(g,i)||(l.if((0,e._)`${y} > ${d}`,()=>a.subschema({keyword:w,schemaProp:d,dataProp:d},p)),a.ok(p))});function _(i){const{opts:d,errSchemaPath:u}=g,m=s.length,b=m===i.minItems&&(m===i.maxItems||i[o]===!1);if(d.strictTuples&&!b){const h=`"${w}" is ${m}-tuple, but minItems or maxItems/${o} are not specified or different at path "${u}"`;(0,t.checkStrictMode)(g,h,d.strictTuples)}}}return ct.validateTuple=c,ct.default=n,ct}var Ia;function _i(){if(Ia)return Jt;Ia=1,Object.defineProperty(Jt,"__esModule",{value:!0});const e=zs(),t={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:r=>(0,e.validateTuple)(r,"items")};return Jt.default=t,Jt}var Yt={},ka;function $i(){if(ka)return Yt;ka=1,Object.defineProperty(Yt,"__esModule",{value:!0});const e=Q(),t=ne(),r=Ve(),n=Ds(),a={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:{message:({params:{len:o}})=>(0,e.str)`must NOT have more than ${o} items`,params:({params:{len:o}})=>(0,e._)`{limit: ${o}}`},code(o){const{schema:s,parentSchema:l,it:v}=o,{prefixItems:f}=l;v.items=!0,!(0,t.alwaysValidSchema)(v,s)&&(f?(0,n.validateAdditionalItems)(o,f):o.ok((0,r.validateArray)(o)))}};return Yt.default=a,Yt}var Xt={},Ra;function bi(){if(Ra)return Xt;Ra=1,Object.defineProperty(Xt,"__esModule",{value:!0});const e=Q(),t=ne(),n={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:c,max:a}})=>a===void 0?(0,e.str)`must contain at least ${c} valid item(s)`:(0,e.str)`must contain at least ${c} and no more than ${a} valid item(s)`,params:({params:{min:c,max:a}})=>a===void 0?(0,e._)`{minContains: ${c}}`:(0,e._)`{minContains: ${c}, maxContains: ${a}}`},code(c){const{gen:a,schema:o,parentSchema:s,data:l,it:v}=c;let f,w;const{minContains:g,maxContains:p}=s;v.opts.next?(f=g===void 0?1:g,w=p):f=1;const y=a.const("len",(0,e._)`${l}.length`);if(c.setParams({min:f,max:w}),w===void 0&&f===0){(0,t.checkStrictMode)(v,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(w!==void 0&&f>w){(0,t.checkStrictMode)(v,'"minContains" > "maxContains" is always invalid'),c.fail();return}if((0,t.alwaysValidSchema)(v,o)){let m=(0,e._)`${y} >= ${f}`;w!==void 0&&(m=(0,e._)`${m} && ${y} <= ${w}`),c.pass(m);return}v.items=!0;const _=a.name("valid");w===void 0&&f===1?d(_,()=>a.if(_,()=>a.break())):f===0?(a.let(_,!0),w!==void 0&&a.if((0,e._)`${l}.length > 0`,i)):(a.let(_,!1),i()),c.result(_,()=>c.reset());function i(){const m=a.name("_valid"),b=a.let("count",0);d(m,()=>a.if(m,()=>u(b)))}function d(m,b){a.forRange("i",0,y,h=>{c.subschema({keyword:"contains",dataProp:h,dataPropType:t.Type.Num,compositeRule:!0},m),b()})}function u(m){a.code((0,e._)`${m}++`),w===void 0?a.if((0,e._)`${m} >= ${f}`,()=>a.assign(_,!0).break()):(a.if((0,e._)`${m} > ${w}`,()=>a.assign(_,!1).break()),f===1?a.assign(_,!0):a.if((0,e._)`${m} >= ${f}`,()=>a.assign(_,!0)))}}};return Xt.default=n,Xt}var an={},ja;function Sn(){return ja||(ja=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=Q(),r=ne(),n=Ve();e.error={message:({params:{property:l,depsCount:v,deps:f}})=>{const w=v===1?"property":"properties";return(0,t.str)`must have ${w} ${f} when property ${l} is present`},params:({params:{property:l,depsCount:v,deps:f,missingProperty:w}})=>(0,t._)`{property: ${l},
    missingProperty: ${w},
    depsCount: ${v},
    deps: ${f}}`};const c={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(l){const[v,f]=a(l);o(l,v),s(l,f)}};function a({schema:l}){const v={},f={};for(const w in l){if(w==="__proto__")continue;const g=Array.isArray(l[w])?v:f;g[w]=l[w]}return[v,f]}function o(l,v=l.schema){const{gen:f,data:w,it:g}=l;if(Object.keys(v).length===0)return;const p=f.let("missing");for(const y in v){const _=v[y];if(_.length===0)continue;const i=(0,n.propertyInData)(f,w,y,g.opts.ownProperties);l.setParams({property:y,depsCount:_.length,deps:_.join(", ")}),g.allErrors?f.if(i,()=>{for(const d of _)(0,n.checkReportMissingProp)(l,d)}):(f.if((0,t._)`${i} && (${(0,n.checkMissingProp)(l,_,p)})`),(0,n.reportMissingProp)(l,p),f.else())}}e.validatePropertyDeps=o;function s(l,v=l.schema){const{gen:f,data:w,keyword:g,it:p}=l,y=f.name("valid");for(const _ in v)(0,r.alwaysValidSchema)(p,v[_])||(f.if((0,n.propertyInData)(f,w,_,p.opts.ownProperties),()=>{const i=l.subschema({keyword:g,schemaProp:_},y);l.mergeValidEvaluated(i,y)},()=>f.var(y,!0)),l.ok(y))}e.validateSchemaDeps=s,e.default=c})(an)),an}var Zt={},Oa;function wi(){if(Oa)return Zt;Oa=1,Object.defineProperty(Zt,"__esModule",{value:!0});const e=Q(),t=ne(),n={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:"property name must be valid",params:({params:c})=>(0,e._)`{propertyName: ${c.propertyName}}`},code(c){const{gen:a,schema:o,data:s,it:l}=c;if((0,t.alwaysValidSchema)(l,o))return;const v=a.name("valid");a.forIn("key",s,f=>{c.setParams({propertyName:f}),c.subschema({keyword:"propertyNames",data:f,dataTypes:["string"],propertyName:f,compositeRule:!0},v),a.if((0,e.not)(v),()=>{c.error(!0),l.allErrors||a.break()})}),c.ok(v)}};return Zt.default=n,Zt}var Qt={},Na;function Us(){if(Na)return Qt;Na=1,Object.defineProperty(Qt,"__esModule",{value:!0});const e=Ve(),t=Q(),r=Ue(),n=ne(),a={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"must NOT have additional properties",params:({params:o})=>(0,t._)`{additionalProperty: ${o.additionalProperty}}`},code(o){const{gen:s,schema:l,parentSchema:v,data:f,errsCount:w,it:g}=o;if(!w)throw new Error("ajv implementation error");const{allErrors:p,opts:y}=g;if(g.props=!0,y.removeAdditional!=="all"&&(0,n.alwaysValidSchema)(g,l))return;const _=(0,e.allSchemaProperties)(v.properties),i=(0,e.allSchemaProperties)(v.patternProperties);d(),o.ok((0,t._)`${w} === ${r.default.errors}`);function d(){s.forIn("key",f,$=>{!_.length&&!i.length?b($):s.if(u($),()=>b($))})}function u($){let E;if(_.length>8){const R=(0,n.schemaRefOrVal)(g,v.properties,"properties");E=(0,e.isOwnProperty)(s,R,$)}else _.length?E=(0,t.or)(..._.map(R=>(0,t._)`${$} === ${R}`)):E=t.nil;return i.length&&(E=(0,t.or)(E,...i.map(R=>(0,t._)`${(0,e.usePattern)(o,R)}.test(${$})`))),(0,t.not)(E)}function m($){s.code((0,t._)`delete ${f}[${$}]`)}function b($){if(y.removeAdditional==="all"||y.removeAdditional&&l===!1){m($);return}if(l===!1){o.setParams({additionalProperty:$}),o.error(),p||s.break();return}if(typeof l=="object"&&!(0,n.alwaysValidSchema)(g,l)){const E=s.name("valid");y.removeAdditional==="failing"?(h($,E,!1),s.if((0,t.not)(E),()=>{o.reset(),m($)})):(h($,E),p||s.if((0,t.not)(E),()=>s.break()))}}function h($,E,R){const A={keyword:"additionalProperties",dataProp:$,dataPropType:n.Type.Str};R===!1&&Object.assign(A,{compositeRule:!0,createErrors:!1,allErrors:!1}),o.subschema(A,E)}}};return Qt.default=a,Qt}var er={},Ta;function Si(){if(Ta)return er;Ta=1,Object.defineProperty(er,"__esModule",{value:!0});const e=wt(),t=Ve(),r=ne(),n=Us(),c={keyword:"properties",type:"object",schemaType:"object",code(a){const{gen:o,schema:s,parentSchema:l,data:v,it:f}=a;f.opts.removeAdditional==="all"&&l.additionalProperties===void 0&&n.default.code(new e.KeywordCxt(f,n.default,"additionalProperties"));const w=(0,t.allSchemaProperties)(s);for(const i of w)f.definedProperties.add(i);f.opts.unevaluated&&w.length&&f.props!==!0&&(f.props=r.mergeEvaluated.props(o,(0,r.toHash)(w),f.props));const g=w.filter(i=>!(0,r.alwaysValidSchema)(f,s[i]));if(g.length===0)return;const p=o.name("valid");for(const i of g)y(i)?_(i):(o.if((0,t.propertyInData)(o,v,i,f.opts.ownProperties)),_(i),f.allErrors||o.else().var(p,!0),o.endIf()),a.it.definedProperties.add(i),a.ok(p);function y(i){return f.opts.useDefaults&&!f.compositeRule&&s[i].default!==void 0}function _(i){a.subschema({keyword:"properties",schemaProp:i,dataProp:i},p)}}};return er.default=c,er}var tr={},Ma;function Ei(){if(Ma)return tr;Ma=1,Object.defineProperty(tr,"__esModule",{value:!0});const e=Ve(),t=Q(),r=ne(),n=ne(),c={keyword:"patternProperties",type:"object",schemaType:"object",code(a){const{gen:o,schema:s,data:l,parentSchema:v,it:f}=a,{opts:w}=f,g=(0,e.allSchemaProperties)(s),p=g.filter(b=>(0,r.alwaysValidSchema)(f,s[b]));if(g.length===0||p.length===g.length&&(!f.opts.unevaluated||f.props===!0))return;const y=w.strictSchema&&!w.allowMatchingProperties&&v.properties,_=o.name("valid");f.props!==!0&&!(f.props instanceof t.Name)&&(f.props=(0,n.evaluatedPropsToName)(o,f.props));const{props:i}=f;d();function d(){for(const b of g)y&&u(b),f.allErrors?m(b):(o.var(_,!0),m(b),o.if(_))}function u(b){for(const h in y)new RegExp(b).test(h)&&(0,r.checkStrictMode)(f,`property ${h} matches pattern ${b} (use allowMatchingProperties)`)}function m(b){o.forIn("key",l,h=>{o.if((0,t._)`${(0,e.usePattern)(a,b)}.test(${h})`,()=>{const $=p.includes(b);$||a.subschema({keyword:"patternProperties",schemaProp:b,dataProp:h,dataPropType:n.Type.Str},_),f.opts.unevaluated&&i!==!0?o.assign((0,t._)`${i}[${h}]`,!0):!$&&!f.allErrors&&o.if((0,t.not)(_),()=>o.break())})})}}};return tr.default=c,tr}var rr={},qa;function Pi(){if(qa)return rr;qa=1,Object.defineProperty(rr,"__esModule",{value:!0});const e=ne(),t={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(r){const{gen:n,schema:c,it:a}=r;if((0,e.alwaysValidSchema)(a,c)){r.fail();return}const o=n.name("valid");r.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),r.failResult(o,()=>r.reset(),()=>r.error())},error:{message:"must NOT be valid"}};return rr.default=t,rr}var nr={},Aa;function Ii(){if(Aa)return nr;Aa=1,Object.defineProperty(nr,"__esModule",{value:!0});const t={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Ve().validateUnion,error:{message:"must match a schema in anyOf"}};return nr.default=t,nr}var ar={},Ca;function ki(){if(Ca)return ar;Ca=1,Object.defineProperty(ar,"__esModule",{value:!0});const e=Q(),t=ne(),n={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"must match exactly one schema in oneOf",params:({params:c})=>(0,e._)`{passingSchemas: ${c.passing}}`},code(c){const{gen:a,schema:o,parentSchema:s,it:l}=c;if(!Array.isArray(o))throw new Error("ajv implementation error");if(l.opts.discriminator&&s.discriminator)return;const v=o,f=a.let("valid",!1),w=a.let("passing",null),g=a.name("_valid");c.setParams({passing:w}),a.block(p),c.result(f,()=>c.reset(),()=>c.error(!0));function p(){v.forEach((y,_)=>{let i;(0,t.alwaysValidSchema)(l,y)?a.var(g,!0):i=c.subschema({keyword:"oneOf",schemaProp:_,compositeRule:!0},g),_>0&&a.if((0,e._)`${g} && ${f}`).assign(f,!1).assign(w,(0,e._)`[${w}, ${_}]`).else(),a.if(g,()=>{a.assign(f,!0),a.assign(w,_),i&&c.mergeEvaluated(i,e.Name)})})}}};return ar.default=n,ar}var sr={},Da;function Ri(){if(Da)return sr;Da=1,Object.defineProperty(sr,"__esModule",{value:!0});const e=ne(),t={keyword:"allOf",schemaType:"array",code(r){const{gen:n,schema:c,it:a}=r;if(!Array.isArray(c))throw new Error("ajv implementation error");const o=n.name("valid");c.forEach((s,l)=>{if((0,e.alwaysValidSchema)(a,s))return;const v=r.subschema({keyword:"allOf",schemaProp:l},o);r.ok(o),r.mergeEvaluated(v)})}};return sr.default=t,sr}var or={},za;function ji(){if(za)return or;za=1,Object.defineProperty(or,"__esModule",{value:!0});const e=Q(),t=ne(),n={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:a})=>(0,e.str)`must match "${a.ifClause}" schema`,params:({params:a})=>(0,e._)`{failingKeyword: ${a.ifClause}}`},code(a){const{gen:o,parentSchema:s,it:l}=a;s.then===void 0&&s.else===void 0&&(0,t.checkStrictMode)(l,'"if" without "then" and "else" is ignored');const v=c(l,"then"),f=c(l,"else");if(!v&&!f)return;const w=o.let("valid",!0),g=o.name("_valid");if(p(),a.reset(),v&&f){const _=o.let("ifClause");a.setParams({ifClause:_}),o.if(g,y("then",_),y("else",_))}else v?o.if(g,y("then")):o.if((0,e.not)(g),y("else"));a.pass(w,()=>a.error(!0));function p(){const _=a.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},g);a.mergeEvaluated(_)}function y(_,i){return()=>{const d=a.subschema({keyword:_},g);o.assign(w,g),a.mergeValidEvaluated(d,w),i?o.assign(i,(0,e._)`${_}`):a.setParams({ifClause:_})}}}};function c(a,o){const s=a.schema[o];return s!==void 0&&!(0,t.alwaysValidSchema)(a,s)}return or.default=n,or}var ir={},Ua;function Oi(){if(Ua)return ir;Ua=1,Object.defineProperty(ir,"__esModule",{value:!0});const e=ne(),t={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:r,parentSchema:n,it:c}){n.if===void 0&&(0,e.checkStrictMode)(c,`"${r}" without "if" is ignored`)}};return ir.default=t,ir}var Va;function Vs(){if(Va)return Wt;Va=1,Object.defineProperty(Wt,"__esModule",{value:!0});const e=Ds(),t=_i(),r=zs(),n=$i(),c=bi(),a=Sn(),o=wi(),s=Us(),l=Si(),v=Ei(),f=Pi(),w=Ii(),g=ki(),p=Ri(),y=ji(),_=Oi();function i(d=!1){const u=[f.default,w.default,g.default,p.default,y.default,_.default,o.default,s.default,a.default,l.default,v.default];return d?u.push(t.default,n.default):u.push(e.default,r.default),u.push(c.default),u}return Wt.default=i,Wt}var cr={},ut={},La;function Ls(){if(La)return ut;La=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.dynamicAnchor=void 0;const e=Q(),t=Ue(),r=Cr(),n=bn(),c={keyword:"$dynamicAnchor",schemaType:"string",code:s=>a(s,s.schema)};function a(s,l){const{gen:v,it:f}=s;f.schemaEnv.root.dynamicAnchors[l]=!0;const w=(0,e._)`${t.default.dynamicAnchors}${(0,e.getProperty)(l)}`,g=f.errSchemaPath==="#"?f.validateName:o(s);v.if((0,e._)`!${w}`,()=>v.assign(w,g))}ut.dynamicAnchor=a;function o(s){const{schemaEnv:l,schema:v,self:f}=s.it,{root:w,baseId:g,localRefs:p,meta:y}=l.root,{schemaId:_}=f.opts,i=new r.SchemaEnv({schema:v,schemaId:_,root:w,baseId:g,localRefs:p,meta:y});return r.compileSchema.call(f,i),(0,n.getValidate)(s,i)}return ut.default=c,ut}var lt={},Fa;function Fs(){if(Fa)return lt;Fa=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.dynamicRef=void 0;const e=Q(),t=Ue(),r=bn(),n={keyword:"$dynamicRef",schemaType:"string",code:a=>c(a,a.schema)};function c(a,o){const{gen:s,keyword:l,it:v}=a;if(o[0]!=="#")throw new Error(`"${l}" only supports hash fragment reference`);const f=o.slice(1);if(v.allErrors)w();else{const p=s.let("valid",!1);w(p),a.ok(p)}function w(p){if(v.schemaEnv.root.dynamicAnchors[f]){const y=s.let("_v",(0,e._)`${t.default.dynamicAnchors}${(0,e.getProperty)(f)}`);s.if(y,g(y,p),g(v.validateName,p))}else g(v.validateName,p)()}function g(p,y){return y?()=>s.block(()=>{(0,r.callRef)(a,p),s.let(y,!0)}):()=>(0,r.callRef)(a,p)}}return lt.dynamicRef=c,lt.default=n,lt}var ur={},Ha;function Ni(){if(Ha)return ur;Ha=1,Object.defineProperty(ur,"__esModule",{value:!0});const e=Ls(),t=ne(),r={keyword:"$recursiveAnchor",schemaType:"boolean",code(n){n.schema?(0,e.dynamicAnchor)(n,""):(0,t.checkStrictMode)(n.it,"$recursiveAnchor: false is ignored")}};return ur.default=r,ur}var lr={},Ka;function Ti(){if(Ka)return lr;Ka=1,Object.defineProperty(lr,"__esModule",{value:!0});const e=Fs(),t={keyword:"$recursiveRef",schemaType:"string",code:r=>(0,e.dynamicRef)(r,r.schema)};return lr.default=t,lr}var xa;function Mi(){if(xa)return cr;xa=1,Object.defineProperty(cr,"__esModule",{value:!0});const e=Ls(),t=Fs(),r=Ni(),n=Ti(),c=[e.default,t.default,r.default,n.default];return cr.default=c,cr}var dr={},fr={},Ga;function qi(){if(Ga)return fr;Ga=1,Object.defineProperty(fr,"__esModule",{value:!0});const e=Sn(),t={keyword:"dependentRequired",type:"object",schemaType:"object",error:e.error,code:r=>(0,e.validatePropertyDeps)(r)};return fr.default=t,fr}var mr={},Ba;function Ai(){if(Ba)return mr;Ba=1,Object.defineProperty(mr,"__esModule",{value:!0});const e=Sn(),t={keyword:"dependentSchemas",type:"object",schemaType:"object",code:r=>(0,e.validateSchemaDeps)(r)};return mr.default=t,mr}var hr={},Wa;function Ci(){if(Wa)return hr;Wa=1,Object.defineProperty(hr,"__esModule",{value:!0});const e=ne(),t={keyword:["maxContains","minContains"],type:"array",schemaType:"number",code({keyword:r,parentSchema:n,it:c}){n.contains===void 0&&(0,e.checkStrictMode)(c,`"${r}" without "contains" is ignored`)}};return hr.default=t,hr}var Ja;function Di(){if(Ja)return dr;Ja=1,Object.defineProperty(dr,"__esModule",{value:!0});const e=qi(),t=Ai(),r=Ci(),n=[e.default,t.default,r.default];return dr.default=n,dr}var pr={},vr={},Ya;function zi(){if(Ya)return vr;Ya=1,Object.defineProperty(vr,"__esModule",{value:!0});const e=Q(),t=ne(),r=Ue(),c={keyword:"unevaluatedProperties",type:"object",schemaType:["boolean","object"],trackErrors:!0,error:{message:"must NOT have unevaluated properties",params:({params:a})=>(0,e._)`{unevaluatedProperty: ${a.unevaluatedProperty}}`},code(a){const{gen:o,schema:s,data:l,errsCount:v,it:f}=a;if(!v)throw new Error("ajv implementation error");const{allErrors:w,props:g}=f;g instanceof e.Name?o.if((0,e._)`${g} !== true`,()=>o.forIn("key",l,i=>o.if(y(g,i),()=>p(i)))):g!==!0&&o.forIn("key",l,i=>g===void 0?p(i):o.if(_(g,i),()=>p(i))),f.props=!0,a.ok((0,e._)`${v} === ${r.default.errors}`);function p(i){if(s===!1){a.setParams({unevaluatedProperty:i}),a.error(),w||o.break();return}if(!(0,t.alwaysValidSchema)(f,s)){const d=o.name("valid");a.subschema({keyword:"unevaluatedProperties",dataProp:i,dataPropType:t.Type.Str},d),w||o.if((0,e.not)(d),()=>o.break())}}function y(i,d){return(0,e._)`!${i} || !${i}[${d}]`}function _(i,d){const u=[];for(const m in i)i[m]===!0&&u.push((0,e._)`${d} !== ${m}`);return(0,e.and)(...u)}}};return vr.default=c,vr}var gr={},Xa;function Ui(){if(Xa)return gr;Xa=1,Object.defineProperty(gr,"__esModule",{value:!0});const e=Q(),t=ne(),n={keyword:"unevaluatedItems",type:"array",schemaType:["boolean","object"],error:{message:({params:{len:c}})=>(0,e.str)`must NOT have more than ${c} items`,params:({params:{len:c}})=>(0,e._)`{limit: ${c}}`},code(c){const{gen:a,schema:o,data:s,it:l}=c,v=l.items||0;if(v===!0)return;const f=a.const("len",(0,e._)`${s}.length`);if(o===!1)c.setParams({len:v}),c.fail((0,e._)`${f} > ${v}`);else if(typeof o=="object"&&!(0,t.alwaysValidSchema)(l,o)){const g=a.var("valid",(0,e._)`${f} <= ${v}`);a.if((0,e.not)(g),()=>w(g,v)),c.ok(g)}l.items=!0;function w(g,p){a.forRange("i",p,f,y=>{c.subschema({keyword:"unevaluatedItems",dataProp:y,dataPropType:t.Type.Num},g),l.allErrors||a.if((0,e.not)(g),()=>a.break())})}}};return gr.default=n,gr}var Za;function Vi(){if(Za)return pr;Za=1,Object.defineProperty(pr,"__esModule",{value:!0});const e=zi(),t=Ui(),r=[e.default,t.default];return pr.default=r,pr}var yr={},_r={},Qa;function Li(){if(Qa)return _r;Qa=1,Object.defineProperty(_r,"__esModule",{value:!0});const e=Q(),r={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:n})=>(0,e.str)`must match format "${n}"`,params:({schemaCode:n})=>(0,e._)`{format: ${n}}`},code(n,c){const{gen:a,data:o,$data:s,schema:l,schemaCode:v,it:f}=n,{opts:w,errSchemaPath:g,schemaEnv:p,self:y}=f;if(!w.validateFormats)return;s?_():i();function _(){const d=a.scopeValue("formats",{ref:y.formats,code:w.code.formats}),u=a.const("fDef",(0,e._)`${d}[${v}]`),m=a.let("fType"),b=a.let("format");a.if((0,e._)`typeof ${u} == "object" && !(${u} instanceof RegExp)`,()=>a.assign(m,(0,e._)`${u}.type || "string"`).assign(b,(0,e._)`${u}.validate`),()=>a.assign(m,(0,e._)`"string"`).assign(b,u)),n.fail$data((0,e.or)(h(),$()));function h(){return w.strictSchema===!1?e.nil:(0,e._)`${v} && !${b}`}function $(){const E=p.$async?(0,e._)`(${u}.async ? await ${b}(${o}) : ${b}(${o}))`:(0,e._)`${b}(${o})`,R=(0,e._)`(typeof ${b} == "function" ? ${E} : ${b}.test(${o}))`;return(0,e._)`${b} && ${b} !== true && ${m} === ${c} && !${R}`}}function i(){const d=y.formats[l];if(!d){h();return}if(d===!0)return;const[u,m,b]=$(d);u===c&&n.pass(E());function h(){if(w.strictSchema===!1){y.logger.warn(R());return}throw new Error(R());function R(){return`unknown format "${l}" ignored in schema at path "${g}"`}}function $(R){const A=R instanceof RegExp?(0,e.regexpCode)(R):w.code.formats?(0,e._)`${w.code.formats}${(0,e.getProperty)(l)}`:void 0,M=a.scopeValue("formats",{key:l,ref:R,code:A});return typeof R=="object"&&!(R instanceof RegExp)?[R.type||"string",R.validate,(0,e._)`${M}.validate`]:["string",R,M]}function E(){if(typeof d=="object"&&!(d instanceof RegExp)&&d.async){if(!p.$async)throw new Error("async format in sync schema");return(0,e._)`await ${b}(${o})`}return typeof m=="function"?(0,e._)`${b}(${o})`:(0,e._)`${b}.test(${o})`}}}};return _r.default=r,_r}var es;function Hs(){if(es)return yr;es=1,Object.defineProperty(yr,"__esModule",{value:!0});const t=[Li().default];return yr.default=t,yr}var nt={},ts;function Ks(){return ts||(ts=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.contentVocabulary=nt.metadataVocabulary=void 0,nt.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],nt.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]),nt}var rs;function Fi(){if(rs)return Tt;rs=1,Object.defineProperty(Tt,"__esModule",{value:!0});const e=As(),t=Cs(),r=Vs(),n=Mi(),c=Di(),a=Vi(),o=Hs(),s=Ks(),l=[n.default,e.default,t.default,(0,r.default)(!0),o.default,s.metadataVocabulary,s.contentVocabulary,c.default,a.default];return Tt.default=l,Tt}var $r={},gt={},ns;function Hi(){if(ns)return gt;ns=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.DiscrError=void 0;var e;return(function(t){t.Tag="tag",t.Mapping="mapping"})(e||(gt.DiscrError=e={})),gt}var as;function xs(){if(as)return $r;as=1,Object.defineProperty($r,"__esModule",{value:!0});const e=Q(),t=Hi(),r=Cr(),n=St(),c=ne(),o={keyword:"discriminator",type:"object",schemaType:"object",error:{message:({params:{discrError:s,tagName:l}})=>s===t.DiscrError.Tag?`tag "${l}" must be string`:`value of tag "${l}" must be in oneOf`,params:({params:{discrError:s,tag:l,tagName:v}})=>(0,e._)`{error: ${s}, tag: ${v}, tagValue: ${l}}`},code(s){const{gen:l,data:v,schema:f,parentSchema:w,it:g}=s,{oneOf:p}=w;if(!g.opts.discriminator)throw new Error("discriminator: requires discriminator option");const y=f.propertyName;if(typeof y!="string")throw new Error("discriminator: requires propertyName");if(f.mapping)throw new Error("discriminator: mapping is not supported");if(!p)throw new Error("discriminator: requires oneOf keyword");const _=l.let("valid",!1),i=l.const("tag",(0,e._)`${v}${(0,e.getProperty)(y)}`);l.if((0,e._)`typeof ${i} == "string"`,()=>d(),()=>s.error(!1,{discrError:t.DiscrError.Tag,tag:i,tagName:y})),s.ok(_);function d(){const b=m();l.if(!1);for(const h in b)l.elseIf((0,e._)`${i} === ${h}`),l.assign(_,u(b[h]));l.else(),s.error(!1,{discrError:t.DiscrError.Mapping,tag:i,tagName:y}),l.endIf()}function u(b){const h=l.name("valid"),$=s.subschema({keyword:"oneOf",schemaProp:b},h);return s.mergeEvaluated($,e.Name),h}function m(){var b;const h={},$=R(w);let E=!0;for(let N=0;N<p.length;N++){let z=p[N];if(z?.$ref&&!(0,c.schemaHasRulesButRef)(z,g.self.RULES)){const U=z.$ref;if(z=r.resolveRef.call(g.self,g.schemaEnv.root,g.baseId,U),z instanceof r.SchemaEnv&&(z=z.schema),z===void 0)throw new n.default(g.opts.uriResolver,g.baseId,U)}const L=(b=z?.properties)===null||b===void 0?void 0:b[y];if(typeof L!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${y}"`);E=E&&($||R(z)),A(L,N)}if(!E)throw new Error(`discriminator: "${y}" must be required`);return h;function R({required:N}){return Array.isArray(N)&&N.includes(y)}function A(N,z){if(N.const)M(N.const,z);else if(N.enum)for(const L of N.enum)M(L,z);else throw new Error(`discriminator: "properties/${y}" must have "const" or "enum"`)}function M(N,z){if(typeof N!="string"||N in h)throw new Error(`discriminator: "${y}" values must be unique strings`);h[N]=z}}}};return $r.default=o,$r}var br={};const Ki="https://json-schema.org/draft/2020-12/schema",xi="https://json-schema.org/draft/2020-12/schema",Gi={"https://json-schema.org/draft/2020-12/vocab/core":!0,"https://json-schema.org/draft/2020-12/vocab/applicator":!0,"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0,"https://json-schema.org/draft/2020-12/vocab/validation":!0,"https://json-schema.org/draft/2020-12/vocab/meta-data":!0,"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0,"https://json-schema.org/draft/2020-12/vocab/content":!0},Bi="meta",Wi="Core and Validation specifications meta-schema",Ji=[{$ref:"meta/core"},{$ref:"meta/applicator"},{$ref:"meta/unevaluated"},{$ref:"meta/validation"},{$ref:"meta/meta-data"},{$ref:"meta/format-annotation"},{$ref:"meta/content"}],Yi=["object","boolean"],Xi="This meta-schema also defines keywords that have appeared in previous drafts in order to prevent incompatible extensions as they remain in common use.",Zi={definitions:{$comment:'"definitions" has been replaced by "$defs".',type:"object",additionalProperties:{$dynamicRef:"#meta"},deprecated:!0,default:{}},dependencies:{$comment:'"dependencies" has been split and replaced by "dependentSchemas" and "dependentRequired" in order to serve their differing semantics.',type:"object",additionalProperties:{anyOf:[{$dynamicRef:"#meta"},{$ref:"meta/validation#/$defs/stringArray"}]},deprecated:!0,default:{}},$recursiveAnchor:{$comment:'"$recursiveAnchor" has been replaced by "$dynamicAnchor".',$ref:"meta/core#/$defs/anchorString",deprecated:!0},$recursiveRef:{$comment:'"$recursiveRef" has been replaced by "$dynamicRef".',$ref:"meta/core#/$defs/uriReferenceString",deprecated:!0}},Qi={$schema:Ki,$id:xi,$vocabulary:Gi,$dynamicAnchor:Bi,title:Wi,allOf:Ji,type:Yi,$comment:Xi,properties:Zi},ec="https://json-schema.org/draft/2020-12/schema",tc="https://json-schema.org/draft/2020-12/meta/applicator",rc={"https://json-schema.org/draft/2020-12/vocab/applicator":!0},nc="meta",ac="Applicator vocabulary meta-schema",sc=["object","boolean"],oc={prefixItems:{$ref:"#/$defs/schemaArray"},items:{$dynamicRef:"#meta"},contains:{$dynamicRef:"#meta"},additionalProperties:{$dynamicRef:"#meta"},properties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},patternProperties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},propertyNames:{format:"regex"},default:{}},dependentSchemas:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},propertyNames:{$dynamicRef:"#meta"},if:{$dynamicRef:"#meta"},then:{$dynamicRef:"#meta"},else:{$dynamicRef:"#meta"},allOf:{$ref:"#/$defs/schemaArray"},anyOf:{$ref:"#/$defs/schemaArray"},oneOf:{$ref:"#/$defs/schemaArray"},not:{$dynamicRef:"#meta"}},ic={schemaArray:{type:"array",minItems:1,items:{$dynamicRef:"#meta"}}},cc={$schema:ec,$id:tc,$vocabulary:rc,$dynamicAnchor:nc,title:ac,type:sc,properties:oc,$defs:ic},uc="https://json-schema.org/draft/2020-12/schema",lc="https://json-schema.org/draft/2020-12/meta/unevaluated",dc={"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0},fc="meta",mc="Unevaluated applicator vocabulary meta-schema",hc=["object","boolean"],pc={unevaluatedItems:{$dynamicRef:"#meta"},unevaluatedProperties:{$dynamicRef:"#meta"}},vc={$schema:uc,$id:lc,$vocabulary:dc,$dynamicAnchor:fc,title:mc,type:hc,properties:pc},gc="https://json-schema.org/draft/2020-12/schema",yc="https://json-schema.org/draft/2020-12/meta/content",_c={"https://json-schema.org/draft/2020-12/vocab/content":!0},$c="meta",bc="Content vocabulary meta-schema",wc=["object","boolean"],Sc={contentEncoding:{type:"string"},contentMediaType:{type:"string"},contentSchema:{$dynamicRef:"#meta"}},Ec={$schema:gc,$id:yc,$vocabulary:_c,$dynamicAnchor:$c,title:bc,type:wc,properties:Sc},Pc="https://json-schema.org/draft/2020-12/schema",Ic="https://json-schema.org/draft/2020-12/meta/core",kc={"https://json-schema.org/draft/2020-12/vocab/core":!0},Rc="meta",jc="Core vocabulary meta-schema",Oc=["object","boolean"],Nc={$id:{$ref:"#/$defs/uriReferenceString",$comment:"Non-empty fragments not allowed.",pattern:"^[^#]*#?$"},$schema:{$ref:"#/$defs/uriString"},$ref:{$ref:"#/$defs/uriReferenceString"},$anchor:{$ref:"#/$defs/anchorString"},$dynamicRef:{$ref:"#/$defs/uriReferenceString"},$dynamicAnchor:{$ref:"#/$defs/anchorString"},$vocabulary:{type:"object",propertyNames:{$ref:"#/$defs/uriString"},additionalProperties:{type:"boolean"}},$comment:{type:"string"},$defs:{type:"object",additionalProperties:{$dynamicRef:"#meta"}}},Tc={anchorString:{type:"string",pattern:"^[A-Za-z_][-A-Za-z0-9._]*$"},uriString:{type:"string",format:"uri"},uriReferenceString:{type:"string",format:"uri-reference"}},Mc={$schema:Pc,$id:Ic,$vocabulary:kc,$dynamicAnchor:Rc,title:jc,type:Oc,properties:Nc,$defs:Tc},qc="https://json-schema.org/draft/2020-12/schema",Ac="https://json-schema.org/draft/2020-12/meta/format-annotation",Cc={"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0},Dc="meta",zc="Format vocabulary meta-schema for annotation results",Uc=["object","boolean"],Vc={format:{type:"string"}},Lc={$schema:qc,$id:Ac,$vocabulary:Cc,$dynamicAnchor:Dc,title:zc,type:Uc,properties:Vc},Fc="https://json-schema.org/draft/2020-12/schema",Hc="https://json-schema.org/draft/2020-12/meta/meta-data",Kc={"https://json-schema.org/draft/2020-12/vocab/meta-data":!0},xc="meta",Gc="Meta-data vocabulary meta-schema",Bc=["object","boolean"],Wc={title:{type:"string"},description:{type:"string"},default:!0,deprecated:{type:"boolean",default:!1},readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0}},Jc={$schema:Fc,$id:Hc,$vocabulary:Kc,$dynamicAnchor:xc,title:Gc,type:Bc,properties:Wc},Yc="https://json-schema.org/draft/2020-12/schema",Xc="https://json-schema.org/draft/2020-12/meta/validation",Zc={"https://json-schema.org/draft/2020-12/vocab/validation":!0},Qc="meta",eu="Validation vocabulary meta-schema",tu=["object","boolean"],ru={type:{anyOf:[{$ref:"#/$defs/simpleTypes"},{type:"array",items:{$ref:"#/$defs/simpleTypes"},minItems:1,uniqueItems:!0}]},const:!0,enum:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/$defs/nonNegativeInteger"},minLength:{$ref:"#/$defs/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},maxItems:{$ref:"#/$defs/nonNegativeInteger"},minItems:{$ref:"#/$defs/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxContains:{$ref:"#/$defs/nonNegativeInteger"},minContains:{$ref:"#/$defs/nonNegativeInteger",default:1},maxProperties:{$ref:"#/$defs/nonNegativeInteger"},minProperties:{$ref:"#/$defs/nonNegativeIntegerDefault0"},required:{$ref:"#/$defs/stringArray"},dependentRequired:{type:"object",additionalProperties:{$ref:"#/$defs/stringArray"}}},nu={nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{$ref:"#/$defs/nonNegativeInteger",default:0},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},au={$schema:Yc,$id:Xc,$vocabulary:Zc,$dynamicAnchor:Qc,title:eu,type:tu,properties:ru,$defs:nu};var ss;function su(){if(ss)return br;ss=1,Object.defineProperty(br,"__esModule",{value:!0});const e=Qi,t=cc,r=vc,n=Ec,c=Mc,a=Lc,o=Jc,s=au,l=["/properties"];function v(f){return[e,t,r,n,c,w(this,a),o,w(this,s)].forEach(g=>this.addMetaSchema(g,void 0,!1)),this;function w(g,p){return f?g.$dataMetaSchema(p,l):p}}return br.default=v,br}var os;function ou(){return os||(os=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv2020=void 0;const r=qs(),n=Fi(),c=xs(),a=su(),o="https://json-schema.org/draft/2020-12/schema";class s extends r.default{constructor(p={}){super({...p,dynamicRef:!0,next:!0,unevaluated:!0})}_addVocabularies(){super._addVocabularies(),n.default.forEach(p=>this.addVocabulary(p)),this.opts.discriminator&&this.addKeyword(c.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema();const{$data:p,meta:y}=this.opts;y&&(a.default.call(this,p),this.refs["http://json-schema.org/schema"]=o)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(o)?o:void 0)}}t.Ajv2020=s,e.exports=t=s,e.exports.Ajv2020=s,Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var l=wt();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var v=Q();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return v._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return v.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return v.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return v.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return v.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return v.CodeGen}});var f=Ar();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return f.default}});var w=St();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return w.default}})})(kt,kt.exports)),kt.exports}var iu=ou();const cu=js(iu);var wr={exports:{}},sn={},is;function uu(){return is||(is=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatNames=e.fastFormats=e.fullFormats=void 0;function t(N,z){return{validate:N,compare:z}}e.fullFormats={date:t(a,o),time:t(l(!0),v),"date-time":t(g(!0),p),"iso-time":t(l(),f),"iso-date-time":t(g(),y),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:d,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:M,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:m,int32:{type:"number",validate:$},int64:{type:"number",validate:E},float:{type:"number",validate:R},double:{type:"number",validate:R},password:!0,binary:!0},e.fastFormats={...e.fullFormats,date:t(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,o),time:t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,v),"date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,p),"iso-time":t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,f),"iso-date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,y),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},e.formatNames=Object.keys(e.fullFormats);function r(N){return N%4===0&&(N%100!==0||N%400===0)}const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,c=[0,31,28,31,30,31,30,31,31,30,31,30,31];function a(N){const z=n.exec(N);if(!z)return!1;const L=+z[1],U=+z[2],Z=+z[3];return U>=1&&U<=12&&Z>=1&&Z<=(U===2&&r(L)?29:c[U])}function o(N,z){if(N&&z)return N>z?1:N<z?-1:0}const s=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function l(N){return function(L){const U=s.exec(L);if(!U)return!1;const Z=+U[1],me=+U[2],$e=+U[3],oe=U[4],Ce=U[5]==="-"?-1:1,V=+(U[6]||0),k=+(U[7]||0);if(V>23||k>59||N&&!oe)return!1;if(Z<=23&&me<=59&&$e<60)return!0;const D=me-k*Ce,O=Z-V*Ce-(D<0?1:0);return(O===23||O===-1)&&(D===59||D===-1)&&$e<61}}function v(N,z){if(!(N&&z))return;const L=new Date("2020-01-01T"+N).valueOf(),U=new Date("2020-01-01T"+z).valueOf();if(L&&U)return L-U}function f(N,z){if(!(N&&z))return;const L=s.exec(N),U=s.exec(z);if(L&&U)return N=L[1]+L[2]+L[3],z=U[1]+U[2]+U[3],N>z?1:N<z?-1:0}const w=/t|\s/i;function g(N){const z=l(N);return function(U){const Z=U.split(w);return Z.length===2&&a(Z[0])&&z(Z[1])}}function p(N,z){if(!(N&&z))return;const L=new Date(N).valueOf(),U=new Date(z).valueOf();if(L&&U)return L-U}function y(N,z){if(!(N&&z))return;const[L,U]=N.split(w),[Z,me]=z.split(w),$e=o(L,Z);if($e!==void 0)return $e||v(U,me)}const _=/\/|:/,i=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function d(N){return _.test(N)&&i.test(N)}const u=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function m(N){return u.lastIndex=0,u.test(N)}const b=-2147483648,h=2**31-1;function $(N){return Number.isInteger(N)&&N<=h&&N>=b}function E(N){return Number.isInteger(N)}function R(){return!0}const A=/[^\\]\\Z/;function M(N){if(A.test(N))return!1;try{return new RegExp(N),!0}catch{return!1}}})(sn)),sn}var on={},Sr={exports:{}},Er={},cs;function lu(){if(cs)return Er;cs=1,Object.defineProperty(Er,"__esModule",{value:!0});const e=As(),t=Cs(),r=Vs(),n=Hs(),c=Ks(),a=[e.default,t.default,(0,r.default)(),n.default,c.metadataVocabulary,c.contentVocabulary];return Er.default=a,Er}const du="http://json-schema.org/draft-07/schema#",fu="http://json-schema.org/draft-07/schema#",mu="Core schema meta-schema",hu={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},pu=["object","boolean"],vu={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},gu={$schema:du,$id:fu,title:mu,definitions:hu,type:pu,properties:vu,default:!0};var us;function yu(){return us||(us=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=t.Ajv=void 0;const r=qs(),n=lu(),c=xs(),a=gu,o=["/properties"],s="http://json-schema.org/draft-07/schema";class l extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach(y=>this.addVocabulary(y)),this.opts.discriminator&&this.addKeyword(c.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const y=this.opts.$data?this.$dataMetaSchema(a,o):a;this.addMetaSchema(y,s,!1),this.refs["http://json-schema.org/schema"]=s}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(s)?s:void 0)}}t.Ajv=l,e.exports=t=l,e.exports.Ajv=l,Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var v=wt();Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return v.KeywordCxt}});var f=Q();Object.defineProperty(t,"_",{enumerable:!0,get:function(){return f._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return f.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return f.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return f.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return f.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return f.CodeGen}});var w=Ar();Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return w.default}});var g=St();Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return g.default}})})(Sr,Sr.exports)),Sr.exports}var ls;function _u(){return ls||(ls=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLimitDefinition=void 0;const t=yu(),r=Q(),n=r.operators,c={formatMaximum:{okStr:"<=",ok:n.LTE,fail:n.GT},formatMinimum:{okStr:">=",ok:n.GTE,fail:n.LT},formatExclusiveMaximum:{okStr:"<",ok:n.LT,fail:n.GTE},formatExclusiveMinimum:{okStr:">",ok:n.GT,fail:n.LTE}},a={message:({keyword:s,schemaCode:l})=>(0,r.str)`should be ${c[s].okStr} ${l}`,params:({keyword:s,schemaCode:l})=>(0,r._)`{comparison: ${c[s].okStr}, limit: ${l}}`};e.formatLimitDefinition={keyword:Object.keys(c),type:"string",schemaType:"string",$data:!0,error:a,code(s){const{gen:l,data:v,schemaCode:f,keyword:w,it:g}=s,{opts:p,self:y}=g;if(!p.validateFormats)return;const _=new t.KeywordCxt(g,y.RULES.all.format.definition,"format");_.$data?i():d();function i(){const m=l.scopeValue("formats",{ref:y.formats,code:p.code.formats}),b=l.const("fmt",(0,r._)`${m}[${_.schemaCode}]`);s.fail$data((0,r.or)((0,r._)`typeof ${b} != "object"`,(0,r._)`${b} instanceof RegExp`,(0,r._)`typeof ${b}.compare != "function"`,u(b)))}function d(){const m=_.schema,b=y.formats[m];if(!b||b===!0)return;if(typeof b!="object"||b instanceof RegExp||typeof b.compare!="function")throw new Error(`"${w}": format "${m}" does not define "compare" function`);const h=l.scopeValue("formats",{key:m,ref:b,code:p.code.formats?(0,r._)`${p.code.formats}${(0,r.getProperty)(m)}`:void 0});s.fail$data(u(h))}function u(m){return(0,r._)`${m}.compare(${v}, ${f}) ${c[w].fail} 0`}},dependencies:["format"]};const o=s=>(s.addKeyword(e.formatLimitDefinition),s);e.default=o})(on)),on}var ds;function $u(){return ds||(ds=1,(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=uu(),n=_u(),c=Q(),a=new c.Name("fullFormats"),o=new c.Name("fastFormats"),s=(v,f={keywords:!0})=>{if(Array.isArray(f))return l(v,f,r.fullFormats,a),v;const[w,g]=f.mode==="fast"?[r.fastFormats,o]:[r.fullFormats,a],p=f.formats||r.formatNames;return l(v,p,w,g),f.keywords&&(0,n.default)(v),v};s.get=(v,f="full")=>{const g=(f==="fast"?r.fastFormats:r.fullFormats)[v];if(!g)throw new Error(`Unknown format "${v}"`);return g};function l(v,f,w,g){var p,y;(p=(y=v.opts.code).formats)!==null&&p!==void 0||(y.formats=(0,c._)`require("ajv-formats/dist/formats").${g}`);for(const _ of f)v.addFormat(_,w[_])}e.exports=t=s,Object.defineProperty(t,"__esModule",{value:!0}),t.default=s})(wr,wr.exports)),wr.exports}var bu=$u();const wu=js(bu),Su="https://json-schema.org/draft/2020-12/schema",Eu="https://example.org/image-alignment-project.schema.json",Pu="Image Alignment Project",Iu="object",ku=["version","createdAt","images","groups","alignments"],Ru=!1,ju={version:{type:"string",pattern:"^0\\.\\d+$"},createdAt:{type:"string",format:"date-time"},images:{type:"array",items:{$ref:"#/$defs/imageSource"},minItems:1},groups:{type:"array",items:{$ref:"#/$defs/imageGroup"}},alignments:{type:"array",items:{$ref:"#/$defs/imageAlignment"}},notes:{type:"string"},annotations:{type:"array",items:{type:"object",required:["baseImageContentHash","data"],additionalProperties:!1,properties:{baseImageContentHash:{type:"string",minLength:32},comparedImageContentHash:{type:"string",minLength:32},alignmentId:{type:"string"},data:{type:"object",additionalProperties:!0}}}},ui:{$ref:"#/$defs/projectUIState"}},Ou={imageSource:{type:"object",required:["id","sourceType","source","hashes","dimensions","workflow"],additionalProperties:!1,properties:{id:{type:"string"},sourceType:{type:"string",enum:["local","url","iiif"]},source:{type:"object",additionalProperties:!1,properties:{uri:{type:"string",description:"Canonical source URI (remote URL or IIIF endpoint)"},iiifService:{type:"string",description:"IIIF base service URL (if sourceType is iiif)"}}},label:{type:"string"},structuralPath:{type:"string"},hashes:{type:"object",required:["contentHash"],additionalProperties:!1,properties:{contentHash:{type:"string",minLength:32},perceptualHash:{type:"string"}}},dimensions:{type:"object",required:["width","height"],additionalProperties:!1,properties:{width:{type:"number"},height:{type:"number"}}},metadata:{type:"object",additionalProperties:!0},preparation:{$ref:"#/$defs/imagePreparation"},workflow:{$ref:"#/$defs/imageWorkflow"}},allOf:[{if:{properties:{sourceType:{const:"local"}}},then:{properties:{source:{not:{required:["uri"]}}}}},{if:{properties:{sourceType:{const:"url"}}},then:{properties:{source:{required:["uri"]}}}},{if:{properties:{sourceType:{const:"iiif"}}},then:{properties:{source:{required:["iiifService"]}}}}]},imageGroup:{type:"object",required:["id","baseImageId","imageIds","locked"],additionalProperties:!1,properties:{id:{type:"string"},baseImageId:{type:"string"},imageIds:{type:"array",items:{type:"string"},minItems:1},locked:{type:"boolean"}}},imageAlignment:{type:"object",required:["sourceImageId","targetImageId","sourceContentHash","targetContentHash","transform","confidence","method"],additionalProperties:!1,properties:{sourceImageId:{type:"string"},targetImageId:{type:"string"},sourceContentHash:{type:"string"},targetContentHash:{type:"string"},confidence:{type:"number",minimum:0,maximum:1},method:{type:"string"},transform:{type:"object",required:["type","matrix"],additionalProperties:!1,properties:{type:{type:"string",enum:["affine","homography"]},matrix:{type:"array",items:{type:"number"},minItems:9,maxItems:9}}}}},imagePreparation:{type:"object",required:["rect","rotation"],additionalProperties:!1,properties:{rect:{type:"object",required:["x","y","width","height"],additionalProperties:!1,properties:{x:{type:"number",minimum:0,maximum:1},y:{type:"number",minimum:0,maximum:1},width:{type:"number",minimum:0,maximum:1},height:{type:"number",minimum:0,maximum:1}}},rotation:{type:"number",minimum:-45,maximum:45}}},imageWorkflow:{type:"object",required:["stage"],additionalProperties:!1,properties:{stage:{type:"string",enum:["ingested","prepared","grouped","aligned","annotated"]},updatedAt:{type:"string",format:"date-time"}}},projectUIState:{type:"object",additionalProperties:!1,properties:{lastSelectedImageId:{type:"string"},lastSelectedGroupId:{type:"string"},lastMode:{type:"string",enum:["prepare","group","align","annotate"]},sidebarOpen:{type:"boolean"}}}},Nu={$schema:Su,$id:Eu,title:Pu,type:Iu,required:ku,additionalProperties:Ru,properties:ju,$defs:Ou},Gs=new cu({allErrors:!0,strict:!1});wu(Gs);const fs=Gs.compile(Nu);function Tu(e){return fs(e)?{valid:!0}:{valid:!1,errors:fs.errors?.map(r=>`${r.instancePath||"/"} ${r.message}`)}}function Dr(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function Mu(e,t){let r;const n=()=>{if(r)return r;const c=indexedDB.open(e);return c.onupgradeneeded=()=>c.result.createObjectStore(t),r=Dr(c),r.then(a=>{a.onclose=()=>r=void 0},()=>{}),r};return(c,a)=>n().then(o=>a(o.transaction(t,c).objectStore(t)))}let cn;function En(){return cn||(cn=Mu("keyval-store","keyval")),cn}function Fe(e,t=En()){return t("readonly",r=>Dr(r.get(e)))}function zr(e,t,r=En()){return r("readwrite",n=>(n.put(t,e),Dr(n.transaction)))}function ms(e,t=En()){return t("readwrite",r=>(r.delete(e),Dr(r.transaction)))}const at="v1_2048",Bs="v3_from_working",qu="v2_from_working",Au=2048;async function Cu(e,t){const r=`work::${e}::${at}`;if(await Fe(r))return;const c=await createImageBitmap(t),a=await Du(c);await zr(r,a)}async function Du(e){const t=Au/Math.max(e.width,e.height),r=t<1?Math.round(e.width*t):e.width,n=t<1?Math.round(e.height*t):e.height,c=document.createElement("canvas");return c.width=r,c.height=n,c.getContext("2d").drawImage(e,0,0,r,n),new Promise(o=>c.toBlob(s=>o(s),"image/jpeg",.9))}async function Pn(e,t){const r=`work::${e}::${at}`,n=`prep::${e}::${at}`,c=await Fe(r);if(!c)throw new Error("Working image missing");const a=await createImageBitmap(c),o=Vu(a,t),s=await new Promise(l=>o.toBlob(v=>l(v),"image/jpeg",.9));await zr(n,s)}async function Ws(e){await ms(`prep::${e}::${at}`),await ms(`norm::${e}::${Bs}`)}async function Js(e,t){const r=`prep::${e}::${at}`,n=`norm::${e}::${Bs}`;let c=await Fe(r);if(c||(await Pn(e,t),c=await Fe(r)),!c)throw new Error("Prepared image missing");const a=await createImageBitmap(c),o=await zu(a);await zr(n,o)}async function zu(e){const r=document.createElement("canvas");r.width=512,r.height=512;const n=r.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,512,512);const c=512/Math.max(e.width,e.height),a=Math.round(e.width*c),o=Math.round(e.height*c),s=Math.round((512-a)/2),l=Math.round((512-o)/2);n.drawImage(e,s,l,a,o);const v=n.getImageData(s,l,a,o),f=v.data;for(let w=0;w<f.length;w+=4){const g=Math.round(.299*f[w]+.587*f[w+1]+.114*f[w+2]);f[w]=f[w+1]=f[w+2]=g}return n.putImageData(v,s,l),new Promise(w=>r.toBlob(g=>w(g),"image/png"))}async function Ys(e){const t=`work::${e}::${at}`,r=`thumb::${e}::${qu}`;if(await Fe(r))return;const c=await Fe(t);if(!c)throw new Error("Working image missing");const a=await createImageBitmap(c),o=await Uu(a);await zr(r,o)}async function Uu(e){const r=document.createElement("canvas");r.width=256,r.height=256;const n=r.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,256,256);const c=256/Math.max(e.width,e.height),a=Math.round(e.width*c),o=Math.round(e.height*c),s=Math.round((256-a)/2),l=Math.round((256-o)/2);return n.drawImage(e,s,l,a,o),new Promise(v=>r.toBlob(f=>v(f),"image/jpeg",.8))}function Vu(e,t){const{rotation:r,rect:n}=t,c=r*Math.PI/180,a=Math.abs(Math.sin(c)),o=Math.abs(Math.cos(c)),s=document.createElement("canvas");s.width=e.width*o+e.height*a,s.height=e.width*a+e.height*o;const l=s.getContext("2d");l.translate(s.width/2,s.height/2),l.rotate(c),l.drawImage(e,-e.width/2,-e.height/2);const v=n.x*s.width,f=n.y*s.height,w=n.width*s.width,g=n.height*s.height,p=document.createElement("canvas");return p.width=w,p.height=g,p.getContext("2d").drawImage(s,v,f,w,g,0,0,w,g),p}const Lu="v3_from_working";async function Fu(e){const t=`norm::${e}::${Lu}`,r=await Fe(t);if(!r)return null;const n=await createImageBitmap(r),c=32,a=document.createElement("canvas");a.width=c,a.height=c;const o=a.getContext("2d");o.drawImage(n,0,0,c,c);const l=o.getImageData(0,0,c,c).data;let v=0;const f=[];for(let y=0;y<l.length;y+=4){const _=l[y];f.push(_),v+=_}const w=v/f.length;let g="";for(const y of f)g+=y>w?"1":"0";let p="";for(let y=0;y<g.length;y+=4)p+=parseInt(g.substr(y,4),2).toString(16);return p}async function Hu(e){return Promise.all(e.map(async t=>{if(t.runtimeUri)return t;const r=t.hashes?.contentHash;if(!r)return t;const n=`work::${r}::${at}`,c=await Fe(n);return c?{...t,runtimeUri:URL.createObjectURL(c)}:(console.warn("Missing working image for hash:",r),t)}))}const In=Ye({version:"0.2",createdAt:new Date().toISOString()}),fe=Ye([]),Ie=Ye([]),Et=Ye([]),Pt=Ye([]),Ur=Ye(void 0);He(fe,e=>Object.fromEntries(e.map(t=>[t.id,t])));He(Ie,e=>Object.fromEntries(e.map(t=>[t.id,t])));He(Et,e=>{const t=new Map;for(const r of e)t.has(r.sourceImageId)||t.set(r.sourceImageId,[]),t.get(r.sourceImageId).push(r);return t});He([Pt,fe],([e,t])=>{if(e.length===0)return"none";const r=new Set(t.map(c=>c.hashes.contentHash));return e.some(c=>!r.has(c.baseImageContentHash))?"mismatch":"valid"});He([fe,Ie],([e,t])=>{const r=new Set;for(const n of t)for(const c of n.imageIds)r.add(c);return e.filter(n=>!r.has(n.id)).map(n=>n.id)});He(fe,e=>new Set(e.filter(t=>t.runtimeUri&&t.runtimeUri.length>0).map(t=>t.hashes.contentHash)));const Or=He([In,fe,Ie,Et,Pt,Ur],([e,t,r,n,c,a])=>{if(t.length===0)return null;const o=t.map(({runtimeUri:s,...l})=>l);return{version:e.version,createdAt:e.createdAt,images:o,groups:r,alignments:n,notes:e.notes,annotations:c.length?c:void 0,ui:a&&Object.keys(a).length>0?a:void 0}});function Ku(){In.set({version:"0.2",createdAt:new Date().toISOString()}),fe.set([]),Ie.set([]),Et.set([]),Pt.set([]),Ur.set(void 0)}function xu(e){In.set(e)}function hs(e){fe.set(e)}function Gu(e){Ie.set(e)}function Bu(e){Et.set(e)}function Wu(e){Pt.set(e)}function Ju(e){Ur.set(e)}function Xs(e){Ur.update(t=>({...t,...e}))}function Yu(e){fe.update(t=>[...t,e])}function Xu(e,t){fe.update(r=>{const n=r.findIndex(a=>a.id===e);if(n===-1)return r;const c=[...r];return c[n]=t(c[n]),c})}function Zu(e,t){fe.update(r=>{const n=r.findIndex(s=>s.hashes.contentHash===e);if(n===-1)return r;const c=r[n],a=t(c);c.runtimeUri&&c.runtimeUri!==a.runtimeUri&&c.runtimeUri.startsWith("blob:")&&URL.revokeObjectURL(c.runtimeUri);const o=[...r];return o[n]=a,o})}function Qu(e){return be(fe).find(t=>t.hashes.contentHash===e)}function el(e){Ie.update(t=>[...t,...e])}function Zs(e){Ie.update(t=>t.flatMap(r=>{const n=r.imageIds.filter(o=>o!==e);if(n.length===0)return[];const[c,...a]=n;return[{...r,imageIds:[c,...a],baseImageId:n.includes(r.baseImageId)?r.baseImageId:c}]}))}function hn(e){Et.update(t=>t.filter(r=>r.sourceImageId!==e&&r.targetImageId!==e))}function Ir(e){const t=be(fe).find(n=>n.id===e);if(!t)return;const r=t.hashes.contentHash;Pt.update(n=>n.filter(c=>c.baseImageContentHash!==r&&c.comparedImageContentHash!==r))}async function tl(e,t){const n=be(fe).find(o=>o.id===e);if(!n)return;const c=n.hashes.contentHash;fe.update(o=>o.map(s=>s.id===e?{...s,preparation:t,workflow:{stage:"prepared",updatedAt:new Date().toISOString()}}:s)),await Ws(c),await Pn(c,t),await Js(c,t);const a=await Fu(c);fe.update(o=>o.map(s=>s.hashes.contentHash===c?{...s,hashes:{...s.hashes,perceptualHash:a}}:s)),Zs(e),hn(e),Ir(e)}async function rl(e){Ku(),xu({version:e.version,createdAt:e.createdAt,notes:e.notes});const t=e.images.map(n=>({...n,runtimeUri:void 0}));hs(t),Gu(e.groups),Bu(e.alignments),Wu(e.annotations??[]),Ju(e.ui),await Promise.resolve();for(const n of e.images)try{await Ys(n.hashes.contentHash)}catch(c){console.warn("Could not ensure thumbnail:",c)}const r=await Hu(t);hs(r)}var nl=W("<button>Load Project</button>");function al(e,t){pe(t,!1);async function r(){const c=document.createElement("input");c.type="file",c.accept="application/json",c.onchange=async()=>{const a=c.files?.[0];if(!a)return;const o=await a.text();let s;try{s=JSON.parse(o)}catch{alert("Invalid JSON file");return}const l=Ko(s),v=Tu(l);v.valid||console.warn("Project validation warnings:",v.errors),await rl(l)},c.click()}he();var n=nl();de("click",n,r),H(e,n),ve()}var sl=W("<button>Save</button>");function ol(e,t){pe(t,!1);const r=()=>Te(Or,"$project",n),[n,c]=Je();function a(){const s=be(Or);if(!s)return;const l=JSON.stringify(s,null,2),v=new Blob([l],{type:"application/json"}),f=document.createElement("a");f.href=URL.createObjectURL(v),f.download="image-alignment-project.json",f.click(),URL.revokeObjectURL(f.href)}he();var o=sl();ue(()=>o.disabled=r()===null),de("click",o,a),H(e,o),ve(),c()}let un=null;function il(){return un||(un=new Worker(new URL(""+new URL("../workers/hasher.worker-BdwMdHhR.js",import.meta.url).href,import.meta.url),{type:"module"})),un}function ps(e){return new Promise((t,r)=>{const n=il(),c=o=>{n.removeEventListener("message",c),n.removeEventListener("error",a),o.data?.error?r(new Error(o.data.error)):t(o.data)},a=o=>{n.removeEventListener("message",c),n.removeEventListener("error",a),r(o)};n.addEventListener("message",c),n.addEventListener("error",a),n.postMessage(e)})}async function cl(e){const t=await e.arrayBuffer(),{contentHash:r}=await ps({type:"content-hash",buffer:t}),n=await createImageBitmap(e),{perceptualHash:c}=await ps({type:"perceptual-hash",bitmap:n});return{contentHash:r,perceptualHash:c}}function ul(){return"showDirectoryPicker"in window}var ll=W('<div class="progress svelte-b8a8hh"> <progress max="100" class="svelte-b8a8hh"></progress></div>'),dl=W('<button class="svelte-b8a8hh"> </button> <!>',1);function fl(e,t){pe(t,!1);let r=re(!1),n=re(0),c=re(0);async function a(){const y=[];if(ul()){const _=await window.showDirectoryPicker();await o(_,y)}else{const _=document.createElement("input");_.type="file",_.webkitdirectory=!0,_.multiple=!0,_.onchange=async()=>{for(const i of Array.from(_.files??[])){if(!i.type.startsWith("image/"))continue;const d=i.webkitRelativePath;y.push({file:i,structuralPath:d})}await s(y)},_.click();return}await s(y)}async function o(y,_,i=""){for await(const d of y.values()){const u=i?`${i}/${d.name}`:d.name;if(d.kind==="directory"&&await o(d,_,u),d.kind==="file"){const m=await d.getFile();if(!m.type.startsWith("image/"))continue;_.push({file:m,structuralPath:u})}}}async function s(y){if(!y.length)return;B(c,y.length),B(n,0),B(r,!0);const _=[...y];let i=0;async function d(){for(;_.length>0;){const u=_.shift();if(!u)break;try{await l(u.file,u.structuralPath)}catch(m){console.error("Ingest failed:",u.file.name,m)}i++,B(n,Math.round(i/T(c)*100))}}await d(),B(r,!1)}async function l(y,_){if(!y.type.match(/^image\/(png|jpeg|jpg|webp)$/)){console.warn("Unsupported image type:",y.name);return}const{contentHash:i}=await cl(y),d=Qu(i),u=URL.createObjectURL(y);if(d){Zu(i,h=>({...h,runtimeUri:u,label:y.name,structuralPath:_}));return}const m=await createImageBitmap(y),b={rotation:0,rect:{x:0,y:0,width:1,height:1}};await Cu(i,y),await Ys(i),Yu({id:crypto.randomUUID(),sourceType:"local",source:{},label:y.name,structuralPath:_,hashes:{contentHash:i},dimensions:{width:m.width,height:m.height},preparation:b,workflow:{stage:"ingested",updatedAt:new Date().toISOString()},runtimeUri:u})}he();var v=dl(),f=Pe(v),w=x(f,!0);K(f);var g=Y(f,2);{var p=y=>{var _=ll(),i=x(_),d=Y(i);K(_),ue(()=>{_e(i,`Processing ${T(n)??""}% (${T(c)??""} images) `),Es(d,T(n))}),H(y,_)};ce(g,y=>{T(r)&&y(p)})}ue(()=>{f.disabled=T(r),_e(w,T(r)?"Processing…":"Import Images")}),de("click",f,a),H(e,v),ve()}function ml(){const{subscribe:e,set:t}=Ye("prepare");return{subscribe:e,set:t,reset:()=>t("prepare")}}const pn=ml();var hl=W("<button> </button>"),pl=W('<nav class="mode-tabs svelte-1hztilm"></nav>');function vl(e,t){pe(t,!1);const r=()=>Te(pn,"$currentMode",n),[n,c]=Je(),a=["prepare","group","align","annotate"];function o(l){pn.set(l)}he();var s=pl();bt(s,5,()=>a,$n,(l,v)=>{var f=hl();let w;var g=x(f,!0);K(f),ue(p=>{w=st(f,1,"svelte-1hztilm",null,w,{selected:r()===T(v)}),_e(g,p)},[()=>T(v)[0].toUpperCase()+T(v).slice(1)]),de("click",f,()=>o(T(v))),H(l,f)}),K(s),H(e,s),ve(),c()}var gl=W('<div class="header-wrapper svelte-1x11hix"><header class="header svelte-1x11hix"><div class="actions svelte-1x11hix"><!> <!> <!> <button>Help</button> <button>About</button></div> <div class="title svelte-1x11hix"><a href="https://github.com/UoMLibrary/uom-open-annotator/" target="_blank" rel="noopener noreferrer" class="svelte-1x11hix">Image Alignment Tool</a></div></header> <!></div>');function yl(e,t){pe(t,!1);const r=et();he();var n=gl(),c=x(n),a=x(c),o=x(a);fl(o,{});var s=Y(o,2);al(s,{});var l=Y(s,2);ol(l,{});var v=Y(l,2),f=Y(v,2);K(a),yn(2),K(c);var w=Y(c,2);vl(w,{}),K(n),de("click",v,()=>r("help")),de("click",f,()=>r("about")),H(e,n),ve()}var _l=W('<div class="panel-content svelte-8vymep"><!></div>'),$l=W('<div><aside class="svelte-8vymep"><header><!></header> <!></aside> <button class="toggle svelte-8vymep" aria-label="Toggle panel"><!></button></div>');function Qs(e,t){pe(t,!1);let r=ye(t,"side",8,"left"),n=ye(t,"open",12,!0),c=ye(t,"width",8,260);const a=et();function o(){n(!n()),a("toggle",n())}function s(m){m.target instanceof HTMLElement&&["INPUT","TEXTAREA"].includes(m.target.tagName)||(r()==="left"&&m.key==="["&&(m.preventDefault(),o()),r()==="right"&&m.key==="]"&&(m.preventDefault(),o()))}Nr(()=>{window.addEventListener("keydown",s)}),Tr(()=>{window.removeEventListener("keydown",s)}),he();var l=$l();let v;var f=x(l),w=x(f),g=x(w);kr(g,t,"header",{}),K(w);var p=Y(w,2);{var y=m=>{var b=_l(),h=x(b);kr(h,t,"default",{}),K(b),H(m,b)};ce(p,m=>{n()&&m(y)})}K(f);var _=Y(f,2),i=x(_);{var d=m=>{var b=dn();ue(()=>_e(b,n()?"⟨":"⟩")),H(m,b)},u=m=>{var b=dn();ue(()=>_e(b,n()?"⟩":"⟨")),H(m,b)};ce(i,m=>{r()==="left"?m(d):m(u,!1)})}K(_),K(l),ue(()=>{v=st(l,1,`side-panel ${r()??""}`,"svelte-8vymep",v,{collapsed:!n()}),Le(l,`--panel-width: ${c()??""}px`)}),de("click",_,o),H(e,l),ve()}var bl=W('<div class="overlay svelte-1paf3gs"><div class="rectangle svelte-1paf3gs"></div> <div class="handle tl svelte-1paf3gs"></div> <div class="handle tr svelte-1paf3gs"></div> <div class="handle bl svelte-1paf3gs"></div> <div class="handle br svelte-1paf3gs"></div></div>');function wl(e,t){pe(t,!1);let r=ye(t,"rect",24,()=>({x:0,y:0,width:1,height:1}));const n=et();let c=re(),a=null,o=!1,s={x:0,y:0};function l(u){a=u,window.addEventListener("pointermove",f),window.addEventListener("pointerup",w)}function v(u){u.stopPropagation(),o=!0;const m=T(c).getBoundingClientRect(),b=(u.clientX-m.left)/m.width,h=(u.clientY-m.top)/m.height;s={x:b-r().x,y:h-r().y},window.addEventListener("pointermove",f),window.addEventListener("pointerup",w)}function f(u){const m=T(c).getBoundingClientRect(),b=(u.clientX-m.left)/m.width,h=(u.clientY-m.top)/m.height;let $={...r()};if(o){$.x=b-s.x,$.y=h-s.y,$.x=Math.max(0,Math.min(1-r().width,$.x)),$.y=Math.max(0,Math.min(1-r().height,$.y)),n("change",$);return}if(a){if(a.includes("left")){const E=r().x+r().width;$.x=Math.min(b,E-.01),$.width=E-$.x}if(a.includes("right")&&($.width=Math.max(.01,b-r().x)),a.includes("top")){const E=r().y+r().height;$.y=Math.min(h,E-.01),$.height=E-$.y}a.includes("bottom")&&($.height=Math.max(.01,h-r().y)),n("change",$)}}function w(){a=null,o=!1,window.removeEventListener("pointermove",f),window.removeEventListener("pointerup",w)}Tr(w),he();var g=bl(),p=x(g),y=Y(p,2),_=Y(y,2),i=Y(_,2),d=Y(i,2);K(g),Ps(g,u=>B(c,u),()=>T(c)),ue(()=>{Le(p,`
			left: ${ge(r()),se(()=>r().x*100)??""}%;
			top: ${ge(r()),se(()=>r().y*100)??""}%;
			width: ${ge(r()),se(()=>r().width*100)??""}%;
			height: ${ge(r()),se(()=>r().height*100)??""}%;
		`),Le(y,`left:${ge(r()),se(()=>r().x*100)??""}%; top:${ge(r()),se(()=>r().y*100)??""}%`),Le(_,`left:${ge(r()),se(()=>(r().x+r().width)*100)??""}%; top:${ge(r()),se(()=>r().y*100)??""}%`),Le(i,`left:${ge(r()),se(()=>r().x*100)??""}%; top:${ge(r()),se(()=>(r().y+r().height)*100)??""}%`),Le(d,`left:${ge(r()),se(()=>(r().x+r().width)*100)??""}%; top:${ge(r()),se(()=>(r().y+r().height)*100)??""}%`)}),de("pointerdown",p,v),de("pointerdown",y,()=>l("top-left")),de("pointerdown",_,()=>l("top-right")),de("pointerdown",i,()=>l("bottom-left")),de("pointerdown",d,()=>l("bottom-right")),H(e,g),ve()}var Sl=W('<div class="crosshair-overlay full-size svelte-o9b4xt"><div class="line vertical svelte-o9b4xt"></div> <div class="line horizontal svelte-o9b4xt"></div> <div class="hit-area svelte-o9b4xt"><div class="center svelte-o9b4xt"></div></div></div>');function El(e,t){pe(t,!1);let r=ye(t,"x",12,.5),n=ye(t,"y",12,.5);const c=et();ye(t,"fullSize",8,!1);let a=!1,o=re();function s(y){y.stopPropagation(),a=!0,window.addEventListener("pointermove",l),window.addEventListener("pointerup",v)}function l(y){if(!a)return;const _=T(o).getBoundingClientRect();r((y.clientX-_.left)/_.width),n((y.clientY-_.top)/_.height),r(Math.max(0,Math.min(1,r()))),n(Math.max(0,Math.min(1,n()))),c("change",{x:r(),y:n()})}function v(){a=!1,window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",v)}he();var f=Sl(),w=x(f),g=Y(w,2),p=Y(g,2);K(f),Ps(f,y=>B(o,y),()=>T(o)),ue(()=>{Le(w,`left: ${r()*100}%`),Le(g,`top: ${n()*100}%`),Le(p,`left: ${r()*100}%; top: ${n()*100}%`)}),de("pointerdown",p,s),H(e,f),ve()}var Pl=W('<div class="rotation-controls svelte-180z7op"><input class="slider svelte-180z7op" type="range" min="-10" max="10" step="0.01"/> <span class="angle svelte-180z7op"> </span></div>');function Il(e,t){pe(t,!1);let r=ye(t,"rotation",8,0);const n=et();function c(v){const f=Number(v.target.value);n("change",f)}he();var a=Pl(),o=x(a);_n(o);var s=Y(o,2),l=x(s);K(s),K(a),ue(v=>{Es(o,r()),_e(l,`${v??""}°`)},[()=>(ge(r()),se(()=>r().toFixed(2)))]),de("input",o,c),H(e,a),ve()}const Pr=["ingested","prepared","grouped","aligned","annotated"];function ln(e,t){Xu(e,r=>({...r,workflow:{stage:t,updatedAt:new Date().toISOString()}})),kl(e,t)}function kl(e,t){const r=Pr.indexOf(t);r<=Pr.indexOf("prepared")&&(Zs(e),hn(e),Ir(e)),r<=Pr.indexOf("grouped")&&(hn(e),Ir(e)),r<=Pr.indexOf("aligned")&&Ir(e)}var Rl=W("<button>Confirm Geometry</button>"),jl=W('<div class="canvas-wrapper svelte-1ktk2db"><div class="viewport svelte-1ktk2db"><div class="image-frame svelte-1ktk2db"><div class="rotated-layer svelte-1ktk2db"><img alt="" class="svelte-1ktk2db"/></div> <div class="crop-layer svelte-1ktk2db"><!></div></div> <div class="crosshair-layer svelte-1ktk2db"><!></div></div> <!> <!></div>');function Ol(e,t){pe(t,!1);const r=re();let n=ye(t,"selectedImage",8),c=re(0),a=re({x:0,y:0,width:1,height:1}),o=re({x:.5,y:.5}),s=re(T(c)),l=re(JSON.stringify(T(a)));async function v(){const{hashes:M,preparation:N}=n();if(!M?.contentHash||!N){console.error("Missing data for regeneration");return}await Pn(M.contentHash,N),await Js(M.contentHash,N),ln(n().id,"prepared")}function f(M){const N=Math.max(0,Math.min(1,M.x)),z=Math.max(0,Math.min(1,M.y)),L=Math.max(0,Math.min(1-N,M.width)),U=Math.max(0,Math.min(1-z,M.height));return{x:N,y:z,width:L,height:U}}async function w(){n()&&await tl(n().id,{rect:f(T(a)),rotation:T(c)})}function g(M){B(a,f(M)),w()}function p(M){B(c,M),w()}Ae(()=>ge(n()),()=>{n()&&(n().preparation?(B(c,n().preparation.rotation??0),B(a,n().preparation.rect??{x:0,y:0,width:1,height:1})):(B(c,0),B(a,{x:0,y:0,width:1,height:1})))}),Ae(()=>(T(a),T(c),T(s),T(l),ge(n()),ln),()=>{const M=JSON.stringify(T(a));(T(c)!==T(s)||M!==T(l))&&(B(s,T(c)),B(l,M),n().workflow?.stage!=="ingested"&&(Ws(n().hashes.contentHash),ln(n().id,"ingested")))}),Ae(()=>ge(n()),()=>{B(r,n().workflow?.stage==="ingested")}),ft(),he();var y=jl(),_=x(y),i=x(_),d=x(i),u=x(d);K(d);var m=Y(d,2),b=x(m);wl(b,{get rect(){return T(a)},$$events:{change:M=>g(M.detail)}}),K(m),K(i);var h=Y(i,2),$=x(h);El($,{fullSize:!0,get x(){return T(o),se(()=>T(o).x)},get y(){return T(o),se(()=>T(o).y)},$$events:{change:M=>B(o,M.detail)}}),K(h),K(_);var E=Y(_,2);{var R=M=>{var N=Rl();de("click",N,v),H(M,N)};ce(E,M=>{T(r)&&M(R)})}var A=Y(E,2);Il(A,{get rotation(){return T(c)},$$events:{change:M=>p(M.detail)}}),K(y),ue(()=>{Le(d,`transform: rotate(${T(c)??""}deg);`),yt(u,"src",(ge(n()),se(()=>n().runtimeUri??n().source.uri)))}),H(e,y),ve()}var Nl=W('<div class="toolbar svelte-11wwtmt"><span> </span></div>');function Tl(e,t){pe(t,!1);let r=ye(t,"selectedImage",8);he();var n=Nl(),c=x(n),a=x(c);K(c),K(n),ue(()=>_e(a,`Editing: ${ge(r()),se(()=>r().id)??""}`)),H(e,n),ve()}var Ml=W("<button> </button>"),ql=W('<div class="panel-title svelte-o335dd">Images</div>'),Al=W("<!> <!>",1),Cl=W('<div class="placeholder svelte-o335dd">Select an image to prepare</div>'),Dl=W('<div class="prepare-layout svelte-o335dd"><!> <div class="workspace svelte-o335dd"><!></div></div>');function zl(e,t){pe(t,!1);const r=()=>Te(fe,"$images",c),n=()=>Te(Or,"$project",c),[c,a]=Je(),o=re();let s=re(null),l=re(!0);function v(i){B(s,i),Xs({lastSelectedImageId:i})}Ae(()=>(r(),T(s),n()),()=>{if(r().length===0)B(s,null);else if(!T(s)){const i=n().ui?.lastSelectedImageId;i&&r().some(d=>d.id===i)?B(s,i):B(s,r()[0].id)}}),Ae(()=>(r(),T(s)),()=>{B(o,r().find(i=>i.id===T(s))??null)}),ft(),he();var f=Dl(),w=x(f);Qs(w,{side:"left",width:260,get open(){return T(l)},set open(i){B(l,i)},children:(i,d)=>{var u=Re(),m=Pe(u);bt(m,1,r,$n,(b,h)=>{var $=Ml();let E;var R=x($,!0);K($),ue(()=>{E=st($,1,"svelte-o335dd",null,E,{selected:T(h).id===T(s)}),_e(R,(T(h),se(()=>T(h).label??T(h).id)))}),de("click",$,()=>v(T(h).id)),H(b,$)}),H(i,u)},$$slots:{default:!0,header:(i,d)=>{var u=ql();H(i,u)}},$$legacy:!0});var g=Y(w,2),p=x(g);{var y=i=>{var d=Al(),u=Pe(d);Ol(u,{get selectedImage(){return T(o)}});var m=Y(u,2);Tl(m,{get selectedImage(){return T(o)}}),H(i,d)},_=i=>{var d=Cl();H(i,d)};ce(p,i=>{T(o)?i(y):i(_,!1)})}K(g),K(f),H(e,f),ve(),a()}var Ul=W("<div>AlignWorkspace</div>");function Vl(e){var t=Ul();H(e,t)}function Ll(e,t){if(e.length!==t.length)return 0;let r=0;for(let n=0;n<e.length;n++)e[n]===t[n]&&r++;return r/e.length}function Fl(e,t){let r=0,n=0,c=0;for(let a=0;a<e.length;a++)r+=e[a]*t[a],n+=e[a]*e[a],c+=t[a]*t[a];return r/(Math.sqrt(n)*Math.sqrt(c))}function Hl(e){return e.map(t=>({id:crypto.randomUUID(),imageIds:[t.id],reason:`Individual: ${t.label||"Unnamed"}`}))}function Kl(e){const t=new Map;for(const r of e){if(!r.label)continue;const n=r.label.toLowerCase().replace(/\.(jpg|jpeg|png|tif|tiff)$/i,"").replace(/[_-]?\d+$/,"");t.has(n)||t.set(n,[]),t.get(n).push(r.id)}return[...t.entries()].filter(([,r])=>r.length>1).map(([r,n])=>({id:crypto.randomUUID(),imageIds:n,reason:`Filename stem: ${r}`}))}function xl(e){const t=new Map;for(const r of e){if(!r.structuralPath)continue;const n=r.structuralPath.split("/").filter(Boolean);if(n.length<2)continue;const c=n.slice(0,-1).join("/");t.has(c)||t.set(c,[]),t.get(c).push(r.id)}return[...t.entries()].filter(([,r])=>r.length>1).map(([r,n])=>({id:crypto.randomUUID(),imageIds:n,reason:`Leaf folder: ${r}`}))}function Gl(e,t=.85){const r=new Set,n=[];for(let c=0;c<e.length;c++){const a=e[c];if(!a.hashes.perceptualHash||r.has(a.id))continue;const o=[a.id];for(let s=c+1;s<e.length;s++){const l=e[s];if(!l.hashes.perceptualHash||r.has(l.id))continue;Ll(a.hashes.perceptualHash,l.hashes.perceptualHash)>=t&&(o.push(l.id),r.add(l.id))}o.length>1&&(o.forEach(s=>r.add(s)),n.push({id:crypto.randomUUID(),imageIds:o,confidence:t,reason:`pHash ≥ ${Math.round(t*100)}%`}))}return n}function Bl(e,t,r=.8){const n=new Set,c=[];for(let a=0;a<e.length;a++){const o=e[a];if(n.has(o.id))continue;const s=t.get(o.id);if(!s)continue;const l=[o.id];for(let v=a+1;v<e.length;v++){const f=e[v];if(n.has(f.id))continue;const w=t.get(f.id);w&&Fl(s,w)>=r&&(l.push(f.id),n.add(f.id))}l.length>1&&(l.forEach(v=>n.add(v)),c.push({id:crypto.randomUUID(),imageIds:l,reason:`Visual profile ≥ ${Math.round(r*100)}%`}))}return c}function Wl(e){if(e.imageIds.length===0)return;const t=new Set(e.imageIds),n=be(Ie).map(s=>{const l=s.imageIds.filter(w=>!t.has(w));if(l.length===0)return null;if(l.length===s.imageIds.length)return s;const[v,...f]=l;return{...s,imageIds:[v,...f],baseImageId:l.includes(s.baseImageId)?s.baseImageId:v}}).filter(s=>s!==null),[c,...a]=e.imageIds,o={id:crypto.randomUUID(),baseImageId:c,imageIds:[c,...a],locked:!1};el([...n,o])}const Xe=Ye({proposals:[],selected:new Set});function Jl(){const e=be(fe);e.length!==0&&Xe.update(t=>{if(t.proposals.length>0)return t;const r=e.map(n=>({id:n.id,imageIds:[n.id],reason:"Initial state",confidence:1}));return{...t,proposals:r}})}var Yl=W('<div class="empty">No groups yet</div>'),Xl=W("<div> </div>"),Zl=W('<div class="group-list svelte-rc3p54"><!></div>');function Ql(e,t){pe(t,!1);const r=()=>Te(Ie,"$groups",n),[n,c]=Je();let a=ye(t,"selectedGroupId",8,null);const o=et();function s(g){o("select",{id:g})}he();var l=Zl(),v=x(l);{var f=g=>{var p=Yl();H(g,p)},w=g=>{var p=Re(),y=Pe(p);bt(y,1,r,_=>_.id,(_,i)=>{var d=Xl();let u;var m=x(d);K(d),ue(()=>{u=st(d,1,"group-row svelte-rc3p54",null,u,{selected:T(i).id===a()}),_e(m,`Group (${T(i),se(()=>T(i).imageIds.length)??""})`)}),de("click",d,()=>s(T(i).id)),H(_,d)}),H(g,p)};ce(v,g=>{r(),se(()=>r().length===0)?g(f):g(w,!1)})}K(l),H(e,l),ve(),c()}var ed=W('<p class="status svelte-lg1us8">Generating proposals…</p>'),td=W('<div class="tool svelte-lg1us8"><div class="tool-header svelte-lg1us8"><p class="description svelte-lg1us8">Create a separate group for each individual image.</p> <button class="run-button svelte-lg1us8"> </button></div> <!></div>');function rd(e,t){pe(t,!1);let r=re(!1);async function n(){if(!T(r)){B(r,!0);try{const f=be(fe),w=be(Ie),g=new Set(w.flatMap(_=>_.imageIds)),p=f.filter(_=>!g.has(_.id)),y=Hl(p);Xe.set({proposals:y,selected:new Set})}finally{B(r,!1)}}}he();var c=td(),a=x(c),o=Y(x(a),2),s=x(o,!0);K(o),K(a);var l=Y(a,2);{var v=f=>{var w=ed();H(f,w)};ce(l,f=>{T(r)&&f(v)})}K(c),ue(()=>{o.disabled=T(r),_e(s,T(r)?"Running…":"Create individual groups")}),de("click",o,n),H(e,c),ve()}var nd=W('<p class="status svelte-5pxqv6">Generating proposals…</p>'),ad=W('<div class="tool svelte-5pxqv6"><div class="tool-header svelte-5pxqv6"><p class="description svelte-5pxqv6">Group images based on shared filename patterns.</p> <button class="run-button svelte-5pxqv6"> </button></div> <!></div>');function sd(e,t){pe(t,!1);let r=re(!1),n=!1;async function c(){if(!T(r)){B(r,!0),n=!1;try{const p=be(fe),y=be(Ie),_=new Set(y.flatMap(u=>u.imageIds)),i=p.filter(u=>!_.has(u.id));if(n)return;const d=Kl(i);if(n)return;Xe.set({proposals:d,selected:new Set})}finally{B(r,!1)}}}function a(){n=!0}var o={cancel:a};he();var s=ad(),l=x(s),v=Y(x(l),2),f=x(v,!0);K(v),K(l);var w=Y(l,2);{var g=p=>{var y=nd();H(p,y)};ce(w,p=>{T(r)&&p(g)})}return K(s),ue(()=>{v.disabled=T(r),_e(f,T(r)?"Running…":"Run grouping strategy")}),de("click",v,c),H(e,s),dt(t,"cancel",a),ve(o)}var od=W('<p class="status svelte-1l9xk4h">Generating proposals…</p>'),id=W('<div class="tool svelte-1l9xk4h"><div class="tool-header svelte-1l9xk4h"><p class="description svelte-1l9xk4h">Group images found together in leaf folders.</p> <button class="run-button svelte-1l9xk4h"> </button></div> <!></div>');function cd(e,t){pe(t,!1);let r=re(!1),n=!1;async function c(){if(!T(r)){B(r,!0),n=!1;try{const p=be(fe),y=be(Ie),_=new Set(y.flatMap(u=>u.imageIds)),i=p.filter(u=>!_.has(u.id));if(n)return;const d=xl(i);if(n)return;Xe.set({proposals:d,selected:new Set})}finally{B(r,!1)}}}function a(){n=!0}var o={cancel:a};he();var s=id(),l=x(s),v=Y(x(l),2),f=x(v,!0);K(v),K(l);var w=Y(l,2);{var g=p=>{var y=od();H(p,y)};ce(w,p=>{T(r)&&p(g)})}return K(s),ue(()=>{v.disabled=T(r),_e(f,T(r)?"Running…":"Run grouping strategy")}),de("click",v,c),H(e,s),dt(t,"cancel",a),ve(o)}var ud=W('<p class="status svelte-gu0ydb">Computing similarity…</p>'),ld=W('<div class="tool svelte-gu0ydb"><p class="description svelte-gu0ydb">Group images based on perceptual hash (pHash) similarity.</p> <label class="slider svelte-gu0ydb"> <input type="range" min="0.2" max="1" step="0.01"/></label> <!></div>');function dd(e,t){pe(t,!1);let r=re(.95),n=re(!1),c=!1;async function a(){if(!T(n)){B(n,!0),c=!1;try{const _=be(fe),i=be(Ie),d=new Set(i.flatMap(b=>b.imageIds)),u=_.filter(b=>!d.has(b.id));if(c)return;const m=Gl(u,T(r));if(c)return;Xe.set({proposals:m,selected:new Set})}finally{B(n,!1)}}}function o(){c=!0}async function s(){o(),await a()}var l={run:a,cancel:o};he();var v=ld(),f=Y(x(v),2),w=x(f),g=Y(w);_n(g),K(f);var p=Y(f,2);{var y=_=>{var i=ud();H(_,i)};ce(p,_=>{T(n)&&_(y)})}return K(v),ue(_=>_e(w,`Similarity: ${_??""}% `),[()=>Math.round(T(r)*100)]),ks(g,()=>T(r),_=>B(r,_)),de("change",g,s),H(e,v),dt(t,"run",a),dt(t,"cancel",o),ve(l)}function fd(e,t=16){const r=Math.min(e.width,e.height),n=document.createElement("canvas");n.width=n.height=r;const c=n.getContext("2d");c.drawImage(e,(e.width-r)/2,(e.height-r)/2,r,r,0,0,r,r);const a=c.getImageData(0,0,r,r).data,o=new Array(t*3).fill(0);for(let l=0;l<a.length;l+=4){const v=a[l]/255,f=a[l+1]/255,w=a[l+2]/255,g=Math.max(v,f,w),p=Math.min(v,f,w),y=g,_=g===0?0:(g-p)/g;let i=0;g!==p&&(g===v?i=(f-w)/(g-p):g===f?i=2+(w-v)/(g-p):i=4+(v-f)/(g-p),i=(i*60+360)%360);const d=Math.floor(i/360*t),u=Math.floor(_*t),m=Math.floor(y*t);o[d]++,o[t+u]++,o[2*t+m]++}const s=o.reduce((l,v)=>l+v,0);return o.map(l=>l/s)}var md=W('<p class="hint svelte-50bumr">Computing visual profiles…</p>'),hd=W('<p class="hint svelte-50bumr">Grouping images…</p>'),pd=W('<div class="tool svelte-50bumr"><p class="description svelte-50bumr">Group images by overall colour and tone, ignoring layout and exact pixels.</p> <label class="slider svelte-50bumr"> <input type="range" min="0.5" max="1" step="0.01"/></label> <!> <!></div>');function vd(e,t){pe(t,!1);let r=re(.9),n=new Map,c=re(!1),a=re(!1),o=!1,s="";Tr(()=>{o=!0});async function l(){const h=be(fe);B(c,!0),n.clear();for(const $ of h){if(o)return;if(!$.uri)continue;const E=new Image;if(E.src=$.uri,await E.decode(),o)return;n.set($.id,fd(E))}B(c,!1)}async function v(){if(!T(a)){B(a,!0),o=!1;try{const h=be(fe),$=be(Ie),E=h.map(N=>N.id).join("|");if(E!==s&&(s=E,await l()),o)return;const R=new Set($.flatMap(N=>N.imageIds)),A=h.filter(N=>!R.has(N.id)),M=Bl(A,n,T(r));if(o)return;Xe.set({proposals:M,selected:new Set})}finally{B(a,!1)}}}function f(){o=!0}function w(){f(),v()}var g={run:v,cancel:f};he();var p=pd(),y=Y(x(p),2),_=x(y),i=Y(_);_n(i),K(y);var d=Y(y,2);{var u=h=>{var $=md();H(h,$)};ce(d,h=>{T(c)&&h(u)})}var m=Y(d,2);{var b=h=>{var $=hd();H(h,$)};ce(m,h=>{T(a)&&!T(c)&&h(b)})}return K(p),ue(h=>_e(_,`Similarity: ${h??""}% `),[()=>Math.round(T(r)*100)]),ks(i,()=>T(r),h=>B(r,h)),de("change",i,w),H(e,p),dt(t,"run",v),dt(t,"cancel",f),ve(g)}var gd=W('<header class="panel-header svelte-11q4ii2"><div><!></div></header>');function yd(e,t){let r=ye(t,"inline",8,!1);var n=gd(),c=x(n);let a;var o=x(c);kr(o,t,"default",{}),K(c),K(n),ue(()=>a=st(c,1,"inner svelte-11q4ii2",null,a,{"inner-inline":r()})),H(e,n)}var _d=W('<h2 class="panel-title">Grouping Strategy</h2>'),$d=W("<section><!> <select><option>Individual Images</option><option>By Filename</option><option>By Leaf Folder</option><option>By pHash</option><option>By Visual Profile</option></select> <!></section>");function bd(e){let t=re("individual");var r=$d(),n=x(r);yd(n,{inline:!0,children:(p,y)=>{var _=_d();H(p,_)},$$slots:{default:!0}});var c=Y(n,2);ue(()=>{T(t),Eo(()=>{})});var a=x(c);a.value=a.__value="individual";var o=Y(a);o.value=o.__value="filename";var s=Y(o);s.value=s.__value="leaf";var l=Y(s);l.value=l.__value="phash";var v=Y(l);v.value=v.__value="visual",K(c);var f=Y(c,2);{var w=p=>{rd(p,{})},g=p=>{var y=Re(),_=Pe(y);{var i=u=>{sd(u,{})},d=u=>{var m=Re(),b=Pe(m);{var h=E=>{cd(E,{})},$=E=>{var R=Re(),A=Pe(R);{var M=z=>{dd(z,{})},N=z=>{var L=Re(),U=Pe(L);{var Z=me=>{vd(me,{})};ce(U,me=>{T(t)==="visual"&&me(Z)},!0)}H(z,L)};ce(A,z=>{T(t)==="phash"?z(M):z(N,!1)},!0)}H(E,R)};ce(b,E=>{T(t)==="leaf"?E(h):E($,!1)},!0)}H(u,m)};ce(_,u=>{T(t)==="filename"?u(i):u(d,!1)},!0)}H(p,y)};ce(f,p=>{T(t)==="individual"?p(w):p(g,!1)})}K(r),Mo(c,()=>T(t),p=>B(t,p)),H(e,r)}var wd=W('<div class="compare svelte-16oy9ld"><img alt="original" draggable="false" class="svelte-16oy9ld"/> <img alt="trimmed" draggable="false" class="svelte-16oy9ld"/></div>'),Sd=W('<img draggable="false" class="svelte-16oy9ld"/>'),Ed=W('<div class="placeholder svelte-16oy9ld"><div class="placeholder-icon svelte-16oy9ld">🖼️</div> <div class="placeholder-text svelte-16oy9ld">Re-import folder<br/>to relink</div></div>'),Pd=W('<div class="label svelte-16oy9ld"> </div>'),Id=W('<div class="thumb svelte-16oy9ld"><div><!></div> <!></div>');function kd(e,t){pe(t,!1);let r=ye(t,"contentHash",8),n=ye(t,"fallbackSrc",8),c=ye(t,"label",8,void 0),a=ye(t,"mode",8,"thumb"),o=ye(t,"debugCompare",8,!1);const s="v2_512_gray_trim_pad",l="v1_256",v="v1_raw_trim",f={thumb:l,normalised:s,trim:v},w={thumb:"thumb",normalised:"norm",trim:"trim"};let g=re(n()),p=re(null),y=re(!1),_=null,i=null;async function d(){if(!r())return;_&&(URL.revokeObjectURL(_),_=null),i&&(URL.revokeObjectURL(i),i=null);const A=`${w[a()]}::${r()}::${f[a()]}`,M=await Fe(A);if(M?(_=URL.createObjectURL(M),B(g,_)):B(g,n()),o()){const N=`trim::${r()}::${v}`,z=await Fe(N);z?(i=URL.createObjectURL(z),B(p,i)):B(p,null)}else B(p,null)}Nr(d),Tr(()=>{_&&URL.revokeObjectURL(_),i&&URL.revokeObjectURL(i)}),Ae(()=>(ge(r()),ge(a()),ge(o())),()=>{r(),a(),o(),d()}),ft(),he();var u=Id(),m=x(u),b=x(m);{var h=A=>{var M=Re(),N=Pe(M);{var z=U=>{var Z=wd(),me=x(Z),$e=Y(me,2);K(Z),ue(()=>{yt(me,"src",n()),yt($e,"src",T(p))}),H(U,Z)},L=U=>{var Z=Sd();ue(()=>{yt(Z,"src",T(g)),yt(Z,"alt",c()??"Image")}),de("error",Z,()=>B(y,!0)),de("load",Z,()=>B(y,!1)),H(U,Z)};ce(N,U=>{o()&&T(p)?U(z):U(L,!1)})}H(A,M)},$=A=>{var M=Ed();H(A,M)};ce(b,A=>{T(y)?A($,!1):A(h)})}K(m);var E=Y(m,2);{var R=A=>{var M=Pd(),N=x(M,!0);K(M),ue(()=>_e(N,c())),H(A,M)};ce(E,A=>{c()&&A(R)})}K(u),ue(()=>st(m,1,`image-frame ${o()?"debug":""}`,"svelte-16oy9ld")),H(e,u),ve()}var Rd=W('<div class="empty svelte-1p49k9y">No group suggestions</div>'),jd=W('<div class="confidence svelte-1p49k9y"> </div>'),Od=W('<div class="reason svelte-1p49k9y"> </div>'),Nd=W('<div class="proposal-card svelte-1p49k9y"><div class="proposal-header svelte-1p49k9y"><div class="proposal-title svelte-1p49k9y"> </div> <!></div> <!> <div class="proposal-images svelte-1p49k9y"></div> <div class="proposal-actions svelte-1p49k9y"><button class="confirm svelte-1p49k9y">Confirm</button> <button class="discard svelte-1p49k9y">Discard</button></div></div>'),Td=W('<div class="proposal-list svelte-1p49k9y"></div>');function Md(e,t){pe(t,!1);const r=()=>Te(Xe,"$groupingState",c),n=()=>Te(fe,"$images",c),[c,a]=Je(),o=re(),s=re(),l=et();Ae(()=>r(),()=>{B(o,[...r().proposals].sort((p,y)=>y.imageIds.length-p.imageIds.length))}),Ae(()=>n(),()=>{B(s,Object.fromEntries(n().map(p=>[p.id,p])))}),ft(),he();var v=Re(),f=Pe(v);{var w=p=>{var y=Rd();H(p,y)},g=p=>{var y=Td();bt(y,5,()=>T(o),_=>_.id,(_,i)=>{var d=Nd(),u=x(d),m=x(u),b=x(m);K(m);var h=Y(m,2);{var $=L=>{var U=jd(),Z=x(U);K(U),ue(me=>_e(Z,`${me??""}%`),[()=>(T(i),se(()=>Math.round(T(i).confidence*100)))]),H(L,U)};ce(h,L=>{T(i),se(()=>T(i).confidence!=null)&&L($)})}K(u);var E=Y(u,2);{var R=L=>{var U=Od(),Z=x(U,!0);K(U),ue(()=>_e(Z,(T(i),se(()=>T(i).reason)))),H(L,U)};ce(E,L=>{T(i),se(()=>T(i).reason)&&L(R)})}var A=Y(E,2);bt(A,5,()=>(T(i),se(()=>T(i).imageIds)),$n,(L,U)=>{var Z=Re(),me=Pe(Z);{var $e=oe=>{kd(oe,{get contentHash(){return T(s),T(U),se(()=>T(s)[T(U)].hashes.contentHash)},get fallbackSrc(){return T(s),T(U),se(()=>T(s)[T(U)].uri)},get label(){return T(s),T(U),se(()=>T(s)[T(U)].label)},mode:"thumb",debugCompare:!0})};ce(me,oe=>{T(s),T(U),se(()=>T(s)[T(U)])&&oe($e)})}H(L,Z)}),K(A);var M=Y(A,2),N=x(M),z=Y(N,2);K(M),K(d),ue(()=>_e(b,`Proposed Group (${T(i),se(()=>T(i).imageIds.length)??""})`)),de("click",N,()=>l("confirm",T(i))),de("click",z,()=>l("discard",T(i).id)),H(_,d)}),K(y),H(p,y)};ce(f,p=>{T(o),se(()=>T(o).length===0)?p(w):p(g,!1)})}H(e,v),ve(),a()}var qd=W('<div class="panel-title svelte-n2c2kx"> </div>'),Ad=W('<div class="group-layout svelte-n2c2kx"><!> <div class="workspace svelte-n2c2kx"><div class="suggestions svelte-n2c2kx"><div class="panel-title svelte-n2c2kx">Group Suggestions</div> <!></div> <div class="strategy svelte-n2c2kx"><!></div></div></div>');function Cd(e,t){pe(t,!1);const r=()=>Te(Ie,"$groups",c),n=()=>Te(Or,"$project",c),[c,a]=Je();let o=re(null),s=re(!0);Nr(()=>{be(fe).length>0&&Jl()});function l(d){B(o,d),Xs({lastSelectedGroupId:d})}function v(d){Wl(d),Xe.update(u=>{const m=new Set(d.imageIds),b=u.proposals.filter(h=>!h.imageIds.some($=>m.has($)));return{...u,proposals:b,selected:new Set}})}Ae(()=>(r(),T(o),n()),()=>{if(r().length===0)B(o,null);else if(!T(o)){const d=n().ui?.lastSelectedGroupId;d&&r().some(u=>u.id===d)?B(o,d):B(o,r()[0].id)}}),Ae(()=>(T(o),r()),()=>{T(o)&&!r().some(d=>d.id===T(o))&&B(o,null)}),ft(),he();var f=Ad(),w=x(f);Qs(w,{side:"left",width:280,get open(){return T(s)},set open(d){B(s,d)},children:(d,u)=>{Ql(d,{get selectedGroupId(){return T(o)},$$events:{select:m=>l(m.detail.id)}})},$$slots:{default:!0,header:(d,u)=>{var m=qd(),b=x(m);K(m),ue(()=>_e(b,`Groups (${r(),se(()=>r().length)??""})`)),H(d,m)}},$$legacy:!0});var g=Y(w,2),p=x(g),y=Y(x(p),2);Md(y,{$$events:{confirm:d=>v(d.detail)}}),K(p);var _=Y(p,2),i=x(_);bd(i),K(_),K(g),K(f),H(e,f),ve(),a()}var Dd=W("<div>AnnotateWorkspace</div>");function zd(e){var t=Dd();H(e,t)}function Ud(e){const t=()=>Te(pn,"$currentMode",r),[r,n]=Je();var c=Re(),a=Pe(c);{var o=l=>{zl(l,{})},s=l=>{var v=Re(),f=Pe(v);{var w=p=>{Vl(p)},g=p=>{var y=Re(),_=Pe(y);{var i=u=>{Cd(u,{})},d=u=>{var m=Re(),b=Pe(m);{var h=$=>{zd($)};ce(b,$=>{t()==="annotate"&&$(h)},!0)}H(u,m)};ce(_,u=>{t()==="group"?u(i):u(d,!1)},!0)}H(p,y)};ce(f,p=>{t()==="align"?p(w):p(g,!1)},!0)}H(l,v)};ce(a,l=>{t()==="prepare"?l(o):l(s,!1)})}H(e,c),n()}const Vd=He(Ie,e=>{const t=new Set;for(const r of e)for(const n of r.imageIds)t.add(n);return t}),Ld=He(Xe,e=>{const t=new Set;for(const r of e.proposals)for(const n of r.imageIds)t.add(n);return t});He([fe,Vd,Ld],([e,t,r])=>e.map(n=>n.id).filter(n=>!t.has(n)&&!r.has(n)));var Fd=W('<div class="app svelte-1ll2mwu"><!> <!> <!> <!> <!></div>');function Hd(e,t){pe(t,!1);const r=()=>Te(fe,"$images",c),n=()=>Te(Ie,"$groups",c),[c,a]=Je(),o=re();let s=re(!1),l=re(!1),v=re(!0),f=re(0);Ae(()=>r(),()=>{B(o,r().map(d=>d.id))}),Ae(()=>(n(),T(f)),()=>{const d=n().length;d>0&&T(f)===0&&B(v,!0),B(f,d)}),ft(),he();var w=Fd(),g=x(w);zo(g,{});var p=Y(g,2);yl(p,{$$events:{help:()=>B(s,!0),about:()=>B(l,!0)}});var y=Y(p,2);Ud(y);var _=Y(y,2);Lo(_,{get open(){return T(s)},set open(d){B(s,d)},$$legacy:!0});var i=Y(_,2);Ho(i,{get open(){return T(l)},set open(d){B(l,d)},$$legacy:!0}),K(w),H(e,w),ve(),a()}var Kd=W('<meta name="description" content="Experimental image alignment and registration tool for research, exploration, and prototyping workflows."/>'),xd=W('<main class="svelte-1j6917r"><!></main>');function Gd(e){var t=xd();Io("1j6917r",n=>{var c=Kd();bs(()=>{Po.title="Image Alignment Tool"}),H(n,c)});var r=x(t);Hd(r,{}),K(t),H(e,t)}function ef(e){Gd(e)}export{ef as component};
