(function(){"use strict";async function i(n){const t=new OffscreenCanvas(9,8).getContext("2d");if(!t)throw new Error("Failed to get 2D context");t.drawImage(n,0,0,9,8);const{data:s}=t.getImageData(0,0,9,8);let a="";for(let r=0;r<8;r++)for(let o=0;o<8;o++){const c=(r*9+o)*4,f=s[c],g=s[c+4];a+=f>g?"1":"0"}return BigInt("0b"+a).toString(16).padStart(16,"0")}self.onmessage=async n=>{const e=n.data;try{if(e.type==="content-hash"){const t=await crypto.subtle.digest("SHA-256",e.buffer),s=[...new Uint8Array(t)].map(a=>a.toString(16).padStart(2,"0")).join("");self.postMessage({contentHash:s});return}if(e.type==="perceptual-hash"){const t=await i(e.bitmap);self.postMessage({perceptualHash:t});return}}catch(t){self.postMessage({error:String(t)})}}})();
