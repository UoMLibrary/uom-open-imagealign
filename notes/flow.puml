@startuml
title Image Alignment Application – Data Enrichment Workflow

start

:Create or Load Project;

if (Existing project?) then (Yes)
  :Load project.json;
else (No)
  :Ingest images;
  :Initialise project.json;
endif

partition "Prepare Stage" {

  repeat
    :Select image;
    :System proposes bounding rectangle;
    :User adjusts rectangle corners;
    :User adjusts rotation;

    :Generate normalised image;
    :Generate thumbnail;
    :Compute pHash;

    :Write preparation data to project.json
    (rotation, bounding box, pHash, normalised ref);
  repeat while (More images?)
}

partition "Group Stage" {

  :Select grouping strategy;

  :Create / modify groups;

  :Write grouping data to project.json
  (group IDs, membership);
}

partition "Align Stage" {

  repeat
    :Select group;
    :Choose reference image;
    :Compute alignment transform;
    :Confirm alignment;

    :Write alignment data to project.json
    (transform matrix, reference ID);
  repeat while (More groups?)
}

partition "Annotate Stage" {

  repeat
    :Add / edit annotations;
    :Write annotation data to project.json;
  repeat while (More annotations?)
}

:Persist final project.json;

partition "Downstream Processing" {

  :Load project.json;

  if (Use bounding boxes?) then (Yes)
    :Use normalised images;
  else (No)
    :Ignore preparation metadata;
  endif

  :Use pHash / groups / alignments
  for further analysis;
}

stop
@enduml@startuml
title Image Alignment Application – Data Enrichment Workflow

start

:Create or Load Project;

if (Existing project?) then (Yes)
  :Load project.json;
else (No)
  :Ingest images;
  :Initialise project.json;
endif

partition "Prepare Stage" {

  repeat
    :Select image;
    :System proposes bounding rectangle;
    :User adjusts rectangle corners;
    :User adjusts rotation;

    :Generate normalised image;
    :Generate thumbnail;
    :Compute pHash;

    :Write preparation data to project.json
    (rotation, bounding box, pHash, normalised ref);
  repeat while (More images?)
}

partition "Group Stage" {

  :Select grouping strategy;

  :Create / modify groups;

  :Write grouping data to project.json
  (group IDs, membership);
}

partition "Align Stage" {

  repeat
    :Select group;
    :Choose reference image;
    :Compute alignment transform;
    :Confirm alignment;

    :Write alignment data to project.json
    (transform matrix, reference ID);
  repeat while (More groups?)
}

partition "Annotate Stage" {

  repeat
    :Add / edit annotations;
    :Write annotation data to project.json;
  repeat while (More annotations?)
}

:Persist final project.json;

partition "Downstream Processing" {

  :Load project.json;

  if (Use bounding boxes?) then (Yes)
    :Use normalised images;
  else (No)
    :Ignore preparation metadata;
  endif

  :Use pHash / groups / alignments
  for further analysis;
}

stop
@enduml